<!doctype html><html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta><title>我的自动化番剧工作流 - Kur4ge&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#cee1ff"><meta name="application-name" content="Kur4ge&#039;s Blog"><meta name="msapplication-TileImage" content="https://kur4ge.oss-accelerate.aliyuncs.com/img/icon-192x192.png"><meta name="msapplication-TileColor" content="#cee1ff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Kur4ge&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="192x192" href="https://kur4ge.oss-accelerate.aliyuncs.com/img/icon-192x192.png"><link rel="apple-touch-icon" sizes="256x256" href="https://kur4ge.oss-accelerate.aliyuncs.com/icon-256x256.png"><link rel="apple-touch-icon" sizes="384x384" href="https://kur4ge.oss-accelerate.aliyuncs.com/icon-384x384.png"><link rel="apple-touch-icon" sizes="512x512" href="https://kur4ge.oss-accelerate.aliyuncs.com/icon-512x512.png"><meta name="description" content="啊B最近番剧越来越不能看了，加上鼓捣影音库已经上了Plex Pass，是时候鼓捣自动下番了！"><meta property="og:type" content="blog"><meta property="og:title" content="我的自动化番剧工作流"><meta property="og:url" content="https://blog.kur4ge.com/2023/07/flexget-plex-and-bangumi/"><meta property="og:site_name" content="Kur4ge&#039;s Blog"><meta property="og:description" content="啊B最近番剧越来越不能看了，加上鼓捣影音库已经上了Plex Pass，是时候鼓捣自动下番了！"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://kur4ge.oss-accelerate.aliyuncs.com/img/og_image.png"><meta property="article:published_time" content="2023-07-15T22:53:49.000Z"><meta property="article:modified_time" content="2023-07-15T14:53:49.000Z"><meta property="article:author" content="Kur4ge"><meta property="article:tag" content="flexget"><meta property="article:tag" content="plex"><meta property="article:tag" content="bangumi"><meta property="article:tag" content="homelab"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://kur4ge.oss-accelerate.aliyuncs.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.kur4ge.com/2023/07/flexget-plex-and-bangumi/"},"headline":"我的自动化番剧工作流","image":["https://kur4ge.oss-accelerate.aliyuncs.com/2023/07/flexget-plex-and-bangumi/plex.png","https://kur4ge.oss-accelerate.aliyuncs.com/2023/07/flexget-plex-and-bangumi/plex-dupefinder.png"],"datePublished":"2023-07-15T22:53:49.000Z","dateModified":"2023-07-15T14:53:49.000Z","author":{"@type":"Person","name":"Kur4ge"},"publisher":{"@type":"Organization","name":"Kur4ge's Blog","logo":{"@type":"ImageObject","url":"https://kur4ge.oss-accelerate.aliyuncs.com/img/logo.png?no-lazy"}},"description":"啊B最近番剧越来越不能看了，加上鼓捣影音库已经上了Plex Pass，是时候鼓捣自动下番了！"}</script><link rel="canonical" href="https://blog.kur4ge.com/2023/07/flexget-plex-and-bangumi/"><link rel="alternate" href="/atom.xml" title="Kur4ge&#039;s Blog" type="application/atom+xml"><link rel="icon" href="https://kur4ge.oss-accelerate.aliyuncs.com/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="https://kur4ge.oss-accelerate.aliyuncs.com/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?53d4cc3fbcaf6e6e10265955449fabff";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-6HGV3NEPFY" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6HGV3NEPFY")</script><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><script>!function(){function e(){if(!location.hash)return;Array.from(document.querySelectorAll(".tab-content")).forEach(e=>{e.classList.add("is-hidden")}),Array.from(document.querySelectorAll(".tabs li")).forEach(e=>{e.classList.remove("is-active")});const e=document.querySelector(location.hash);e&&e.classList.remove("is-hidden");const t=document.querySelector(`a[href="${location.hash}"]`);t&&t.parentElement.classList.add("is-active")}e(),window.addEventListener("hashchange",e,!1)}()</script><meta name="generator" content="Hexo 6.0.0"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/logo.png?no-lazy" alt="Kur4ge&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2023-07-15T22:53:49.000Z" title="7/15/2023, 10:53:49 PM">2023-07-16</time>发表</span><span class="level-item"><time datetime="2023-07-15T14:53:49.000Z" title="7/15/2023, 2:53:49 PM">2023-07-15</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/">尝尝鲜</a></span><span class="level-item">9 分钟读完 (大约1308个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">我的自动化番剧工作流</h1><div class="content"><p>啊B最近番剧越来越不能看了，加上鼓捣影音库已经上了<code>Plex Pass</code>，是时候鼓捣自动下番了！</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2023/07/flexget-plex-and-bangumi/plex.png" alt="Plex Bangumi"></p><span id="more"></span><h2 id="Transmission"><a href="#Transmission" class="headerlink" title="Transmission"></a>Transmission</h2><p>使用 Transmission 进行 BT下载</p><p><strong>无脑 Docker</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;2.1&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">transmission:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">lscr.io/linuxserver/transmission:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">transmission</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PUID=1001</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PGID=1001</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TRANSMISSION_WEB_HOME=</span> <span class="comment">#optional</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USER=</span> <span class="comment">#optional</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PASS=</span> <span class="comment">#optional</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WHITELIST=</span> <span class="comment">#optional</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PEERPORT=</span> <span class="comment">#optional</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">HOST_WHITELIST=</span> <span class="comment">#optional</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/path/to/config/folder:/config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/path/to/downloads/folder:/downloads</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/path/to/watch/folder:/watch</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9091</span><span class="string">:9091</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">51413</span><span class="string">:51413</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">51413</span><span class="string">:51413/udp</span></span><br><span class="line"><span class="comment">#    network_mode: host</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><h2 id="自动化下载"><a href="#自动化下载" class="headerlink" title="自动化下载"></a>自动化下载</h2><p>通过 <a target="_blank" rel="noopener" href="https://www.flexget.com/">FlexGet</a> 定期向 <a target="_blank" rel="noopener" href="https://acg.rip/">acg.rip</a> 爬取rss，解析想要的字幕组，推送到 <a target="_blank" rel="noopener" href="https://transmissionbt.com/">Transmission</a> 自动下载。</p><p><strong>无脑安装命令</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flexget</span><br></pre></td></tr></table></figure><p><strong>config.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">templates:</span></span><br><span class="line">  <span class="attr">tr:</span></span><br><span class="line">    <span class="attr">transmission:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="string">your_port</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">your_username</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">your_password</span></span><br><span class="line">      <span class="comment"># add_paused: yes  # 添加后不自动下载</span></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">save_root:</span> <span class="string">/mnt/Media/WEB-DL</span>  <span class="comment"># 保存的位置</span></span><br><span class="line">  <span class="comment"># 最终会保存到 /mnt/Media/WEB-DL/字幕组名称/番剧名称/S??/ 下</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line">  <span class="attr">acg.rip:</span></span><br><span class="line">    <span class="attr">rss:</span> <span class="string">https://acg.rip/.xml?term=</span></span><br><span class="line">    <span class="attr">seen:</span></span><br><span class="line">      <span class="attr">fields:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">url</span></span><br><span class="line">    <span class="attr">manipulate:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">title</span> <span class="comment"># 保存一份拷贝</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;\[(Lilith-Raws)] (.* / )?(.*?)( S?(\d+))? - (\d+) \[([^]]+)].*?(1080|720)[pP].+&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1#0#\3#1#\5#2#\6#3#\7#4#\8&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;【(喵萌.*?)】★.*?★\[.*? ?/ ?([^]]+)]\[(\d+)]\[(1080|720)[pP]?].*?(简).+&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1#0#\2#1##2#\3#3#\4#4#&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;\[(ANi)] (.+?)( S(\d+))? - .+ - (\d+) \[(1080|720)[Pp]?]\[([^]]+)].+&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1#0#\2#1#\4#2#\5#3#\7#4#\6&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;\[.*(LoliHouse).*] .+ / (.+?)( S(\d+))? - (\d+)(?:v\d+)? \[.*?(1080|720)[pP].*(简).+&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1#0#\2#1#\4#2#\5#3##4#\6&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;\[(桜都字幕组|MingY|Oborozuki)] .*? / (.*?)( [Ss](\d+))? \[(\d+)]\[(1080|720)[pP]?].*简繁.*内封.+&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1#0#\2#1#\4#2#\5#3##4#\6&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;\[(SweetSub)[^]]*]\[.+?]\[(.+?)([Ss](\d+))?]\[(\d+)].+?(1080|720)[pP].+?简.+&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1#0#\2#1#\4#2#\5#3##4#\6&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">group:</span>  <span class="comment"># 提取字幕组名称</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span>  <span class="comment"># 提取番剧名</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\2&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">session:</span>    <span class="comment"># 提取第几季</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;S\3&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">session:</span>    <span class="comment"># 格式化 S1 改成 S01</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">session</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^S(\d)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;S0\1&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">session:</span>    <span class="comment"># 如果为空，默认S01</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">session</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^S$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;S01&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">episode:</span>    <span class="comment"># 提取第几集</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;E\4&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">episode:</span>    <span class="comment"># E1 改成 S01</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">episode</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^E(\d)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;E0\1&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source:</span>     <span class="comment"># 来源，Baha 之类的</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\5&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">resolution:</span> <span class="comment"># 分辨率</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\6&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">subpath:</span> <span class="comment"># 可以用黑名单来拦截</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span>  <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;Group: \1; Name: \2; Session: S\3&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">subpath:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">subpath</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span>  <span class="string">&#x27;^Group: (.+); Name: (.*); Session: S$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;Group: \1; Name: \2; Session: S1&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">subpath:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">subpath</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span>  <span class="string">&#x27;^Group: (.+); Name: (.*); Session: S(\d)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;Group: \1; Name: \2; Session: S0\3&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">subpath:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">subpath</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span>  <span class="string">&#x27;^Group: (.+); Name: (.*); Session: (.*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1/\2/\3&#x27;</span></span><br><span class="line">    <span class="attr">regexp:</span></span><br><span class="line">      <span class="attr">reject:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">ANi/Mononogatari/S01</span>  <span class="comment"># 黑名单，这样不会下载这个番，支持正则</span></span><br><span class="line">      <span class="attr">accept:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">.+\/.+\/S\d+</span></span><br><span class="line">      <span class="attr">from:</span> <span class="string">subpath</span></span><br><span class="line">    <span class="attr">template:</span> <span class="string">tr</span></span><br><span class="line">    <span class="attr">transmission:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">&#x27;&#123;? save_root ?&#125;/<span class="template-variable">&#123;&#123; subpath &#125;&#125;</span>/&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Plex-识别优化-和-自动清空旧种"><a href="#Plex-识别优化-和-自动清空旧种" class="headerlink" title="Plex 识别优化 和 自动清空旧种"></a>Plex 识别优化 和 自动清空旧种</h2><p>Plex 有一个bug，如果文件名为 <code>[Nekomoe kissaten][Undead Girl Murder Farce][02][1080p][JPTC].mp4</code> 是无法识别的，<br>需要替换为 <code>[Nekomoe kissaten] Undead Girl Murder Farce - 02 [1080p][JPTC].mp4</code>，把名称和集数给分开。<br>所以写一个简单的脚本来修改名称，也顺便清理旧种子。</p><p><strong>flexget-auto.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> transmission_rpc</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">TRANS_CLIENT_CONF = &#123;</span><br><span class="line">    <span class="string">&quot;host&quot;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">    <span class="string">&quot;port&quot;</span>: <span class="string">&quot;9091&quot;</span>,</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;username&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Airota</span>(<span class="params">client: transmission_rpc.Client, torrent: transmission_rpc.Torrent</span>):</span><br><span class="line">    r = re.<span class="built_in">compile</span>(<span class="string">r&#x27;^(\[Airota\])\[([^]]+)\]\[(\d+)\]&#x27;</span>)</span><br><span class="line">    new_file_name = r.sub(<span class="string">r&quot;\1 \2 - \3 &quot;</span>, torrent.name, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> new_file_name == torrent.name:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    ret = client.rename_torrent_path(torrent.<span class="built_in">id</span>, torrent.name, new_file_name)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Airota Rename: <span class="subst">&#123;torrent.name&#125;</span> -&gt; <span class="subst">&#123;new_file_name&#125;</span>: <span class="subst">&#123;ret&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">NekomoeKissaten</span>(<span class="params">client: transmission_rpc.Client, torrent: transmission_rpc.Torrent</span>):</span><br><span class="line">    r = re.<span class="built_in">compile</span>(<span class="string">r&#x27;^(\[Nekomoe kissaten\])\[([^]]+)\]\[(\d+)\]&#x27;</span>)</span><br><span class="line">    new_file_name = r.sub(<span class="string">r&quot;\1 \2 - \3 &quot;</span>, torrent.name, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> new_file_name == torrent.name:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    ret = client.rename_torrent_path(torrent.<span class="built_in">id</span>, torrent.name, new_file_name)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;NekomoeKissaten Rename: <span class="subst">&#123;torrent.name&#125;</span> -&gt; <span class="subst">&#123;new_file_name&#125;</span>: <span class="subst">&#123;ret&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DeleteOldTorrent</span>(<span class="params">client: transmission_rpc.Client, torrent: transmission_rpc.Torrent</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="keyword">if</span> torrent.is_finished <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> torrent.done_date.timestamp() + <span class="number">3600</span> * <span class="number">24</span> * <span class="number">7</span> &gt; time.time():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    ret = client.remove_torrent(torrent.<span class="built_in">id</span>, delete_data=<span class="literal">False</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Delete: <span class="subst">&#123;torrent.name&#125;</span>: <span class="subst">&#123;ret&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        trans_client = transmission_rpc.Client(**TRANS_CLIENT_CONF)</span><br><span class="line">    <span class="keyword">except</span> transmission_rpc.error.TransmissionAuthError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line">    torrents = trans_client.get_torrents()</span><br><span class="line">    <span class="keyword">for</span> torrent <span class="keyword">in</span> torrents:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;torrent.hashString[-<span class="number">8</span>:]&#125;</span>: <span class="subst">&#123;torrent.name&#125;</span> (<span class="subst">&#123;torrent.status&#125;</span>)&#x27;</span>, <span class="string">&#x27;in transmission.&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> DeleteOldTorrent(trans_client, torrent): <span class="comment"># 删除老种子</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        NekomoeKissaten(trans_client, torrent)</span><br><span class="line">        Airota(trans_client, torrent)</span><br><span class="line">main()</span><br></pre></td></tr></table></figure><h2 id="Plex-去重"><a href="#Plex-去重" class="headerlink" title="Plex 去重"></a>Plex 去重</h2><p>之后，会有部分剧集多次重复下载，这里使用 <a target="_blank" rel="noopener" href="https://github.com/l3uddz/plex_dupefinder">plex dupefinder</a> 来去重。<br>它是通过 文件名，音频编码格式，视频编码格式，分辨率来给资源算分，自动算出最高的进行保留。</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2023/07/flexget-plex-and-bangumi/plex-dupefinder.png" alt="Plex DupeFinder"></p><p><strong>无脑安装命令</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/l3uddz/plex_dupefinder.git</span><br><span class="line"><span class="built_in">cd</span> plex_dupefinder</span><br><span class="line">python -m venv venv</span><br><span class="line"><span class="built_in">source</span> venv/bin/activate</span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><p>再创建 <code>plex_dupefinder.sh</code> 作为启动入口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line">BASE_PATH=`<span class="built_in">dirname</span> <span class="variable">$0</span>`</span><br><span class="line"><span class="built_in">source</span> <span class="variable">$BASE_PATH</span>/venv/bin/activate</span><br><span class="line">python <span class="variable">$BASE_PATH</span>/plex_dupefinder.py</span><br></pre></td></tr></table></figure><p>由于我的播放器支持 <code>hevc</code> 编码和我喜欢mkv格式，所以微调了下config。一般用默认即可。<br><code>FILENAME_SCORES</code> 也能主动给一些喜欢的字幕组加分。<br><strong>config.json</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;AUDIO_CODEC_SCORES&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Unknown&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;aac&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ac3&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dca&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dca-ma&quot;</span><span class="punctuation">:</span> <span class="number">4000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eac3&quot;</span><span class="punctuation">:</span> <span class="number">1250</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;flac&quot;</span><span class="punctuation">:</span> <span class="number">2500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mp2&quot;</span><span class="punctuation">:</span> <span class="number">500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mp3&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pcm&quot;</span><span class="punctuation">:</span> <span class="number">2500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;truehd&quot;</span><span class="punctuation">:</span> <span class="number">4500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;wmapro&quot;</span><span class="punctuation">:</span> <span class="number">200</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;AUTO_DELETE&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;FIND_DUPLICATE_FILEPATHS_ONLY&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;FILENAME_SCORES&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;*.avi&quot;</span><span class="punctuation">:</span> <span class="number">-1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*.ts&quot;</span><span class="punctuation">:</span> <span class="number">-1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*.vob&quot;</span><span class="punctuation">:</span> <span class="number">-5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*.mp4&quot;</span><span class="punctuation">:</span> <span class="number">-500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*.mkv&quot;</span><span class="punctuation">:</span> <span class="number">500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*1080p*BluRay*&quot;</span><span class="punctuation">:</span> <span class="number">15000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*720p*BluRay*&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*HDTV*&quot;</span><span class="punctuation">:</span> <span class="number">-1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*PROPER*&quot;</span><span class="punctuation">:</span> <span class="number">1500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*REPACK*&quot;</span><span class="punctuation">:</span> <span class="number">1500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*Remux*&quot;</span><span class="punctuation">:</span> <span class="number">20000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*CasStudio*&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*KINGS*&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*NTB*&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*QOQ*&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*SiGMA*&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*TBS*&quot;</span><span class="punctuation">:</span> <span class="number">-1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*TROLLHD*&quot;</span><span class="punctuation">:</span> <span class="number">2500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*VISUM*&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*dvd*&quot;</span><span class="punctuation">:</span> <span class="number">-1000</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;PLEX_LIBRARIES&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;Bangumi&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;PLEX_SERVER&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://your.plex/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;PLEX_TOKEN&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;SCORE_FILESIZE&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;SKIP_LIST&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;VIDEO_CODEC_SCORES&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Unknown&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;h264&quot;</span><span class="punctuation">:</span> <span class="number">8000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;h265&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hevc&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mpeg1video&quot;</span><span class="punctuation">:</span> <span class="number">250</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mpeg2video&quot;</span><span class="punctuation">:</span> <span class="number">250</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mpeg4&quot;</span><span class="punctuation">:</span> <span class="number">500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msmpeg4&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msmpeg4v2&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msmpeg4v3&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vc1&quot;</span><span class="punctuation">:</span> <span class="number">3000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vp9&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;wmv2&quot;</span><span class="punctuation">:</span> <span class="number">250</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;wmv3&quot;</span><span class="punctuation">:</span> <span class="number">250</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;VIDEO_RESOLUTION_SCORES&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;1080&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;480&quot;</span><span class="punctuation">:</span> <span class="number">3000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;4k&quot;</span><span class="punctuation">:</span> <span class="number">20000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;720&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Unknown&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sd&quot;</span><span class="punctuation">:</span> <span class="number">1000</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="统一启动-定时任务"><a href="#统一启动-定时任务" class="headerlink" title="统一启动 + 定时任务"></a>统一启动 + 定时任务</h2><p>这里需要再 <code>flexget</code> 执行后，需要跑一些脚本，不用 <code>flexget</code> 的 <code>schedule</code>，用 <code>crontab</code> 触发</p><p><strong>run.sh</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ! /bin/bash</span><br><span class="line">find /mnt/WEB-DL/ -type d -empty  # 自动清空目录为空的文件夹</span><br><span class="line">source /flexget/bin/activate</span><br><span class="line">cd /config/flexget  # 配置在这里</span><br><span class="line">flexget --cron execute</span><br><span class="line">python flexget-auto.py &gt; flexget-auto.log</span><br><span class="line">/plex_dupefinder/plex_dupefinder.sh &gt; plex_dupefinder.log</span><br></pre></td></tr></table></figure><p>再加入 <code>crontab</code> 就搞定啦~</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/10 * * * * &quot;/flexget/run.sh&quot;</span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>我的自动化番剧工作流</p><p><a href="https://blog.kur4ge.com/2023/07/flexget-plex-and-bangumi/">https://blog.kur4ge.com/2023/07/flexget-plex-and-bangumi/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Kur4ge</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2023-07-16</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2023-07-15</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/flexget/">flexget</a><a class="link-muted mr-2" rel="tag" href="/tags/plex/">plex</a><a class="link-muted mr-2" rel="tag" href="/tags/bangumi/">bangumi</a><a class="link-muted mr-2" rel="tag" href="/tags/homelab/">homelab</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=6173ea868afacc001dd07610&amp;product=inline-share-buttons" defer></script></article></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/01/wireguard-network-link/"><span class="level-item">Wireguard 组网</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config=function(){this.page.url="https://blog.kur4ge.com/2023/07/flexget-plex-and-bangumi/",this.page.identifier="2023/07/flexget-plex-and-bangumi/"};!function(){var e=document,t=e.createElement("script");t.src="//kur4ge.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://kur4ge.oss-accelerate.aliyuncs.com/img/avatar.png?no-lazy" alt="Kur4ge"></figure><p class="title is-size-4 is-block" style="line-height:inherit">Kur4ge</p><p class="is-size-6 is-block">Security researcher</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">10</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://twitter.com/kur4ge1337" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/kur4ge"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/kur4ge1337"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Transmission"><span class="level-left"><span class="level-item">1</span><span class="level-item">Transmission</span></span></a></li><li><a class="level is-mobile" href="#自动化下载"><span class="level-left"><span class="level-item">2</span><span class="level-item">自动化下载</span></span></a></li><li><a class="level is-mobile" href="#Plex-识别优化-和-自动清空旧种"><span class="level-left"><span class="level-item">3</span><span class="level-item">Plex 识别优化 和 自动清空旧种</span></span></a></li><li><a class="level is-mobile" href="#Plex-去重"><span class="level-left"><span class="level-item">4</span><span class="level-item">Plex 去重</span></span></a></li><li><a class="level is-mobile" href="#统一启动-定时任务"><span class="level-left"><span class="level-item">5</span><span class="level-item">统一启动 + 定时任务</span></span></a></li></ul></div></div><style>#toc .menu-list>li>a.is-active+.menu-list{display:block}#toc .menu-list>li>a+.menu-list{display:none}</style><script src="https://kur4ge.oss-accelerate.aliyuncs.com/js/toc.js" defer></script></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/CTF/"><span class="level-start"><span class="level-item">CTF</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/"><span class="level-start"><span class="level-item">尝尝鲜</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%A0%B4%E4%BA%8B%E6%B0%B4/"><span class="level-start"><span class="level-item">破事水</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time datetime="2023-07-15T22:53:49.000Z">2023-07-16</time></p><p class="title"><a href="/2023/07/flexget-plex-and-bangumi/">我的自动化番剧工作流</a></p><p class="categories"><a href="/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/">尝尝鲜</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2023-01-27T06:18:47.000Z">2023-01-27</time></p><p class="title"><a href="/2023/01/wireguard-network-link/">Wireguard 组网</a></p><p class="categories"><a href="/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/">尝尝鲜</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2022-02-10T23:46:00.000Z">2022-02-11</time></p><p class="title"><a href="/2022/02/wireguard-tutorial/">WireGuard 简易上手</a></p><p class="categories"><a href="/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/">尝尝鲜</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2021-12-13T21:37:32.000Z">2021-12-14</time></p><p class="title"><a href="/2021/12/A-ginx-idea-and-writeup/">A-ginx 出题思路与题解</a></p><p class="categories"><a href="/categories/CTF/">CTF</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2021-11-06T14:03:58.000Z">2021-11-06</time></p><p class="title"><a href="/2021/11/Why-is-Baidu-so-slow/">为什么我的百度访问这么慢？？？</a></p><p class="categories"><a href="/categories/%E7%A0%B4%E4%BA%8B%E6%B0%B4/">破事水</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">七月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Chromium/"><span class="tag">Chromium</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DNS/"><span class="tag">DNS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Network/"><span class="tag">Network</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WireGuard/"><span class="tag">WireGuard</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bangumi/"><span class="tag">bangumi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flexget/"><span class="tag">flexget</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/homelab/"><span class="tag">homelab</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/plex/"><span class="tag">plex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tutorial/"><span class="tag">tutorial</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/logo.png?no-lazy" alt="Kur4ge&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Kur4ge</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="https://kur4ge.oss-accelerate.aliyuncs.com/js/column.js"></script><script src="https://kur4ge.oss-accelerate.aliyuncs.com/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="https://kur4ge.oss-accelerate.aliyuncs.com/js/back_to_top.js" defer></script><script src="https://s9.cnzz.com/z_stat.php?id=1280699896&amp;web_id=1280699896" async></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load",()=>{window.cookieconsent.initialise({type:"info",theme:"edgeless",static:!1,position:"bottom-left",content:{message:"此网站使用Cookie来改善您的体验。",dismiss:"知道了！",allow:"允许使用Cookie",deny:"拒绝",link:"了解更多",policy:"Cookie政策",href:"https://www.cookiesandyou.com/"},palette:{popup:{background:"#edeff5",text:"#838391"},button:{background:"#4b81e8"}}})})</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load",()=>{"function"==typeof $.fn.lightGallery&&$(".article").lightGallery({selector:".gallery-item"}),"function"==typeof $.fn.justifiedGallery&&($(".justified-gallery > p > .gallery-item").length&&$(".justified-gallery > p > .gallery-item").unwrap(),$(".justified-gallery").justifiedGallery())})</script><script src="https://kur4ge.oss-accelerate.aliyuncs.com/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="https://kur4ge.oss-accelerate.aliyuncs.com/js/insight.js" defer></script><script>document.addEventListener("DOMContentLoaded",(function(){loadInsight({contentUrl:"/content.json"},{hint:"想要查找什么...",untitled:"(无标题)",posts:"文章",pages:"页面",categories:"分类",tags:"标签"})}))</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>